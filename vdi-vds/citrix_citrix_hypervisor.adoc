---
sidebar: sidebar 
permalink: vdi-vds/citrix_citrix_hypervisor.html 
keywords: Compute, storage, network, gpu, security, data protection, xencenter 
summary: Citrix Hypervisor （旧称 XenServer ）は、デスクトップ仮想化インフラ向けの、業界をリードする、コスト効率の高いオープンソースプラットフォームです。XenCenter は、 Citrix ハイパーバイザーサーバ用の軽量グラフィカルな管理インターフェイスです。 
---
= Citrix ハイパーバイザー
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
Citrix Hypervisor （旧称 XenServer ）は、デスクトップ仮想化インフラ向けの、業界をリードする、コスト効率の高いオープンソースプラットフォームです。XenCenter は、 Citrix ハイパーバイザーサーバ用の軽量グラフィカルな管理インターフェイスです。次の図は、 Citrix ハイパーバイザーのアーキテクチャの概要を示しています。

image:citrix_image14.png["エラー：グラフィックイメージがありません"]

Citrix ハイパーバイザーはタイプ 1 のハイパーバイザーです。制御ドメイン（ドメイン 0 またはドメイン 0 とも呼ばれる）は、 XAPI と呼ばれる Citrix ハイパーバイザー管理ツールスタックを実行する、セキュアで特権のある Linux VM です。この Linux VM は CentOS 7.5 のディストリビューションに基づいています。dom0 では、 Citrix ハイパーバイザー管理機能に加えて、ネットワークやストレージなどの物理デバイスドライバも実行されます。制御ドメインはハイパーバイザーと通信して、ゲスト VM を起動または停止するように指示できます。

仮想デスクトップはゲストドメインで実行されます。ユーザドメインまたは domU とも呼ばれ、制御ドメインにリソースを要求します。ハードウェア支援型の仮想化では、 Intel VT などの CPU 仮想化拡張機能を使用します。OS カーネルが仮想マシン上で実行されていることを認識する必要はありません。Quick Emulator (QEMU) は、 BIOS 、 IDE 、グラフィックアダプタ、 USB 、ネットワークアダプタの仮想化に使用されます。 など。PV （準仮想化）を使用すると、 OS カーネルとデバイスドライバが最適化され、仮想マシンのパフォーマンスが向上します。次の図は、 Citrix ハイパーバイザーのマルチテナンシー機能を示しています。

image:citrix_image15.png["エラー：グラフィックイメージがありません"]

NetApp HCI のリソースは、コンピューティング、ストレージ、ネットワーク、 GPU を含むハードウェアレイヤを構成します。 など。



=== コンピューティング

NetApp HCI の CPU とメモリの詳細については、前のセクションで説明しました。ただし、このセクションでは、コンピューティングノードが Citrix ハイパーバイザー環境でどのように使用されるかについて説明します。

Citrix ハイパーバイザーがインストールされている各 NetApp HCI コンピューティングノードをサーバと呼びます。サーバのプールは、リソースプール（ RP ）として管理されます。リソースプールは、ワークロードがノード間で移動される際に同等のパフォーマンスを提供するために、同様のモデルのコンピューティングノードで作成されます。リソースプールには常にマスターとして指定されたノードが含まれており、管理インターフェイス（ XenCenter および CLI の場合）が表示され、必要に応じて他のメンバーサーバにルーティングできます。ハイアベイラビリティがイネーブルの場合、マスターノードがダウンすると、マスター再選択が実行されます。

1 つのリソースプールに最大 64 台のサーバを含めることができます（ソフトリミット）。ただし、 GFS2 共有ストレージリソースを使用してクラスタリングを有効にすると、サーバ数は 16 に制限されます。

リソースプールは、ワークロードをホストするサーバを選択し、ライブマイグレーション機能を使用して他のサーバに移行できます。リソースプール全体で負荷を分散するには、 Citrix Hypervisor に WLB 管理パック（オプション）をインストールする必要があります。

image:citrix_image16.png["エラー：グラフィックイメージがありません"]

各テナントリソースは、専用のリソースプールでホストすることも、同じリソースプール上のタグで区別することもできます。運用とレポートの目的でカスタム値を定義できます。



=== ストレージ

NetApp HCI コンピューティングノードにはローカルストレージがありますが、これは永続的データの格納には推奨されません。このデータは、 NetApp HCI ストレージで作成された iSCSI ボリュームに格納するか、 NetApp AFF の NFS データストアに格納してください。

NetApp HCI ストレージを使用するには、 Citrix ハイパーバイザーサーバで iSCSI を有効にする必要があります。IQN を使用して、イニシエータを登録し、 Element 管理ポータルでアクセスグループを作成します。ボリュームを作成し（ LVM over iSCSI SR のブロックサイズサポートを必ず 512e に有効にしてください）、アカウント ID とアクセスグループを割り当てます。


NOTE: iSCSI イニシエータは、 CLI で次のコマンドを使用してカスタマイズできます。

....
    xe host-param-set uuid=valid_host_id other-config:iscsi_iqn=new_initiator_iqn
....
複数の iSCSI NIC を設定する場合、 iSCSI のマルチパスがサポートされます。iSCSI の設定は、 XenCenter を使用するか、 iscsiadm やマルチパスなどの CLI コマンドを使用して実行します。この設定は、 Citrix ハイパーバイザーのさまざまな CLI ツールでも実行できます。シングルターゲットストレージアレイの iSCSI マルチパスについては、を参照してください  https://support.citrix.com/article/CTX138429["CTX138429"^]。

ストレージリポジトリ（ SR ）は、仮想マシン（ VM ）仮想ディスクイメージ（ VDI ）が格納されるストレージターゲットです。VDI は、仮想ハードディスクドライブ（ HDD ）を抽象化したストレージです。次の図は、 Citrix ハイパーバイザーのさまざまなストレージオブジェクトを示しています。

image:citrix_image17.png["エラー：グラフィックイメージがありません"]

SR とホストの間の関係は物理ブロックデバイス（ PBD ）によって処理されます。 PBD には、特定のストレージターゲットとの接続および通信に必要な設定情報が格納されます。同様に、 VBD （仮想ブロックデバイス）は、 VDI と VM の間のマッピングを維持します。それ以外に、 VBD は、特定の VDI のサービス品質（ QoS ）と統計の微調整にも使用されます。次のスクリーンショットは、 Citrix ハイパーバイザーのストレージリポジトリのタイプを示しています。

image:citrix_image18.png["エラー：グラフィックイメージがありません"]

NetApp HCI では、次の SR タイプを作成できます。次の表に、機能の比較を示します。

|===
| フィーチャー（ Feature ） | LVM over iSCSI を実行します | GFS2 


| 仮想ディスクイメージの最大サイズ | 2TiB | 16TiB 


| ディスクのプロビジョニング方法 | シックプロビジョニング | シンプロビジョニング 


| 読み取りキャッシュのサポート | いいえ | はい。 


| クラスタ・プールのサポート | いいえ | はい。 


| 既知の拘束  a| 
* 読み取りキャッシュはサポートされていません

 a| 
* ストレージのライブマイグレーションを使用する VM の移行は、 VDI が GFS2 SR にある VM ではサポートされていません。また、別のタイプの SR から GFS2 SR に VDI を移行することはできません。
* GFS2 SR では、トリム / マッピング解除はサポートされていません。
* GFS2 SR およびこれらの SR 上のディスクに対してパフォーマンス指標を使用することはできません。
* 変更されたブロック追跡は、 GFS2 SR に格納されている VDI ではサポートされません。
* 2TiB を超える VDI を VHD または OVA / OVF としてエクスポートすることはできません。ただし、 4TiB を超える VM は XVA 形式でエクスポートできます。
* クラスタ化されたプールでは、プールあたり最大 16 台のホストのみがサポートされます。


|===
NetApp HCI で現在利用可能な機能を使用しているため、 Citrix ハイパーバイザーの Intellicache 機能は NetApp HCI のお客様にとって価値のないものです。IntelliCache を使用すると、ローカルストレージリポジトリにデータをキャッシュすることで、ファイルベースストレージシステムのパフォーマンスが向上します。

読み取りキャッシュでは、サーバメモリのデータをキャッシュすることで、特定のストレージリポジトリのパフォーマンスを向上させることができます。GFS2 は、読み取りキャッシュをサポートする初めての iSCSI ボリュームです。



=== ネットワーク

Citrix ハイパーバイザーネットワークは Open vSwitch をベースにしており、 OpenFlow をサポートしています。また、きめ細かなセキュリティポリシーをサポートして、 VM から送受信されるトラフィックを制御します。また、仮想ネットワーク環境で送信されるすべてのトラフィックの動作とパフォーマンスについても詳細に確認できます。次の図に、 Citrix ハイパーバイザーのネットワークの概要を示します。

image:citrix_image19.png["エラー：グラフィックイメージがありません"]

物理インターフェイス（ PIF ）は、サーバ上の NIC に関連付けられます。Network HCI では、最大 6 つの NIC を使用できます。2 つの NIC しか搭載していないモデルでは、 SR-IOV を使用して PIF を追加できます。PIF は、仮想スイッチネットワークへのアップリンクポートとして機能します。Virtual Interface （ VIF ；仮想インターフェイス）は、仮想マシン上の NIC に接続します。

さまざまなネットワークオプションを使用できます。

* VLAN を使用する外部ネットワーク
* 外部接続のない単一のサーバプライベートネットワーク
* ボンディングされたネットワーク（アクティブ / アクティブ–アグリゲートスループット）
* ボンディングされたネットワーク（アクティブ / パッシブ - フォールトトレラント）
* ボンディングされたネットワーク （ LACP –ソース IP とデスティネーション IP に基づいたロードバランシング およびポート）
* ボンディングされたネットワーク （ LACP –ソースとデスティネーションの Mac に基づいたロードバランシング 住所）
* ネットワークから離れていないクロスサーバプライベートネットワーク リソースプール
* SR-IOV


マスターサーバで作成されたネットワーク設定は、他のメンバーサーバに複製されます。したがって、新しいサーバがリソースプールに追加されると、そのネットワーク設定がマスターから複製されます。


NOTE: 各 NIC に割り当てることができる IP アドレスは、 VLAN ごとに 1 つだけです。iSCSI マルチパスの場合、同じサブネット上の IP を割り当てるには、複数の PIF が必要です。H615C では、 iSCSI の SR-IOV を検討できます。

image:citrix_image20.png["エラー：グラフィックイメージがありません"]

Citrix ハイパーバイザーのネットワークは Open vSwitch に基づいているため、 ovs-vsctl コマンドと ovs-appctl コマンドで管理できます。また、大規模なスケールアウト環境では、オーバーレイ解決策として NVGRE/VXLAN もサポートしています。

PVS アクセラレータを Citrix Provisioning （ PVS ）と併用すると、ドメイン 0 のメモリをキャッシュするか、メモリとローカルのストレージリポジトリを組み合わせることでパフォーマンスが向上します。

image:citrix_image21.png["エラー：グラフィックイメージがありません"]



=== GPU

Citrix Hypervisor は、 GPU の仮想化プラットフォームである NVIDIA vGPU を初めて導入し、複数の仮想マシン間で GPU を共有できるようにしました。NetApp HCI H610C （ NVIDIA Tesla M10 カードを搭載）と H615C （ NVIDIA Tesla T4 カードを搭載）は、仮想デスクトップに GPU リソースを提供することで、ユーザエクスペリエンスを向上させるハードウェアアクセラレーションを提供します。

NetApp HCI GPU は、パススルーモードを使用することで Citrix ハイパーバイザー環境で使用できます。パススルーモードでは、 GPU 全体が単一の仮想マシンに提供されます。また、 NVIDIA vGPU を使用して使用することもできます。GPU パススルーを使用した VM のライブマイグレーションはサポートされていないため、 NVIDIA vGPU を使用することを推奨します。

NVIDIA Virtual GPU Manager for Citrix Hypervisor は、 XenCenter を使用して他の管理パックとともに導入するか、またはサーバとの SSH セッションを使用してインストールできます。仮想 GPU は、ストリーミングプロセッサ、エンコーダ、デコーダなどを共有しながら、専用のフレームバッファを取得します。スケジューラを使用して制御することもできます。

H610C には Tesla M10 グラフィックカードが 2 枚あり、それぞれカードあたり 4 基の GPU を搭載しています。各 GPU は 8GB のフレームバッファメモリを搭載し、サーバあたり合計 8 基の GPU と 64GB のメモリを搭載しています。H615C には専用の GPU と 16GB のフレームバッファメモリを搭載した Tesla T4 カードが 3 基、サーバあたり 48GB のグラフィックメモリを搭載しています。次の図は、 NVIDIA vGPU アーキテクチャの概要を示しています。

image:citrix_image22.png["エラー：グラフィックイメージがありません"]

NVIDIA vGPU は、 GPU ごとに異なる構成プロファイルをサポートします。GPU への仮想マシンの配置は、要求に応じて最大密度または最大パフォーマンスを設定するポリシーによって制御されます。

image:citrix_image23.png["エラー：グラフィックイメージがありません"]

VM を作成する際に仮想 GPU プロファイルを設定できます。選択する vGPU プロファイルは、必要なフレームバッファメモリレベル、表示数、および解決方法の要件に基づいて決まります。仮想マシンの目的は、仮想アプリケーション（ A ）、仮想デスクトップ（ B ）、プロフェッショナルな Quadro 仮想ワークステーション（ Q ）、コンピューティングワークロード +++++++++++++++ （ C ）にも設定できます。

image:citrix_image24.png["エラー：グラフィックイメージがありません"]

XenCenter とは別に、 Citrix Hypervisor NVDIA-SMI 上の CLI ユーティリティを使用して、パフォーマンスのトラブルシューティングと監視を行うことができます。

仮想 GPU にアクセスするには、仮想マシン上の NVIDIA ドライバが必要です。一般に、ハイパーバイザーのドライババージョンと VM ゲストドライバは vGPU のリリースバージョンを同じにする必要があります。ただし、 vGPU リリース 10 以降では、ハイパーバイザーに最新バージョンが適用され、 VM ドライバには n-1 バージョンを使用できます。



=== セキュリティ

Citrix Hypervisor は、認証、許可、および監査制御をサポートします。認証は、 Active Directory だけでなくローカルアカウントでも制御されます。ユーザとグループを、リソースへの権限を制御するロールに割り当てることができます。イベントとロギングは、ローカルサーバに加えてリモートで保存できます。

Citrix Hypervisor は、 SSL 証明書を使用してトラフィックを暗号化するために、 Transport Layer Security （ TLS ） 1.2 をサポートします。

ほとんどの設定は XML データベースにローカルに保存されるため、 SMB パスワードなどの一部の内容はクリアテキストであるため、ハイパーバイザーへのアクセスを保護する必要があります。



=== データ保護

仮想マシンは OVA ファイルとしてエクスポートでき、 OVA ファイルを使用して他のハイパーバイザーにインポートすることができます。仮想マシンは、ネイティブの XVA 形式でエクスポートし、他の Citrix Hypervisor にインポートすることもできます。ディザスタリカバリの場合は、この 2 つ目のオプションに加え、 SnapMirror またはネイティブの Element OS 同期レプリケーションまたは非同期レプリケーションで処理されるストレージベースのレプリケーションも利用できます。ネットアップなら、 HCI ストレージを ONTAP ストレージとペアリングしてレプリケーションすることもできます。

crash-consistent イメージバックアップを行うために、ストレージベースの Snapshot とクローニングの機能を利用できます。ハイパーバイザーベースのスナップショットを使用して、ポイントインタイムスナップショットを提供できます。また、新しい仮想マシンをプロビジョニングするためのテンプレートとしても使用できます。
