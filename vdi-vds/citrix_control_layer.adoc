---
sidebar: sidebar 
permalink: vdi-vds/citrix_control_layer.html 
keywords: App Layering, delivery controller, database, director, license, provisioning services, studio, Workspace Environment Management 
summary: Citrix コントロールレイヤーは、アプリケーションレイヤー、配信コントローラー、データベース、ディレクター、ライセンス、 Provisioning Services 、 Studio 、および Workspace Environment Management 。 
---
= コントロールレイヤ
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/




=== アプリケーションの階層化

レイヤ化とは、 OS 、アプリケーション、およびユーザ設定とデータを分離するテクノロジで、それぞれを独自の仮想ディスクまたは仮想ディスクのグループ上でホストします。これらのコンポーネントは、すべて同じマシンイメージ上にあるかのように OS とマージされます。ユーザーは、追加のトレーニングなしで作業を続けることができます。レイヤーを使用すると、割り当て、パッチ適用、更新が簡単になります。レイヤとは、ファイルシステムとそのレイヤに固有のレジストリエントリのコンテナのことです。

Citrix App Layering を使用すると、 Citrix 仮想アプリケーションおよびデスクトップのマスターイメージおよび VMware Horizon 環境を管理できます。また、アプリケーションをレイヤ化することで、アプリケーションをオンデマンドでユーザにプロビジョニングできます。これらのアプリケーションは、ログイン時に接続されます。ユーザーパーソナライゼーションレイヤーを使用すると、ユーザーはカスタムアプリケーションをインストールし、そのデータを専用レイヤーに保存できます。そのため、共有デスクトップモデルを使用している場合でも、個人的なデスクトップエクスペリエンスを利用できます。

Citrix App Layering は、マージされたレイヤーを作成してマスターイメージを作成します。これによってパフォーマンスが低下することはありません。Elastic Layers を使用すると、ユーザのログイン時間が長くなります。

image:citrix_image33.png["エラー：グラフィックイメージがありません"]

Citrix App Layering は、単一の仮想アプライアンスを使用してレイヤを管理し、イメージとアプリケーションを使用して別のプラットフォームに配信します。Citrix Enterprise Layer Manager （ ELM ）ポータルには、 Microsoft Silverlight 4.0 をサポートする Web ブラウザからアクセスする必要があります。ローカル管理インターフェイスの要件を満たせない場合は、クラウドベースの管理ポータルも利用できます。

初期設定には、 2 種類のプラットフォームコネクタの作成が含まれます。 1 つ目はレイヤ作成用のプラットフォームコネクタで、もう 1 つはイメージ公開用のプラットフォームコネクタです。

image:citrix_image34.png["エラー：グラフィックイメージがありません"]

レイヤリポジトリは、 Elastic Layers が格納されている ELM で設定された SMB ファイル共有です。レイヤワークディスクとは、 ELM によって作成されたすべてのレイヤが格納される場所です。ディスクはアプライアンスに接続され、ローカルの Linux ファイルシステムが使用されるブロックデバイスとして使用されます。レイヤワークディスクは、レイヤイメージをまとめるスクラッチ領域として使用されます。作成されたマスターイメージは、プロビジョニングプラットフォームにプッシュされます。

image:citrix_image35.png["エラー：グラフィックイメージがありません"]

複数のレイヤ上に共通または共有ファイルがある場合、デフォルトでは高優先度のレイヤ ID が優先されます。新しいレイヤが作成されるたびに、レイヤ ID が増分されます。レイヤの優先度を制御する場合は、のサポートユーティリティを使用します  https://support.citrix.com/article/CTX225934["Citrix LayerPriority ユーティリティのページ"^]。

また、 ELM は、 Active Directory および LDAP との統合による認証およびロールベースアクセス制御もサポートしています。



=== Delivery Controller （デリバリコントローラ）

デリバリコントローラは、ユーザアクセス、仲介、および接続の最適化を担当します。また、仮想マシンを効果的にプロビジョニングするためのマシン作成サービス（ MCS ）も提供します。サイトごとに少なくとも 1 台のデリバリコントローラが必要です。通常、冗長性と拡張性を確保するためにコントローラを追加します。

Virtual Desktop Agent （ VDA ）をユーザーが使用できるようにするには、 VDA が配信コントローラに登録する必要があります。VDA の導入時に、 Active Directory OU に基づいて GPO を使用して初期登録オプションを手動で指定できます。このプロセスは MCS でも処理できます。

デリバリコントローラは、コントローラがデータベースサーバとの接続を失った場合に備えてローカルホストキャッシュを保持します。



=== データベース

SQL Server データベースは、サイトの設定データ、ロギング、および監視に使用されます。各サイトに少なくとも 1 つのデータベースが必要です。高可用性を実現するには、 AlwaysOn 可用性グループ、データベースミラーリング、 SQL クラスタリングなどの Microsoft SQL Server 機能を使用します。少なくとも、 SQL VM にハイパーバイザーの高可用性機能を使用することを検討してください。

コントローラにはローカルホストキャッシュがありますが、既存の接続には影響しません。ただし、接続を新規に確立する場合は、データベース接続を使用することを推奨します。



=== ディレクター

Citrix Director では、 Citrix 仮想アプリケーションおよびデスクトップの解決策を監視できます。ヘルプデスクユーザーは、特定のユーザーセッションを検索して、トラブルシューティングのための全体像を取得できます。Citrix 仮想アプリケーションおよびデスクトップリソースが Citrix Hypervisor 上でホストされている場合、ヘルプデスクのユーザーは Director ポータルからコンソールセッションを起動できます。

image:citrix_image36.png["エラー：グラフィックイメージがありません"]



=== 使用許諾

Citrix ライセンスサーバーは、すべての Citrix ライセンスのリポジトリを管理して、アプリケーションでライセンスを簡単に使用できるようにします。ライセンスサーバには、高度なトラブルシューティングのための管理ポータルが用意されています。通常の操作には、 Citrix Studio も使用できます。



=== Provisioning Services （プロビジョニングサービス）

プロビジョニングサービスにより、 PXE ブートを使用してベアメタルワークステーションにもデスクトップイメージをプロビジョニングできます。また、 PXE ブートでネットワークの変更が許可されていない環境をサポートするために、 ISO または CDROM ベースのブートオプションも利用できます。このラボで使用した DHCP サーバオプションを次の図に示します。CP.HCIEUC.Demo および PVS.HCIEUC.Demo は、 2 つのプロビジョニングサーバをポイントするロードバランサ仮想 IP です。オプション 011 および 017 が使用可能な場合、オプション 066 および 067 は無視されます。

image:citrix_image37.png["エラー：グラフィックイメージがありません"]

Citrix のプロビジョニングに基づいてマシンカタログを作成するための高度な操作は次のとおりです。

. テンプレート VM で、 VDA をインストールする前にターゲットエージェントをインストールします。
. 追加のディスクをキャッシング用に割り当て、 MBR でフォーマットします。この手順はオプションです。少なくとも PVS ストアに書き込みキャッシュパスがあることを確認してください。
. ターゲット画像ウィザードを起動し、質問に回答します。プロンプトが表示されたら、 Citrix Provisioning Server を 1 台指定してください。
. デバイスは PXE または ISO で起動します。イメージングウィザードでは、画像のキャプチャが続行されます。
. 作成した vDisk を選択し、右クリックして [Load Balancing] を選択し、有効にします。
. vDisk プロパティの場合、アクセスモードを Standard に変更し、 Cache Type を Cache in Device RAM with Overflow on Hard Disk に変更します。
. サイトを右クリックして、 [ 仮想デスクトップの作成 ] セットアップウィザードを選択し、質問に答えます。




=== スタジオ

Citrix Studio は、 Citrix Virtual Apps and Desktops で使用される一元管理コンソールです。マシンカタログ、配信グループ、アプリケーション、ポリシー、およびリソースホスティング、ライセンス、ゾーン、役割、スコープの構成の管理は、 Citrix Studio によって処理されます。Citrix Studio には、 Citrix 仮想アプリケーションおよびデスクトップを管理するための PowerShell スナップインも用意されています。



=== Workspace 環境管理

ワークスペース環境管理（ WEM ）は、インテリジェントなリソース管理およびプロファイル管理テクノロジーを提供し、ソフトウェアのみの解決策で Citrix 仮想アプリケーションおよびデスクトップに対する最高のパフォーマンス、デスクトップログイン、アプリケーション応答時間を実現します。

WEM には、設定情報を格納するための SQL データベースが必要です。インフラサービスの高可用性を実現するために、複数のインスタンスをロードバランサ仮想サーバ接続で使用します。次の図は、 WEM のアーキテクチャを示しています。

image:citrix_image38.png["エラー：グラフィックイメージがありません"]

次の図は、 WEM コンソールを示しています。

image:citrix_image39.png["エラー：グラフィックイメージがありません"]

WEM の主な機能は次のとおりです。

* 特定のタスクまたはアプリケーションのリソースを制御する機能
* Windows アイコン、ネットワークドライブ、スタートメニュー項目などを管理するための簡単なインターフェイス
* 古いマシンを再利用して管理する機能 シンクライアントとして
* ロールベースアクセス制御
* さまざまなフィルタに基づいてポリシーを制御します

