---
sidebar: sidebar 
permalink: ehc/evs-mount-fsxn-nfs.html 
keywords: Amazon, AWS, EVS, Elastic VMware Service, ONTAP, FSx, nfs 
summary: このセクションでは、FSx for ONTAP を NFS データストアとして導入する手順を説明します。iSCSIデータストアを導入する手順については、次のセクションで詳しく説明します。 
---
= FSx for ONTAP を NFS データストアとして使用するための導入手順
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
このセクションでは、FSx for ONTAP を NFS データストアとして導入する手順を説明します。iSCSIデータストアを導入する手順については、次のセクションで詳しく説明します。



== 大まかな展開手順

Amazon EVS の NFS データストアとして使用するために FSx for ONTAP ファイルシステムをデプロイし、2 つのサービス間の接続を確立するには、次の手順を実行します。

* Amazon EVS VCF 環境が配置されているのと同じ VPC に FSx for ONTAP ファイルシステムをセットアップします。
* セキュリティ グループとルーティング テーブルを検証しています。
* Amazon EVS の NFS データストアとして使用するために FSx for ONTAP ストレージボリュームを接続します。




== 前提条件

FSx for ONTAP を Amazon EVS の NFS データストアとしてセットアップするプロセスを開始する前に、次の前提条件を満たしている必要があります。

* Amazon EVS仮想化環境。その方法の詳細については、次のドキュメントをご覧ください。 link:https://docs.aws.amazon.com/evs/latest/userguide/what-is-evs.html["Amazon EVS 入門ガイド"] 。
* 適切な SSD ストレージ容量、プロビジョニングされた IOPS およびスループットを備えた、ONTAP 用のシングル アベイラビリティ ゾーン (AZ) FSx を作成します。
* 最適なパフォーマンスを得るには、FSx for ONTAP ファイルシステムを Amazon EVS インスタンスと同じ VPC 内に配置してください。FSxfor ONTAP を別の VPC にデプロイする場合でも、VPC ピアリングがサポートされます。
* パフォーマンス要件に基づいて、Single-AZ FSx for ONTAPファイルシステムに必要な適切なIOPSとスループットを選択します。 link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/performance.html["FSx for ONTAP のパフォーマンス仕様の詳細"]利用可能な各オプションが提供するスループットと IOPS を理解します。



NOTE: このガイドでは、FSx for ONTAP ファイル システムをサービス アクセス サブネットと同じサブネットにデプロイします。

Amazon EVS 仮想化環境が VPC にデプロイされたら、NFS データストアとして使用される Single-AZ FSx for ONTAP ファイルシステムのセットアップに進むことができます。


NOTE: FSx for ONTAP ファイルシステムは、Amazon EVS SDDC と同じ AZ にデプロイする必要があります。



== FSx for ONTAPファイルシステムの作成

次の手順では、FSx for ONTAP ファイル システムをプロビジョニングおよびマウントする方法を示します。

. Amazon FSxコンソールへアクセスしてください `https://console.aws.amazon.com/fsx/`インターネット ブラウザを使用して、資格情報でサインインします。
. コンソールで「ファイルシステムの作成」を選択します。これにより、FSx for ONTAP ファイルシステムを作成するためのセットアップウィザードが開始されます。
. まず、ファイルシステムの種類を選択します。利用可能なファイルシステムオプションから「Amazon FSx for NetApp ONTAP」を選択し、「次へ」ボタンをクリックして進みます。
+
image:evs-mount-fsxn-02.png["ファイルシステムの種類を選択するダイアログを表す図"]

. クイック作成と標準作成のオプションから選択できます。クイック作成では事前定義された設定が提供され、標準作成では独自の設定を定義できます。
+
「標準作成」オプションを選択します。

+
image:evs-mount-fsxn-03.png["ファイルシステムの種類の選択、標準の作成ダイアログを表す図"]

+
標準ファイルシステム作成セットアップウィザードが起動します。ファイルシステムの詳細ページで、以下の画像と同じ情報を選択して入力します。

+
image:evs-mount-fsxn-04.png["ファイルシステムタイプの選択、標準作成ウィザードを表す図"]

. 「ネットワークとセキュリティ」というセクションまでスクロールダウンします。このセクションでは、サブネットとVPCの詳細を設定します。このガイドでは、ドロップダウンメニューから「EVS-VPC」を選択し、EVS仮想環境のサブネットとしてサービスアクセスサブネット（タグなしVLAN）を選択しました。
+

NOTE: サブネットは、VPC 内のタグなしプライベートサブネットであればどれでも構いません。また、適切なルーティングが設定されていれば、VPC ピアリング経由で接続された別の VPC/サブネットであっても構いません。

+
image:evs-mount-fsxn-05.png["ネットワークセキュリティダイアログを表す図"]

. 下にスクロールすると、「セキュリティと暗号化」セクションがあります。ここで、ドロップダウンメニューから暗号化キーを選択します。これらのキーはAWS Key Management Service（AWS KMS）によって提供され、FSx for ONTAPファイルシステム内の保存データを保護します。
+
次に、「ファイルシステム管理パスワード」設定で、ファイルシステムを管理する fsxadmin ユーザーの一意のパスワードを指定します。

+
image:evs-mount-fsxn-06.png["セキュリティと暗号化のダイアログを表す図"]

. 次に、「デフォルトのストレージ仮想マシン構成」というセクションまでスクロールします。ここで、ストレージ仮想マシン (SVM) の名前を入力する必要があります。
+
image:evs-mount-fsxn-07.png["デフォルトのストレージ仮想マシン構成ダイアログを表す図"]

. 次に、「デフォルトのボリューム構成」というセクションまでスクロールダウンします。ここでボリュームの名前を入力し、ボリュームサイズを設定します。ボリュームプロトコルはNFS v3（デフォルトで有効）に設定してください。ストレージ効率化機能（圧縮、重複排除、コンパクション）を有効にするオプションをクリックして、ストレージ全体の使用量とコストを削減します。
+
image:evs-mount-fsxn-08.png["デフォルトのボリューム設定ダイアログを表す図"]

. ストレージ階層化オプションでは、ドロップダウンメニューから「スナップショットのみ」を選択し、階層化ポリシーの冷却期間を設定します。デフォルトは31日間ですが、この例では2日間の冷却期間を設定しています。
+
image:evs-mount-fsxn-09.png["ストレージ階層化ダイアログを表す図"]

. ボリュームを作成したら、ONTAP コマンドライン インターフェイス (ONTAP CLI) を使用して次のパラメータを変更します。
+
[cols="50%, 50%"]
|===
| *設定* | * コンフィグレーション * 


| ボリュームギャランティ | なし（シンプロビジョニング） 


| fractional_reserve | 0% 


| スナップリザーブ | 0% 


| オートサイズ | grow_shrink 


| Storage Efficiency | 有効 


| ボリューム階層化ポリシー | Snapshotのみ 


| アクセス時間の更新（ -atime-update ） | 正しくない 


| 最小限の先読み（ -min-readahead ） | 正しくない 


| Snapshotポリシー | なし 
|===
. オプションの「バックアップとメンテナンス」手順で、毎日の自動バックアップを無効にし、毎週のメンテナンス ウィンドウに「優先なし」を選択します。
+
完了したら「次へ」をクリックします。

+
image:evs-mount-fsxn-10.png["ファイルシステム作成ダイアログの完了を表す図"]

. 前の手順で設定したファイルシステム全体の構成を確認する画面が表示されます。すべてのパラメータが正しいことを確認し、「ファイルシステムの作成」ボタンをクリックして設定を完了してください。
+
image:evs-mount-fsxn-11.png["ファイルシステム作成ダイアログを表す図"]

+
image:evs-mount-fsxn-12.png["ファイルシステム作成ダイアログを表す図"]

+

NOTE: 追加のFSx for ONTAPファイルシステムを作成するには、上記の手順に従い、必要に応じてパフォーマンスとディスク容量に影響する値を調整してください。FSxfor ONTAPのパフォーマンスオプションの詳細については、以下をご覧ください。 link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/performance.html["このドキュメントページ"] 。





== VPC および仮想化環境のルーティングとセキュリティ グループの検証

VPC および SDDC のルーティングとセキュリティ グループを検証することは、Amazon EVS 仮想化環境と FSx for ONTAP ファイルシステム コンポーネントが適切に連携できることを確認するために重要です。

. Elastic VMware サービス > 仮想化環境 > [Amazon EVS 環境] を参照し、以下の緑色の矢印で示されているように、サービス アクセス サブネットを選択します。
+
image:evs-mount-fsxn-13.png["上記の手順のダイアログを表す図"]

. サブネットパネルが開きます。このパネルでルートテーブルを見つけてクリックしてください。
+
この例では、FSxN ONTAP ファイルシステムは Amazon EVS VCF 環境と同じ VPC 内にあるため、デフォルトのルートで十分です。

+
image:evs-mount-fsxn-14.png["上記の手順のダイアログを表す図"]

+
FSx for ONTAP ファイルシステムが別の VPC にある場合は、その VPC へのルートが追加されていることを確認してください。この例では、FSx for ONTAP システムが存在する VPC への VPC ピアリング用のルートが追加されています。

+
image:evs-mount-fsxn-15.png["上記の手順のダイアログを表す図"]

. 次に、FSx for ONTAP ファイル システムに接続されているセキュリティ グループ (つまり、Elastic Network Interface (ENI) に接続されているセキュリティ グループ) が NFS ポートへのアクセスを許可していることを確認する必要があります。
+
NFS および iSCSI プロトコル ポートの完全なリストについては、次のリンクを参照してください:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/limit-access-security-groups.html]Amazon VPC を使用したファイル システム アクセス コントロールのドキュメント]。

+
FSx for ONTAP ファイル システムがセキュリティ グループに関連付けられていることを確認するには、次の手順を実行します。

+
.. AWS コンソールで、[FSx] > [ファイルシステム] > [FSx for ONTAP ファイルシステム] に移動します。
.. [ネットワークとセキュリティ] タブで、ENI をクリックします。
.. ネットワーク インターフェイスの詳細の下にリストされている、ENI に関連付けられたセキュリティ グループを見つけます (下の画像では緑色の矢印で示されています)。
+
image:evs-mount-fsxn-16.png["上記の手順のダイアログを表す図"]

.. ポートを検証します。次の画面の例では、すべてのトラフィックが許可されています。ただし、NFSポートのみに制限することもできます。ポートのリストは次のとおりです。
+
*** ポート 111 TCP: ポートマッパー。NFS 要求で使用されるポートをネゴシエートするために使用されます。
*** ポート 635 TCP: 着信マウント要求を受信するための Mountd。
*** ポート 2049 TCP: NFS。NFS トラフィックを処理します。
*** ポート 4045 TCP: ロック要求を処理するネットワーク ロック マネージャー (NLM)。
*** ポート 4046 TCP: ネットワーク ステータス モニター (NSM)。サーバーがロック管理のために再起動すると、NFS クライアントに通知を送信します。
+
image:evs-mount-fsxn-17.png["上記の手順のダイアログを表す図"]









== FSx for ONTAP NFS ボリュームを Amazon EVS に接続してデータストアとして使用する

FSx for ONTAP ファイルシステムのプロビジョニングと適切な接続パラメータの検証が完了したら、FSx for ONTAP ストレージボリュームを Amazon EVS に接続します。以下の手順では、vCenter にアクセスし、FSx for ONTAP ボリュームを NFS データストアとしてマウントする方法を説明します。

. vSphereクライアントで「データストア」タブに移動し、データセンターを見つけて、「ストレージ」>「新しいデータストア」に進みます（下図参照）。
+
image:evs-mount-fsxn-18.png["上記の手順のダイアログを表す図"]

. 新規データストアウィザードが表示されます。「タイプ」のステップで、データストアのタイプを選択します。「NFS」を選択し、「次へ」をクリックして続行してください。
+
image:evs-mount-fsxn-19.png["上記の手順のダイアログを表す図"]

. 「NFS バージョン」の手順では、NFS バージョンを選択します。
+
この例では、「NFS 3」を選択しますが、NFS v4.1 も使用できることに注意してください。

+
image:evs-mount-fsxn-20.png["上記の手順のダイアログを表す図"]

. 「名前と構成」の手順では、次の操作を行います。
+
.. データストアに名前を付けます。
.. フォルダに名前を付けます。NFSボリュームへのジャンクションパスを使用します。
.. サーバーに名前を付けます。SVMの NFS DNS 名または NFS の IP アドレスを使用します。
+
「次へ」をクリックして続行します。

+
image:evs-mount-fsxn-21.png["上記の手順のダイアログを表す図"]



. 「ホスト アクセシビリティ」の手順で、データストアへのアクセスを必要とするすべてのホストを選択し、「次へ」をクリックして続行します。
+
image:evs-mount-fsxn-22.png["上記の手順のダイアログを表す図"]

. 「完了準備完了」のステップでデータを確認し、「完了」をクリックしてセットアップを完了します。
+
image:evs-mount-fsxn-23.png["上記の手順のダイアログを表す図"]

. 以下に示すように、vCenter にアクセスして NFS データストアが接続されていることを確認します。
+
image:evs-mount-fsxn-24.png["上記の手順のダイアログを表す図"]


