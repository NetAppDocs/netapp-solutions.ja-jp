---
sidebar: sidebar 
permalink: ehc/azure-native-dr-jetstream.html 
keywords: NetApp Solutions, microsoft azure, avs, azure, anf, azure netapp files, ontap, disaster recovery, dr 
summary:  
---
= ANFとJetStreamを使用したディザスタリカバリ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
クラウドへのディザスタリカバリは、耐障害性に優れた対費用効果の高い方法で、サイトの停止やデータ破損からワークロードを保護します（ランサムウェアなど）。VMware VAIOフレームワークを使用すると、オンプレミスのVMwareワークロードをAzure Blobストレージにレプリケートしてリカバリできるため、データ損失を最小限に抑えたり、ほぼゼロのRTOを実現できます。

Jetstream DRを使用すると、オンプレミスからAVS、特にAzure NetApp Files に複製されたワークロードをシームレスにリカバリできます。ディザスタリカバリサイトにある最小限のリソースと対費用効果の高いクラウドストレージを使用して、対費用効果の高いディザスタリカバリを実現します。Jetstream DRは、Azure Blob Storageを介したANFデータストアへのリカバリを自動化します。Jetstream DRは、独立したVMまたは関連するVMのグループを、ネットワークマッピングに従ってリカバリサイトインフラストラクチャにリカバリし、ランサムウェアからの保護のためのポイントインタイムリカバリを提供します。

このドキュメントでは、JetStream DRの動作原理とその主なコンポーネントについて説明します。

.解決策 の導入の概要
[%collapsible]
====
. JetStream DRソフトウェアをオンプレミスのデータセンターにインストールします。
+
.. JetStream DRソフトウェアバンドルをAzure Marketplace（ZIP）からダウンロードし、JetStream DR MSA（OVA）を指定のクラスタに導入します。
.. I/Oフィルタパッケージを使用してクラスタを設定します(JetStream VIBをインストールします)。
.. DR AVSクラスタと同じリージョンでAzure Blob（Azureストレージアカウント）をプロビジョニング
.. DRVAアプライアンスを導入し、レプリケーションログボリューム（既存のデータストアまたは共有iSCSIストレージからVMDK）を割り当てます。
.. 保護されたドメイン（関連するVMのグループ）を作成し、DRVAとAzure Blob Storage / ANFを割り当てます。
.. 保護を開始します。


. JetStream DRソフトウェアをAzure VMware解決策 プライベートクラウドにインストールします。
+
.. Runコマンドを使用して、JetStream DRをインストールおよび設定します。
.. [Scan Domains]オプションを使用して、同じAzure BLOBコンテナを追加し、ドメインを検出します。
.. 必要なDRVAアプライアンスを導入します。
.. 使用可能なvSANまたはANFデータストアを使用してレプリケーションログボリュームを作成します。
.. 保護されたドメインをインポートし、VMの配置にANFデータストアを使用するようにRocVA（リカバリVA）を設定します。
.. 適切なフェイルオーバーオプションを選択し、ほぼゼロのRTOドメインまたはVMに対して継続的なリハイドレートを開始します。


. 災害発生時に、指定したAVS DRサイトでAzure NetApp Files データストアへのフェイルオーバーをトリガーします。
. 保護対象サイトのリカバリ後、保護対象サイトへのフェイルバックを起動します。開始する前に、前提条件が満たされていることを確認してください https://docs.microsoft.com/en-us/azure/azure-vmware/deploy-disaster-recovery-using-jetstream["リンク"^] また、JetStream Softwareが提供するBandwidth Testing Tool（BWT）を実行して、JetStream DRソフトウェアで使用した場合にAzure BLOBストレージとそのレプリケーション帯域幅のパフォーマンスを評価します。接続を含む前提条件が整ったら、からJetStream DR for AVSをセットアップして登録します https://portal.azure.com/["Azure Marketplace で入手できます"^]。ソフトウェアバンドルをダウンロードしたら、上記のインストールプロセスに進みます。


====
多数のVM（100+など）の保護を計画して開始する場合は、JetStream DR Automation ToolkitからCapacity Planning Tool（CPT）を使用します。RTOとリカバリ・グループの設定とともに保護対象のVMのリストを指定し、CPTを実行します。

CPTは次の機能を実行します。

* RTOに応じたVMを保護ドメインに統合する。
* DRVAとそのリソースの最適な数を定義する。
* 必要なレプリケーション帯域幅の見積もり
* レプリケーションログボリュームの特性（容量、帯域幅など）を特定します。
* 必要なオブジェクトストレージ容量などを見積もります。



NOTE: ドメインの数と内容は、平均IOPS、合計容量、優先度（フェイルオーバー順序を定義）、RTOなど、VMのさまざまな特性によって異なります。



== JetStream DRをオンプレミスのデータセンターにインストールします

Jetstream DRソフトウェアは、JetStream DR Management Server Virtual Appliance（MSA）、DR Virtual Appliance（DRVA）、およびホストコンポーネント（I/O Filterパッケージ）の3つの主要コンポーネントで構成されています。MSAは、コンピューティングクラスタにホストコンポーネントをインストールして構成し、JetStream DRソフトウェアを管理するために使用されます。次に、インストールプロセスの概要 の概要を示します。

.JetStream DRをオンプレミスにインストールする方法
[%collapsible]
====
. 前提条件を確認する。
. キャパシティプランニングツールを実行して、リソースと構成に関する推奨事項を確認します（オプションですが、コンセプトの実証の試用には推奨されます）。
. JetStream DR MSAを指定されたクラスタ内のvSphereホストに展開します。
. ブラウザでDNS名を使用してMSAを起動します。
. vCenterサーバをMSAに登録します。インストールを実行するには、次の手順を実行します。
. JetStream DR MSAが導入され、vCenter Serverが登録されたら、vSphere Web Clientを使用してJetStream DRプラグインにアクセスします。これを行うには、[データセンター]>[設定]>[JetStream DR]に移動します。
+
image::vmware-dr-image8.png[VMware DRイメージ8]

. JetStream DRインタフェースから、適切なクラスタを選択します。
+
image::vmware-dr-image9.png[VMware DRイメージ9]

. I/Oフィルタパッケージを使用してクラスタを設定します。
+
image::vmware-dr-image10.png[VMware DRイメージ10]

. リカバリサイトにAzure Blob Storageを追加します。
. アプライアンスタブからDR仮想アプライアンス（DRVA）を導入します。



NOTE: DRFAはCPTによって自動的に作成できますが、POCトライアルの場合は、DRサイクルを手動で設定して実行することをお勧めします（Start protection > failover > failback）。

JetStream DRVAは、データ複製プロセスの主要な機能を容易にする仮想アプライアンスです。保護されたクラスタには少なくとも1つのDRVAが含まれている必要があります。通常は、ホストごとに1つのDRVAが構成されます。各DRVAは、複数の保護ドメインを管理できます。

image::vmware-dr-image11.png[VMware DRイメージ11]

この例では、4台のDRVAが80台の仮想マシン用に作成されています。

. 使用可能なデータストアまたは独立した共有iSCSIストレージプールからVMDKを使用して、各DRVAのレプリケーションログボリュームを作成します。
. Protected Domainsタブで、Azure Blob Storageサイト、DRVAインスタンス、およびレプリケーションログに関する情報を使用して、必要な数の保護ドメインを作成します。保護ドメインは、クラスタ内の特定のVMまたはVMのセットを定義します。これらのVMは一緒に保護され、フェイルオーバー/フェイルバック処理の優先順位が割り当てられます。
+
image::vmware-dr-image12.png[VMware DRイメージ12]

. 保護するVMを選択し、保護ドメインのVM保護を開始します。これにより、指定したBlob Storeへのデータレプリケーションが開始されます。



NOTE: 保護ドメイン内のすべてのVMに同じ保護モードが使用されていることを確認します。


NOTE: ライトバック（VMDK）モードを使用すると、パフォーマンスが向上します。

image::vmware-dr-image13.png[VMware DRイメージ13]

レプリケーションログボリュームがハイパフォーマンスストレージに配置されていることを確認します。


NOTE: フェイルオーバー実行ブックは、VM（回復グループ）のグループ化、起動順序の設定、およびCPU /メモリの設定とIP設定の変更を行うように構成できます。

====


== Runコマンドを使用して、Azure VMware解決策 プライベートクラウドにJetStream DR for AVSをインストールします

リカバリサイト（AVS）では、3ノードのパイロットライトクラスタを事前に作成することを推奨します。これにより、次の項目を含むリカバリサイトのインフラを事前に設定できます。

* 宛先ネットワークセグメント、ファイアウォール、DHCPやDNSなどのサービスなど。
* AVS対応のJetStream DRのインストール
* ANFボリュームをデータストアとして構成し、moreJetStream DRではミッションクリティカルなドメインのRTOモードをほぼゼロに設定できます。これらのドメインには、デスティネーションストレージが事前にインストールされている必要があります。この場合、ANFは推奨ストレージタイプです。



NOTE: セグメント作成を含むネットワーク構成は、オンプレミスの要件に合わせてAVSクラスタ上で設定する必要があります。

SLAやRTOの要件に応じて、継続的なフェイルオーバーモードや通常の（標準）フェイルオーバーモードを使用できます。RTOがほぼゼロの場合は、リカバリサイトで継続的なリハイドレートを開始する必要があります。

.プライベートクラウドにJetStream DR for AVSをインストールする方法
[%collapsible]
====
Azure VMware解決策 プライベートクラウドにJetStream DR for AVSをインストールするには、次の手順を実行します。

. AzureポータルからAzure VMware解決策 に移動し、プライベートクラウドを選択して、実行コマンド>パッケージ> JSDR.Configurationを選択します。
+

NOTE: Azure VMware解決策 のデフォルトCloudAdminユーザには、AVS対応のJetStream DRをインストールするための十分な権限がありません。Azure VMware解決策 では、JetStream DR用のAzure VMware解決策 実行コマンドを呼び出すことで、JetStream DRを簡単かつ自動でインストールできます。

+
次のスクリーンショットは、DHCPベースのIPアドレスを使用したインストール方法を示しています。

+
image::vmware-dr-image14.png[VMware DRイメージ14]

. JetStream DR for AVSのインストールが完了したら、ブラウザをリフレッシュします。JetStream DR UIにアクセスするには、SDDC Datacenter > Configure > JetStream DRに移動します。
+
image::vmware-dr-image15.png[VMware DRイメージ15]

. JetStream DRインターフェイスから、オンプレミスクラスタをストレージサイトとして保護するために使用したAzure Blob Storageアカウントを追加し、Scan Domainsオプションを実行します。
+
image::vmware-dr-image16.png[VMware DRイメージ16]

. 保護ドメインをインポートしたら、DRVAアプライアンスを展開します。この例では、JetStream DR UIを使用して、リカバリサイトから継続的なリハイドレートを手動で開始します。
+

NOTE: これらの手順は、CPT作成計画を使用して自動化することもできます。

. 使用可能なvSANまたはANFデータストアを使用してレプリケーションログボリュームを作成します。
. 保護ドメインをインポートし、VMの配置にANFデータストアを使用するようにリカバリVAを設定します。
+
image::vmware-dr-image17.png[VMware DRイメージ17]

+

NOTE: 選択したセグメントでDHCPが有効になっていて、十分なIPが使用可能であることを確認します。ダイナミックIPは、ドメインのリカバリ中に一時的に使用されます。リカバリVM（連続リハイドレートを含む）ごとに、個別のダイナミックIPが必要です。リカバリの完了後、IPは解放され、再利用できます。

. 適切なフェイルオーバーオプション（継続的フェイルオーバーまたはフェイルオーバー）を選択します。この例では、連続リハイドレート（連続フェールオーバー）が選択されています。
+
image::vmware-dr-image18.png[VMware DRイメージ18]



====


== フェイルオーバー/フェイルバックを実行しています

.フェールオーバー/フェールバックの実行方法
[%collapsible]
====
. オンプレミス環境の保護対象クラスタで障害が発生した場合（部分的または完全な障害）、フェイルオーバーをトリガーします。
+

NOTE: CPTを使用すると、フェイルオーバープランを実行して、Azure Blob StorageからAVSクラスタリカバリサイトにVMをリカバリできます。

+

NOTE: 保護対象のVMがAVSで起動されると、フェイルオーバー後（継続的または標準的なリハイドレート）、保護は自動的に再開され、JetStream DRは、Azure Blob Storage内の適切なコンテナまたは元のコンテナにデータをレプリケートし続けます。

+
image::vmware-dr-image19.png[VMware DRイメージ19]

+
image::vmware-dr-image20.png[VMware DRイメージ20]

+
タスクバーにフェイルオーバーアクティビティの進行状況が表示されます。

. タスクが完了すると、リカバリされたVMとビジネスに通常どおりアクセスできます。
+
image::vmware-dr-image21.png[VMware DRイメージ21]

+
プライマリサイトが起動して再び実行されるようになったら、フェイルバックを実行できます。VM保護が再開され、データの整合性を確認する必要があります。

. オンプレミス環境をリストア災害のタイプによっては、保護対象クラスタの構成をリストアまたは検証しなければならない場合があります。必要に応じて、JetStream DRソフトウェアを再インストールする必要があります。
+

NOTE: 注：Automation Toolkitで提供されている「recovery_utility_prepare_failback」スクリプトを使用すると、古いVMやドメイン情報などの元の保護サイトをクリーンアップできます。

. リストアされたオンプレミス環境にアクセスし、Jetstream DR UIに移動して、適切な保護ドメインを選択します。保護サイトがフェイルバックできる状態になったら、UIで[Failback]オプションを選択します。
+
image::vmware-dr-image22.png[VMware DRイメージ22]




NOTE: CPTで生成されたフェイルバックプランを使用して、VMとそのデータをオブジェクトストアから元のVMware環境に戻すこともできます。


NOTE: リカバリサイトのVMを一時停止して保護対象サイトで再起動したあとの最大遅延時間を指定します。この時間には、フェイルオーバーVMを停止したあとのレプリケーションの完了、リカバリサイトのクリーンアップにかかる時間、保護サイトでVMを再作成する時間などが含まれます。ネットアップの推奨値は10分です。

フェイルバックプロセスを完了し、VM保護およびデータの整合性が再開されたことを確認する。

====


== Ransomware回復

ランサムウェアからのリカバリは困難な作業です。具体的には、IT組織にとって、返品の安全ポイントを特定することは困難です。また、復旧したワークロードを、（睡眠中のマルウェアや脆弱なアプリケーションによって）再発する攻撃から確実に保護する方法が決定された場合もあります。

Jetstream DR for AVSとAzure NetApp Files データストアを併用すると、組織が使用可能なポイントインタイムからリカバリできるため、ワークロードが機能的な分離されたネットワークに必要に応じてリカバリされるため、これらの問題に対処できます。リカバリを使用すると、アプリケーションが相互に機能して通信できるようになり、南北のトラフィックにさらされることがなくなります。その結果、セキュリティチームはフォレンジックなどの必要な修復を安全に実行できます。

image::vmware-dr-image23.png[VMware DRイメージ23]
