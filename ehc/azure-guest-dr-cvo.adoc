---
sidebar: sidebar 
permalink: ehc/azure-guest-dr-cvo.html 
keywords: tr4935, 4935, azure, avs, jetstream, guest connect, dr, disaster recovery 
summary: クラウドへのディザスタリカバリは、耐障害性と対費用効果に優れた方法で、サイトの停止やランサムウェアなどのデータ破損からワークロードを保護します。NetApp SnapMirrorを使用すると、ゲスト接続ストレージを使用するオンプレミスのVMwareワークロードを、Azure内で実行されているNetApp Cloud Volumes ONTAP にレプリケートできます。 
---
= CVOとAVS（ゲスト接続ストレージ）によるディザスタリカバリ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
クラウドへのディザスタリカバリは、耐障害性と対費用効果に優れた方法で、サイトの停止やランサムウェアなどのデータ破損からワークロードを保護します。NetApp SnapMirrorを使用すると、ゲスト接続ストレージを使用するオンプレミスのVMwareワークロードを、Azure内で実行されているNetApp Cloud Volumes ONTAP にレプリケートできます。



== 概要

著者：Ravi BCBとNiyaz Mohamedネットアップ

 This covers application data; however, what about the actual VMs themselves. Disaster recovery should cover all dependent components, including virtual machines, VMDKs, application data, and more. To accomplish this, SnapMirror along with Jetstream can be used to seamlessly recover workloads replicated from on-premises to Cloud Volumes ONTAP while using vSAN storage for VM VMDKs.
本ドキュメントでは、NetApp SnapMirror、JetStream、およびAzure VMware解決策 （AVS）を使用してディザスタリカバリを設定および実行するためのステップバイステップ形式のアプローチを紹介します。

image:dr-cvo-avs-image1.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



== 前提条件

本ドキュメントでは、アプリケーションデータ用のゲスト内ストレージ（ゲスト接続とも呼ばれます）を中心に説明します。オンプレミス環境では、アプリケーションと整合性のあるバックアップにSnapCenter を使用していると想定しています。


NOTE: 本ドキュメントは、環境 サードパーティ製バックアップまたはリカバリ用解決策 に関するものです。環境で使用されている解決策 に応じて、ベストプラクティスに従って、組織のSLAを満たすバックアップポリシーを作成してください。

オンプレミス環境とAzure Virtual Network間の接続には、エクスプレスルートグローバルリーチまたはVPNゲートウェイを使用した仮想WANを使用します。オンプレミスVLANの設計に基づいてセグメントを作成する必要があります。


NOTE: オンプレミスのデータセンターをAzureに接続する方法は複数ありますが、これにより、本ドキュメントの特定のワークフローの概要がわかりません。適切なオンプレミスからAzureへの接続方法については、Azureのドキュメントを参照してください。



== DR解決策 の導入



=== 解決策 の導入の概要

. SnapCenter を使用して、必要なRPO要件に従ってアプリケーションデータがバックアップされていることを確認してください。
. 適切なサブスクリプションと仮想ネットワーク内で、Cloud Managerを使用して、適切なインスタンスサイズでCloud Volumes ONTAP をプロビジョニングします。
+
.. 該当するアプリケーションボリュームに対してSnapMirrorを設定します。
.. スケジュールされたジョブの実行後にSnapMirror更新をトリガーするには、SnapCenter でバックアップポリシーを更新してください。


. JetStream DRソフトウェアをオンプレミスのデータセンターにインストールし、仮想マシンの保護を開始します。
. JetStream DRソフトウェアをAzure VMware解決策 プライベートクラウドにインストールします。
. 災害発生時は、Cloud Managerを使用してSnapMirror関係を解除し、指定したAVS DRサイトのAzure NetApp Files またはVSANデータストアへの仮想マシンのフェイルオーバーをトリガーします。
+
.. アプリケーションVMのiSCSI LUNおよびNFSマウントを再接続します。


. プライマリサイトのリカバリ後にSnapMirrorを逆再同期して、保護サイトへのフェイルバックを開始します。




=== 展開の詳細

.AzureでCVOを構成し、ボリュームをCVOにレプリケート
[%collapsible]
====
まず、AzureでCloud Volumes ONTAPを設定します（link:azure-guest.html["リンク"^]）をクリックし、必要なボリュームを、必要な頻度とSnapshotの保持を使用してCloud Volumes ONTAP にレプリケートします。

image:dr-cvo-avs-image2.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

====
.AVSホストとCVOデータアクセスを設定
[%collapsible]
====
SDDCを導入する際に考慮すべき2つの重要な要素は、Azure VMware解決策 内のSDDCクラスタのサイズと、SDDCの稼働期間です。ディザスタリカバリ解決策 に関する以下の2つの重要な考慮事項は、全体的な運用コストの削減に役立ちます。SDDCは、3台のホストの規模に対応し、フルスケールの導入ではマルチホストクラスタにまで対応できます。

AVSクラスタを導入するかどうかは、主にRPOとRTOの要件に基づきます。Azure VMware解決策 では、テストや実際の災害に備えて、SDDCを随時プロビジョニングできます。SDDCを時間内に導入することで、災害に対処しない場合のESXiホストのコストを削減できます。ただし、このような導入形態では、SDDCのプロビジョニングに数時間かかるRTOが影響を受けます。

最も一般的な導入オプションは、SDDCを常時稼働のパイロットライトモードで実行することです。このオプションを使用すると、常に使用可能なホストを3台分のスペースに縮小できます。また、シミュレーションアクティビティとコンプライアンスチェックのベースラインを実行できるため、本番サイトとDRサイト間の運用のずれを回避できるため、リカバリ処理の時間を短縮できます。パイロットライトクラスタは、実際のDRイベントを処理する必要がある場合に、必要なレベルまで迅速に拡張できます。

AVS SDDCを設定するには（オンデマンドモードまたはパイロットライトモード）、を参照してください link:azure-setup.html["Azure に仮想化環境を導入して設定"^]。事前に、接続の確立後、AVSホストに常駐するゲストVMがCloud Volumes ONTAP からデータを消費できることを確認してください。

Cloud Volumes ONTAP とAVSを適切に設定したら、VAIOメカニズムを使用し、Cloud Volumes ONTAP へのアプリケーションボリュームのコピーにSnapMirrorを利用することにより、オンプレミスワークロードからAVSへのリカバリ（アプリケーションVMDKとゲストストレージを搭載したVM）を自動化するようにJetstreamを設定します。

====
.JetStream DRをオンプレミスデータセンターにインストールします
[%collapsible]
====
Jetstream DRソフトウェアは、JetStream DR Management Server Virtual Appliance（MSA）、DR Virtual Appliance（DRVA）、およびホストコンポーネント（I/Oフィルタパッケージ）の3つの主要コンポーネントで構成されています。MSAは、コンピューティングクラスタにホストコンポーネントをインストールおよび構成し、JetStream DRソフトウェアを管理するために使用されます。インストールプロセスは次のとおりです。

. 前提条件を確認します。
. リソースと構成に関する推奨事項については、Capacity Planning Toolを実行してください。
. JetStream DR MSAを、指定されたクラスタ内の各vSphereホストに導入します。
. ブラウザでDNS名を使用してMSAを起動します。
. vCenterサーバをMSAに登録します。
. JetStream DR MSAが導入され、vCenter Serverが登録されたら、vSphere Web ClientでJetStream DRプラグインに移動します。これを行うには、[データセンター]>[設定]>[JetStream DR]に移動します。
+
image:dr-cvo-avs-image3.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. JetStream DRインターフェイスから、次の作業を行います。
+
.. I/Oフィルタパッケージを使用してクラスタを設定します。
+
image:dr-cvo-avs-image4.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

.. リカバリサイトにあるAzure BLOBストレージを追加します。
+
image:dr-cvo-avs-image5.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



. アプライアンスタブから必要な数のDR仮想アプライアンス（DRVA）を導入します。
+

NOTE: キャパシティプランニングツールを使用して、必要なDRVAの数を見積もります。

+
image:dr-cvo-avs-image6.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:dr-cvo-avs-image7.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 使用可能なデータストアまたは独立した共有iSCSIストレージプールからVMDKを使用して、各DRVAのレプリケーションログボリュームを作成します。
+
image:dr-cvo-avs-image8.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. Protected Domainsタブで、Azure Blob Storageサイト、DRVAインスタンス、およびレプリケーションログに関する情報を使用して、必要な数の保護ドメインを作成します。保護ドメインは、クラスタ内の特定のVMまたはアプリケーションVMのセットを定義します。これらのVMは一緒に保護され、フェイルオーバー/フェイルバック処理の優先順位が割り当てられます。
+
image:dr-cvo-avs-image9.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:dr-cvo-avs-image10.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 保護するVMを選択し、依存関係に基づいてVMをアプリケーショングループにグループ化します。アプリケーション定義を使用すると、VMのセットを、ブート順序、ブート遅延、およびリカバリ時に実行可能なオプションのアプリケーション検証を含む論理グループにグループ化できます。
+

NOTE: 保護ドメイン内のすべてのVMに同じ保護モードを使用していることを確認します。

+

NOTE: ライトバック（VMDK）モードを使用すると、パフォーマンスが向上します。

+
image:dr-cvo-avs-image11.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. レプリケーションログボリュームがハイパフォーマンスストレージに配置されていることを確認します。
+
image:dr-cvo-avs-image12.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 完了したら、保護ドメインの保護の開始をクリックします。選択したVMのデータレプリケーションが開始され、指定したBLOBストアに送信されます。
+
image:dr-cvo-avs-image13.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. レプリケーションが完了すると、VMの保護ステータスは「回復可能」とマークされます。
+
image:dr-cvo-avs-image14.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+

NOTE: フェールオーバーランブックは、VM（回復グループと呼ばれる）をグループ化し、起動順序シーケンスを設定して、CPU /メモリ設定とIP設定を変更するように構成できます。

. 「設定」をクリックし、「Runbook設定」リンクをクリックして、Runbookグループを設定します。
+
image:dr-cvo-avs-image15.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. [グループの作成]ボタンをクリックして、新しいランブックグループの作成を開始します。
+

NOTE: 必要に応じて、画面の下部で、カスタムのプレスクリプトとポストスクリプトを適用して、ランブックグループの操作前および操作後に自動的に実行します。Runbookスクリプトが管理サーバ上に存在することを確認します。

+
image:dr-cvo-avs-image16.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 必要に応じてVMの設定を編集します。VMをリカバリするためのパラメータを指定します。これには、ブートシーケンス、ブート遅延（秒単位）、CPUの数、割り当てるメモリの量などが含まれます。上下の矢印をクリックして、VMのブートシーケンスを変更します。MACを保持するためのオプションも用意されています。
+
image:dr-cvo-avs-image17.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 静的IPアドレスは、グループの個々のVMに手動で設定できます。VMのNICビューリンクをクリックして、IPアドレスを手動で設定します。
+
image:dr-cvo-avs-image18.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. Configureボタンをクリックして、それぞれのVMのNIC設定を保存します。
+
image:dr-cvo-avs-image19.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:dr-cvo-avs-image20.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



フェイルオーバーとフェイルバックの両方のランブックのステータスが構成済みとして表示されるようになりました。フェイルオーバーとフェイルバックのRunbookグループは、同じVMと設定の初期グループを使用してペアで作成されます。必要に応じて、それぞれの[詳細]リンクをクリックして変更を行うことで、ランブックグループの設定を個別にカスタマイズできます。

====
.プライベートクラウドでAVS向けJetStream DRをインストールします
[%collapsible]
====
リカバリサイト（AVS）では、3ノードのパイロットライトクラスタを事前に作成することを推奨します。これにより、以下を含むリカバリサイトのインフラを事前に設定できます。

* 宛先ネットワークセグメント、ファイアウォール、DHCPやDNSなどのサービスなど
* AVS対応のJetStream DRのインストール
* ANFボリュームをデータストアなどとして設定


Jetstream DRは、ミッションクリティカルなドメインでほぼゼロのRTOモードをサポートします。これらのドメインには、デスティネーションストレージが事前にインストールされている必要があります。この場合、ANFは推奨ストレージタイプです。


NOTE: セグメント作成を含むネットワーク構成は、オンプレミスの要件に合わせてAVSクラスタ上で設定する必要があります。


NOTE: SLAやRTOの要件に応じて、継続的フェイルオーバーモードまたは通常の（標準）フェイルオーバーモードを使用できます。RTOがほぼゼロになるように、リカバリサイトで継続的なリハイドレートを開始する必要があります。

. Azure VMware解決策 プライベートクラウドにJetStream DR for AVSをインストールするには、実行コマンドを使用します。Azureポータルで、Azure VMware解決策 に移動し、プライベートクラウドを選択して、実行コマンド>パッケージ> JSDR.Configurationを選択します。
+

NOTE: Azure VMware解決策 のデフォルトCloudAdminユーザには、AVS対応のJetStream DRをインストールするための十分な権限がありません。Azure VMware解決策 では、JetStream DR用のAzure VMware解決策 実行コマンドを呼び出すことで、JetStream DRのインストールを簡単かつ自動化できます。

+
次のスクリーンショットは、DHCPベースのIPアドレスを使用したインストール方法を示しています。

+
image:dr-cvo-avs-image21.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. JetStream DR for AVSのインストールが完了したら、ブラウザをリフレッシュします。JetStream DR UIにアクセスするには、SDDC Datacenter > Configure > JetStream DRに移動します。
+
image:dr-cvo-avs-image22.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. JetStream DRインターフェイスから、次の作業を行います。
+
.. オンプレミスクラスタをストレージサイトとして保護するために使用したAzure Blob Storageアカウントを追加し、Scan Domainsオプションを実行します。
.. 表示されるポップアップダイアログで、インポートする保護ドメインを選択し、そのインポートリンクをクリックします。
+
image:dr-cvo-avs-image23.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



. ドメインがリカバリ用にインポートされます。[保護ドメイン]タブに移動して、目的のドメインが選択されていることを確認するか、[保護ドメインの選択]メニューから目的のドメインを選択します。保護ドメイン内のリカバリ可能なVMのリストが表示されます。
+
image:dr-cvo-avs-image24.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 保護ドメインをインポートしたら、DRVAアプライアンスを展開します。
+

NOTE: これらの手順は、CPT作成プランを使用して自動化することもできます。

. 使用可能なvSANまたはANFデータストアを使用してレプリケーションログボリュームを作成します。
. 保護ドメインをインポートし、VMの配置にANFデータストアを使用するようにリカバリVAを設定します。
+
image:dr-cvo-avs-image25.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+

NOTE: 選択したセグメントでDHCPが有効になっていて、十分なIPが使用可能であることを確認します。ダイナミックIPは、ドメインのリカバリ中に一時的に使用されます。リカバリVM（連続リハイドレートを含む）ごとに、個別のダイナミックIPが必要です。リカバリの完了後、IPは解放され、再利用できます。

. 適切なフェイルオーバーオプション（継続的フェイルオーバーまたはフェイルオーバー）を選択します。この例では、連続リハイドレート（連続フェールオーバー）が選択されています。
+

NOTE: 設定の実行時には、継続的フェイルオーバーモードとフェイルオーバーモードが異なりますが、両方のフェイルオーバーモードを同じ手順で設定します。フェイルオーバー手順は、災害発生時の対応として一緒に設定および実行されます。継続的フェイルオーバーはいつでも設定でき、通常のシステム運用中はバックグラウンドで実行できます。災害が発生すると、継続的なフェイルオーバーが完了し、保護対象のVMの所有権がリカバリサイトにただちに移行されます（RTOはほぼゼロ）。

+
image:dr-cvo-avs-image26.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



継続的なフェイルオーバープロセスが開始され、UIから進行状況を監視できます。[現在のステップ]セクションの青いアイコンをクリックすると、ポップアップウィンドウが開き、フェイルオーバープロセスの現在のステップの詳細が表示されます。

====
.フェイルオーバーとフェイルバック
[%collapsible]
====
. オンプレミス環境の保護対象クラスタで障害が発生した場合（部分的または完全な障害）、該当するアプリケーションボリュームのSnapMirror関係を解除したあと、Jetstreamを使用してVMのフェイルオーバーをトリガーできます。
+
image:dr-cvo-avs-image27.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:dr-cvo-avs-image28.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+

NOTE: この手順は簡単に自動化できるため、リカバリプロセスが容易になります。

. AVS SDDC（宛先側）上のJetstream UIにアクセスし、フェールオーバーオプションをトリガしてフェールオーバーを完了します。タスクバーにフェイルオーバーアクティビティの進行状況が表示されます。
+
フェイルオーバーが完了したときに表示されるダイアログウィンドウで、フェイルオーバータスクを計画どおりに指定することも、強制的に実行することもできます。

+
image:dr-cvo-avs-image29.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:dr-cvo-avs-image30.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
強制フェイルオーバーでは、プライマリサイトがアクセス不能になり、保護ドメインの所有権がリカバリサイトによって直接引き継がれる必要があります。

+
image:dr-cvo-avs-image31.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:dr-cvo-avs-image32.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 継続的なフェイルオーバーが完了すると、タスクの完了を確認するメッセージが表示されます。タスクが完了したら、リカバリしたVMにアクセスしてiSCSIセッションまたはNFSセッションを設定します。
+

NOTE: フェイルオーバーモードが「Running in Failover」に変わり、VMのステータスが「Recoverable」になります。保護ドメインのすべてのVMが、フェールオーバーランブック設定で指定された状態でリカバリサイトで実行されるようになりました。

+

NOTE: フェールオーバー構成とインフラストラクチャを検証するために、JetStream DRをテストモード（テストフェールオーバーオプション）で実行して、仮想マシンとそのデータをオブジェクトストアからテストリカバリ環境にリカバリすることができます。フェールオーバー手順 がテストモードで実行されると、その動作は実際のフェールオーバープロセスに似ています。

+
image:dr-cvo-avs-image33.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 仮想マシンのリカバリが完了したら、ゲスト内ストレージにストレージディザスタリカバリを使用します。このプロセスを実証するために、この例ではSQL Serverを使用しています。
. AVS SDDCでリカバリしたSnapCenter VMにログインし、DRモードを有効にします。
+
.. browserNを使用してSnapCenter UIにアクセスします。
+
image:dr-cvo-avs-image34.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

.. [設定]ページで、[設定]>[グローバル設定]>[ディザスタリカバリ]の順に選択します。
.. Enable Disaster Recoveryを選択します。
.. 適用をクリックします。
+
image:dr-cvo-avs-image35.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

.. [Monitor]>[Jobs]をクリックして、DRジョブが有効になっているかどうかを確認します。
+

NOTE: ストレージのディザスタリカバリには、NetApp SnapCenter 4.6以降を使用してください。以前のバージョンでは、アプリケーションと整合性のあるSnapshot（SnapMirrorを使用してレプリケート）を使用し、ディザスタリカバリサイトで以前のバックアップをリカバリする必要がある場合に手動でリカバリする必要があります。



. SnapMirror関係が解除されていることを確認します。
+
image:dr-cvo-avs-image36.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. Cloud Volumes ONTAP からリカバリしたSQLゲストVMに、同じドライブレターを使用してLUNを接続します。
+
image:dr-cvo-avs-image37.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. iSCSIイニシエータを開き、以前切断したセッションを消去して、レプリケートされたCloud Volumes ONTAP ボリュームのマルチパスとともに新しいターゲットを追加します。
+
image:dr-cvo-avs-image38.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. DR実行前に使用したのと同じドライブレターを使用して、すべてのディスクが接続されていることを確認してください。
+
image:dr-cvo-avs-image39.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. MSSQLサーバサービスを再起動します。
+
image:dr-cvo-avs-image40.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. SQLリソースがオンラインに戻っていることを確認します。
+
image:dr-cvo-avs-image41.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+

NOTE: NFSの場合は'mountコマンドを使用してボリュームを接続し'/etc/fstabエントリーを更新します

+
この時点で運用を開始し、通常どおり業務を継続できます。

+

NOTE: NSX Tエンドでは'フェイルオーバー・シナリオをシミュレートするために'個別の専用ティア1ゲートウェイを作成できますこれにより、すべてのワークロードが相互に通信できるようになりますが、環境内や環境外にトラフィックをルーティングできないため、トリアージ、封じ込め、セキュリティ強化のタスクをクロスコンタミネーションのリスクなしに実行できます。この操作はこのドキュメントでは扱いませんが、分離をシミュレートするために簡単に行うことができます。



プライマリサイトが起動し、再び実行されるようになったら、フェイルバックを実行できます。VM保護はJetstreamで再開され、SnapMirror関係を反転する必要があります。

. オンプレミス環境をリストア災害のタイプによっては、保護対象クラスタの構成をリストアまたは検証しなければならない場合があります。必要に応じて、JetStream DRソフトウェアを再インストールする必要があります。
. リストアされたオンプレミス環境にアクセスし、Jetstream DR UIに移動して、適切な保護ドメインを選択します。保護サイトがフェイルバックできる状態になったら、UIで[Failback]オプションを選択します。
+

NOTE: CPTによって生成されたフェイルバック計画を使用して、VMとそのデータをオブジェクトストアから元のVMware環境に戻すこともできます。

+
image:dr-cvo-avs-image42.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+

NOTE: リカバリサイトでVMを一時停止して保護対象サイトで再起動したあとの最大遅延時間を指定します。このプロセスには、フェイルオーバーVMを停止したあとのレプリケーションの完了、リカバリサイトのクリーンアップに必要な時間、保護サイトでVMを再作成するのに必要な時間などが含まれます。10分を推奨します。

+
image:dr-cvo-avs-image43.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. フェイルバックプロセスを完了し、VM保護およびデータの整合性が再開されたことを確認する。
+
image:dr-cvo-avs-image44.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. VMのリカバリが完了したら、セカンダリストレージをホストから切断してプライマリストレージに接続します。
+
image:dr-cvo-avs-image45.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:dr-cvo-avs-image46.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. MSSQLサーバサービスを再起動します。
. SQLリソースがオンラインに戻っていることを確認します。
+
image:dr-cvo-avs-image47.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+

NOTE: プライマリストレージにフェイルバックするには、逆再同期処理を実行して、フェイルオーバーの前と同じ関係の方向が維持されていることを確認します。

+

NOTE: 逆再同期処理の実行後もプライマリストレージとセカンダリストレージのロールを保持するには、逆再同期処理をもう一度実行します。



このプロセスは、Oracleなどの他のアプリケーション、類似したデータベースの種類、ゲスト接続ストレージを使用するその他のアプリケーションに適用されます。

常に同様に、重要なワークロードを本番環境に移植する前に、リカバリに必要な手順をテストしてください。

====


== この解決策 の利点

* 効率性と耐障害性に優れたSnapMirrorレプリケーションを使用します。
* ONTAP スナップショットの保持により、利用可能な任意の時点までリカバリします。
* ストレージ、コンピューティング、ネットワーク、アプリケーションの検証から、数百~数千のVMのリカバリに必要なすべての手順を完全に自動化できます。
* SnapCenter では、レプリケートされたボリュームを変更しないクローニングメカニズムが使用されます。
+
** これにより、ボリュームとSnapshotのデータが破損するリスクを回避できます。
** DRテストのワークフロー中にレプリケーションが中断されるのを回避します
** 開発とテスト、セキュリティテスト、パッチとアップグレードのテスト、修正テストなど、DR以外のワークフローにDRデータを活用します。


* CPUとRAMの最適化は、小規模なコンピューティングクラスタへのリカバリを可能にすることで、クラウドコストの削減に役立ちます。

