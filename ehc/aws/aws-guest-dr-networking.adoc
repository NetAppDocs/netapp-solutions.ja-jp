---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-networking.html 
keywords: on premises, client networks, Storage networks, Cloud connectivity, VPN, direct connect, Transit gateway, security groups 
summary: この解決策 では、ネットアップのSyncMirror 処理を実行するために、オンプレミスのONTAP クラスタからAWS FSXへのネットアップONTAP インターコネクトクラスタのネットワークアドレス間の通信が正常に行われている必要があります。また、VeeamバックアップサーバからAWS S3バケットにアクセスできる必要があります。インターネット転送を使用する代わりに、既存のVPNまたはDirect ConnectリンクをS3バケットへのプライベートリンクとして使用できます。 
---
= ネットワーキング
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-requirements.html["以前のバージョン：要件。"]

この解決策 では、ネットアップのSyncMirror 処理を実行するために、オンプレミスのONTAP クラスタからAWS FSXへのネットアップONTAP インターコネクトクラスタのネットワークアドレス間の通信が正常に行われている必要があります。また、VeeamバックアップサーバからAWS S3バケットにアクセスできる必要があります。インターネット転送を使用する代わりに、既存のVPNまたはDirect ConnectリンクをS3バケットへのプライベートリンクとして使用できます。



== オンプレミス

ONTAP は、SAN環境向けのiSCSI、Fibre Channel（FC）、Fibre Channel over Ethernet（FCoE）、Non-Volatile Memory Express over Fibre Channel（NVMe/FC）など、仮想化に使用される主要なストレージプロトコルをすべてサポートしています。ONTAP は、ゲスト接続用にNFS（v3およびv4.1）とSMBまたはS3もサポートしています。環境に最も適したものを自由に選択でき、必要に応じてプロトコルを1つのシステムで組み合わせることができます。たとえば、いくつかのiSCSI LUNまたはゲスト共有でNFSデータストアの一般的な使用を補うことができます。

この解決策 は、ゲストVMDK用にオンプレミスのデータストアにNFSデータストアを利用し、ゲストアプリケーションデータ用にiSCSIとNFSの両方を利用します。



=== クライアントネットワーク

VMkernelネットワークポートとSoftware-Definedネットワークは、ESXiホストとの接続を提供し、VMware環境外の要素との通信を可能にします。接続は、使用するVMkernelインターフェイスのタイプによって異なります。

この解決策 に対して、次のVMkernelインターフェイスが設定されました。

* 管理
* vMotion
* NFS
* iSCSI




=== ストレージネットワークをプロビジョニングしました

LIF （論理インターフェイス）は、クラスタ内のノードへのネットワークアクセスポイントを表します。これにより、クライアントがアクセスするデータを格納するStorage Virtual Machineと通信できるようになります。LIF は、クラスタでネットワーク経由の通信の送受信に使用されるポートに設定できます。

この解決策 では、次のストレージプロトコル用にLIFが設定されます。

* NFS
* iSCSI




== クラウド接続オプション

お客様は、VPNトポロジやDirect Connectトポロジの導入など、オンプレミス環境をクラウドリソースに接続する際に多くのオプションを選択できます。



=== 仮想プライベートネットワーク（VPN）

VPN（バーチャルプライベートネットワーク）は、多くの場合、インターネットベースまたはプライベートMPLSネットワークを使用したセキュアなIPSecトンネルの作成に使用されます。VPNのセットアップは簡単ですが、信頼性（インターネットベースの場合）と速度が不足しています。エンドポイントは、AWS VPCまたはVMware Cloud SDDCで終了できます。このディザスタリカバリ解決策 用に、オンプレミスネットワークからNetApp ONTAP 用のAWS FSXへの接続を作成しました。そのため、NetApp ONTAP 向けFSXが接続されているAWS VPC（Virtual Private GatewayまたはTransit Gateway）で終端できます。

VPN設定は、ルートベースまたはポリシーベースのいずれかです。ルートベースの設定では、エンドポイントは自動的にルートを交換し、セットアップは新しく作成されたサブネットへのルートを学習します。ポリシーベースの設定では、ローカルサブネットとリモートサブネットを定義する必要があります。また、新しいサブネットが追加され、IPSecトンネル内で通信が許可される場合は、ルートを更新する必要があります。


NOTE: IPSec VPNトンネルがデフォルトゲートウェイ上に作成されていない場合、リモートネットワークルートはローカルVPNトンネルエンドポイントを介してルートテーブルに定義する必要があります。

次の図に、一般的なVPN接続オプションを示します。

image:dr-vmc-aws-image3.png["エラー：グラフィックイメージがありません"]



=== Direct Connect（直接接続）

Direct ConnectはAWSネットワークへの専用リンクを提供します。専用接続では、1Gbps、10Gbps、または100Gbpsのイーサネットポートを使用してAWSへのリンクを作成します。AWS Direct Connectパートナーは、自社とAWSの間に確立されたネットワークリンクを使用してホスト接続を提供します。この接続は50MBpsから10Gbpsまで提供されます。デフォルトでは、トラフィックは暗号化されません。ただし、MACsecまたはIPsecを使用してトラフィックを保護するためのオプションが用意されています。MACsecはレイヤ2暗号化を提供し、IPsecはレイヤ3暗号化を提供します。MACsecでは、通信するデバイスを秘匿することで、より優れたセキュリティを実現します。

お客様のルータ機器がAWS Direct Connectの場所にある。この設定を行うには、AWSパートナーネットワーク（APN）を使用します。このルータとAWSルータの間に物理的な接続が確立されます。VPC上のNetApp ONTAP のFSXへのアクセスを有効にするには、Direct ConnectからVPCへのプライベート仮想インターフェイスまたはトランジット仮想インターフェイスが必要です。プライベート仮想インターフェイスでは、VPCへのDirect Connectの拡張性に制限があります。

次の図は、Direct Connectインターフェイスオプションを示しています。

image:dr-vmc-aws-image4.png["エラー：グラフィックイメージがありません"]



=== トランジットゲートウェイ

トランジットゲートウェイはリージョンレベルの構造で、リージョン内のDirect Connect-to-VPC接続のスケーラビリティを向上させることができます。クロスリージョン接続が必要な場合は、中継ゲートウェイをピアリングする必要があります。詳細については、を参照してください https://docs.aws.amazon.com/directconnect/latest/UserGuide/Welcome.html["AWS Direct Connectのドキュメント"^]。



== クラウドネットワークに関する考慮事項

クラウドでは、基盤となるネットワークインフラはクラウドサービスプロバイダによって管理されますが、お客様はAWSでVPCネットワーク、サブネット、ルーティングテーブルなどを管理する必要があります。また、コンピューティングエッジでNSXネットワークセグメントを管理する必要があります。SDDCグループは、外部VPCとトランジット接続のルートをグループ化します。

VMware Cloudに接続されたVPCにFSX for NetApp ONTAP with Multi-AZ Availabilityが導入されている場合、iSCSIトラフィックは、通信を有効にするために必要なルートテーブルの更新を受信します。デフォルトでは、VMware Cloudから、接続されたVPC上のFSX ONTAP NFS/SMBサブネットへの、複数AZ環境用のルートはありません。そのルートを定義するために、VMware Cloud SDDCグループを使用しました。このグループはVMwareが管理する中継ゲートウェイであり、同じリージョン内のVMware Cloud SDDCと外部VPCおよびその他のトランジットゲートウェイとの間の通信を可能にします。


NOTE: トランジットゲートウェイの使用に関連するデータ転送コストがあります。地域固有のコストの詳細については、を参照してください https://aws.amazon.com/transit-gateway/pricing/["リンクをクリックしてください"^]。

VMware Cloud SDDCは、単一のアベイラビリティゾーンに導入できます。これは、単一のデータセンターのようなものです。ストレッチクラスタオプションも使用できます。これは、可用性を高め、アベイラビリティゾーンに障害が発生した場合のダウンタイムを短縮できるNetApp MetroCluster 解決策 のようなオプションです。

データ転送コストを最小限に抑えるには、VMware Cloud SDDCとAWSのインスタンスまたはサービスを同じアベイラビリティゾーンに配置します。AWSでは、アカウントに固有のAZオーダーリストを用意して複数のアベイラビリティゾーンに負荷を分散するため、名前ではなくアベイラビリティゾーンIDと照合することを推奨します。たとえば、あるアカウント（US-East-1a）がAZ ID 1を指しているのに対し、別のアカウント（US-East-1c）がAZ ID 1を指している場合があります。アベイラビリティゾーンIDはいくつかの方法で取得できます。次の例は、VPCサブネットからAZ IDを取得します。

image:dr-vmc-aws-image5.png["エラー：グラフィックイメージがありません"]

VMware Cloud SDDCでは、ネットワークはNSXで管理され、南北トラフィックのアップリンクポートを処理するエッジゲートウェイ（Tier-0ルータ）はAWS VPCに接続されます。コンピュートゲートウェイと管理ゲートウェイ（ティア1ルータ）は、イーストウェストトラフィックを処理します。エッジのアップリンクポートが頻繁に使用されるようになった場合は、トラフィックグループを作成して特定のホストIPまたはサブネットに関連付けることができます。トラフィックグループを作成すると、トラフィックを分離するためのエッジノードが追加で作成されます。を確認します https://docs.vmware.com/en/VMware-Cloud-on-AWS/services/com.vmware.vmc-aws-networking-security/GUID-306D3EDC-F94E-4216-B306-413905A4A784.html["VMware のドキュメント"^] マルチエッジセットアップを使用するために必要なvSphereホストの最小数。



=== クライアントネットワーク

VMware Cloud SDDCをプロビジョニングすると、VMkernelポートが設定済みで、使用可能な状態になります。これらのポートはVMwareで管理されるため、更新は不要です。

次の図は、ホストVMkernel情報の例を示しています。

image:dr-vmc-aws-image6.png["エラー：グラフィックイメージがありません"]



=== ストレージネットワークのプロビジョニング（iSCSI、NFS）

VMゲストストレージネットワークについては、通常はポートグループを作成します。NSXを使用すると、vCenter上でポートグループとして使用されるセグメントを作成できます。ストレージネットワークはルーティング可能なサブネットにあるため、別々のネットワークセグメントを作成することなく、デフォルトのNICを使用してLUNにアクセスしたりNFSエクスポートをマウントしたりできます。ストレージトラフィックを分離するには、追加のセグメントを作成し、ルールを定義し、それらのセグメントのMTUサイズを制御します。フォールトトレランスを実現するためには、ストレージネットワーク専用のセグメントを少なくとも2つ用意することを推奨します。前述したように、アップリンク帯域幅が問題 になると、トラフィックグループを作成し、IPプレフィックスとゲートウェイを割り当てて、送信元ベースルーティングを実行できます。

フェイルオーバー時にネットワークセグメントがマッピングされるのを推測しないように、DR SDDCのセグメントをソース環境と照合することを推奨します。



=== セキュリティグループ

多くのセキュリティオプションで、AWS VPCとVMware Cloud SDDCネットワーク上のセキュアな通信が提供されます。VMware Cloud SDDCネットワーク内では、NSXトレースフローを使用してパスを識別できます。これには、使用するルールも含まれます。その後、VPCネットワークのネットワークアナライザを使用して、フロー中に消費されるルーティングテーブル、セキュリティグループ、ネットワークアクセス制御リストなどのパスを特定できます。

link:aws-guest-dr-storage.html["次：ストレージ。"]
