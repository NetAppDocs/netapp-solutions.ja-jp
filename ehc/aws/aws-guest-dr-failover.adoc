---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-failover.html 
keywords: Disaster, primary site, SnapCenter, database, restore process, 
summary: プライマリオンプレミスのデータセンターで災害が発生した場合のシナリオとして、AWSでVMware Cloudを使用して、Amazon Web Servicesインフラにあるセカンダリサイトへのフェイルオーバーがあります。仮想マシンとオンプレミスのONTAP クラスタにはアクセスできなくなると仮定しています。また、SnapCenter とVeeamの仮想マシンはどちらもアクセスできなくなり、2次サイトで再構築する必要があります。 
---
= フェイルオーバー
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-snapcenter-db-backup.html["Previous：ディザスタリカバリ用のSnapCenter データベースバックアップ。"]



== 災害はプライマリサイトで発生します

プライマリオンプレミスのデータセンターで災害が発生した場合のシナリオとして、AWSでVMware Cloudを使用して、Amazon Web Servicesインフラにあるセカンダリサイトへのフェイルオーバーがあります。仮想マシンとオンプレミスのONTAP クラスタにはアクセスできなくなると仮定しています。また、SnapCenter とVeeamの仮想マシンはどちらもアクセスできなくなり、2次サイトで再構築する必要があります。

このセクションでは、インフラからクラウドへのフェイルオーバーについて説明します。ここでは、次のトピックについて説明します。

* SnapCenter データベースのリストア：新しいSnapCenter サーバが確立されたら、MySQLデータベースと構成ファイルをリストアし、データベースをディザスタリカバリモードに切り替えて、セカンダリFSXストレージをプライマリストレージデバイスにします。
* Veeam Backup & Replicationを使用してアプリケーション仮想マシンをリストアします。VMバックアップを含むS3ストレージを接続し、バックアップをインポートして、AWS上のVMware Cloudにリストアします。
* SnapCenter を使用してSQL Serverアプリケーションデータをリストアします。
* SnapCenter を使用してOracleアプリケーションのデータをリストアします。




== SnapCenter データベースのリストアプロセス

SnapCenter では、MySQLデータベースおよび構成ファイルのバックアップとリストアが可能なため、ディザスタリカバリのシナリオがサポートされます。これにより、管理者はSnapCenter データベースの定期的なバックアップをオンプレミスのデータセンターで保持し、そのデータベースをセカンダリSnapCenter データベースにリストアすることができます。

リモートSnapCenter サーバ上のSnapCenter バックアップファイルにアクセスするには、次の手順を実行します。

. ボリュームを読み取り/書き込み可能にするFSXクラスタからSnapMirror関係を解除します。
. 必要に応じてCIFSサーバを作成し、クローニングされたボリュームのジャンクションパスを参照するCIFS共有を作成します。
. xcopyを使用して、セカンダリSnapCenter システムのローカルディレクトリにバックアップファイルをコピーします。
. SnapCenter v4.6をインストールします。
. SnapCenter サーバのFQDNが元のサーバと同じであることを確認します。これは、データベースのリストアを正常に実行するために必要です。


リストア・プロセスを開始するには、次の手順を実行します。

. セカンダリSnapCenter サーバのSwagger API Webページに移動し、前述の手順に従って認証トークンを取得します。
. Swaggerページの[Disaster Recovery]セクションに移動し、[0/4.6/disasterrecovery/sa/restore]を選択して、[Try it out]をクリックします。
+
image:dr-vmc-aws-image48.png["エラー：グラフィックイメージがありません"]

. 認証トークンに貼り付けて、SmDRRestarterRequestセクションで、バックアップ名とセカンダリSnapCenter サーバのローカルディレクトリに貼り付けます。
+
image:dr-vmc-aws-image49.png["エラー：グラフィックイメージがありません"]

. Executeボタンを選択して'リストア・プロセスを開始します
. SnapCenter で、監視セクションに移動してリストアジョブの進捗状況を確認します。
+
image:dr-vmc-aws-image50.png["エラー：グラフィックイメージがありません"]

+
image:dr-vmc-aws-image51.png["エラー：グラフィックイメージがありません"]

. セカンダリストレージからのSQL Serverのリストアを有効にするには、SnapCenter データベースをディザスタリカバリモードに切り替える必要があります。この処理は、Swagger API Webページで個別の処理として開始されます。
+
.. [Disaster Recovery]セクションに移動し'[/4.6/disasterrecovery/storage]をクリックします
.. ユーザー認証トークンに貼り付けます。
.. SmSetDisasterRecoverySettingsRequestセクションで'EnableDisasterRecoverを'true'に変更します
.. Executeをクリックして'SQL Serverの災害復旧モードを有効にします
+
image:dr-vmc-aws-image52.png["エラー：グラフィックイメージがありません"]

+

NOTE: 追加手順に関するコメントを参照してください。





link:aws-guest-dr-restore-veeam-full.html["次の手順：Veeamのフルリストアを使用して、アプリケーションVMをリストアします。"]
