---
sidebar: sidebar 
permalink: containers/rh-os-n_openshift_RHV.html 
keywords: Red Hat Virtualization, OpenShift, RHV 
summary: RHV は、 Red Hat Enterprise Linux （ RHEL ）上で動作し、 KVM ハイパーバイザーを使用するエンタープライズ仮想データセンタープラットフォームです。 
---
= Red Hat 仮想化を基盤とした OpenShift
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Red Hat Virtualization （ RHV ）は、 Red Hat Enterprise Linux （ RHEL ）で実行され、 KVM ハイパーバイザーを使用するエンタープライズ仮想データセンタープラットフォームです。

RHVの詳細については、を参照してくださいlink:https://www.redhat.com/en/technologies/virtualization/enterprise-virtualization["Red Hat Virtualization の Web サイト"^]。

RHV は以下の機能を提供します。

* *仮想マシンとホストの一元管理* RHVマネージャは、導入環境内で物理マシンまたは仮想マシン（VM）として実行され、中央インターフェイスから解決策を管理するためのWebベースのGUIを提供します。
* *自己ホスト型エンジン*ハードウェア要件を最小限に抑えるために、RHV Manager（RHV-M）をゲストVMを実行するホスト上にVMとして導入できます。
* *高可用性*ホストで障害が発生した場合の中断を回避するために、RHVではVMを高可用性用に構成できます。高可用性 VM は、耐障害性ポリシーを使用してクラスタレベルで制御されます。
* *高い拡張性* 1つのRHVクラスタに最大200のハイパーバイザホストを配置できるため、IT部門は大規模なVMの要件をサポートし、リソースを大量に消費するエンタープライズクラスのワークロードをホストできます。
* *強化されたセキュリティ* RHVから継承された、Secure Virtualization（sVirt）およびSecurity Enhanced Linux（SELinux）テクノロジーは、ホストおよびVMの高度なセキュリティと強化を目的として、RHVに採用されています。これらの機能の主なメリットは、 VM とそれに関連するリソースを論理的に分離できることです。


image:redhat_openshift_image3.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



== ネットワーク設計

NetApp 解決策上の Red Hat OpenShift では、 2 つのデータスイッチを使用して 25Gbps でプライマリデータ接続を提供します。また、ストレージノードのインバンド管理用に 1Gbps で接続を提供する管理スイッチを 2 台追加し、 IPMI 機能用にアウトオブバンド管理を使用します。OCP は、クラスタ管理に RHV 上の仮想マシン論理ネットワークを使用します。このセクションでは、解決策で使用される各仮想ネットワークセグメントの配置と目的について説明し、解決策を導入するための前提条件について説明します。



=== VLANの要件

RHV 上の Red Hat OpenShift は、仮想ローカルエリアネットワーク（ VLAN ）を使用して、さまざまな目的でネットワークトラフィックを論理的に分離するように設計されています。この構成は、お客様のニーズに合わせて拡張することも、特定のネットワークサービスをさらに分離することもできます。次の表に、ネットアップで解決策を検証する際に解決策を実装するために必要な VLAN を示します。

[cols="40%, 40%, 20%"]
|===
| VLAN | 目的 | VLAN ID 


| アウトオブバンド管理ネットワーク | 物理ノードと IPMI の管理 | 16 


| VM ネットワーク | 仮想ゲストネットワークアクセス | 1172 


| インバンド管理ネットワーク | RHV-H ノード、 RHV-Manager 、および ovirtmgmt ネットワークの管理 | 3343 


| ストレージネットワーク | NetApp Element iSCSI 用のストレージネットワーク | 3344 


| 移行用ネットワーク | 仮想ゲスト移行用のネットワーク | 3345 
|===


=== ネットワークインフラストラクチャサポートリソース

OpenShift Container Platform を導入する前に、次のインフラを用意する必要があります。

* インバンド管理ネットワークと VM ネットワークからアクセス可能な完全なホスト名解決を提供する DNS サーバが少なくとも 1 台必要です。
* インバンド管理ネットワークおよび VM ネットワークからアクセスできる NTP サーバが少なくとも 1 台必要です。
* （オプション）インバンド管理ネットワークと VM ネットワークの両方のアウトバウンドインターネット接続。




== 本番環境の導入に関するベストプラクティス

このセクションでは、この解決策を本番環境に導入する前に考慮する必要があるベストプラクティスをいくつか紹介します。



=== 少なくとも 3 つの RHV クラスタに OpenShift を導入します ノード

このドキュメントで説明する検証済みのアーキテクチャは、 2 つの RHV-H ハイパーバイザーノードを導入し、ホスト型エンジンと導入済み VM を両方のホストで管理して 2 つのハイパーバイザー間で移行できるフォールトトレラントな構成を確保することによって、 HA 処理に適した最小限のハードウェア導入を示しています。

Red Hat OpenShift は最初に 3 つのマスターノードで導入するため、 2 ノード構成で少なくとも 2 つのマスターが同じノードを占有します。そのため、特定のノードが使用できなくなった場合に OpenShift が停止する可能性があります。そのため、解決策の一部として少なくとも 3 つの RHV - H ハイパーバイザーノードを導入して、 OpenShift マスターを均等に分散できるようにし、解決策にさらにフォールトトレランスを追加することが Red Hat のベストプラクティスです。



=== 仮想マシンとホストのアフィニティを設定します

VM とホストのアフィニティを有効にすると、 OpenShift マスターを複数のハイパーバイザーノードに分散できます。

アフィニティとは、 VM やホストのセットに対してルールを定義する方法で、グループ内の同じホストで複数の VM が実行されるか、別々のホストで実行されるかを決定します。VM とホストで構成されるアフィニティグループを作成することで、 VM に適用されます。このアフィニティグループには同じパラメータと条件が設定されます。アフィニティグループ内の VM がグループ内の同じホストで実行されているのか、または別々のホストで実行されているのかに応じて、アフィニティグループのパラメータでは正のアフィニティまたは負のアフィニティを定義できます。

パラメータに定義された条件は、強制またはソフト強制のいずれかです。強制をハードに行うことで、アフィニティグループ内の VM は、外部条件に関係なく常に正または負のアフィニティに従って配置されます。ソフトな適用では、可能なかぎり、アフィニティグループ内の VM に対して肯定的または否定的なアフィニティに従って高い優先度が設定されます。このドキュメントで説明する 2 つまたは 3 つのハイパーバイザー構成では、ソフトアフィニティが推奨される設定です。大規模なクラスタでは、ハードアフィニティによって OpenShift ノードを適切に分散できます。

アフィニティグループを設定するには、を参照してくださいlink:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html/virtual_machine_management_guide/sect-affinity_groups["Red Hat 6.11アフィニティグループのドキュメント"^]。



=== OpenShift 環境にカスタムインストールファイルを使用します

IPI を使用すると、このドキュメントで前述した対話型ウィザードを使用して、 OpenShift クラスタを簡単に導入できます。ただし、一部のデフォルト値については、クラスタの導入時に変更が必要になる場合があります。

このような場合は、クラスタをすぐに導入せずにウィザードを実行してタスクを実行できます。クラスタの導入に使用する構成ファイルが作成されます。これは、 IPI のデフォルト値を変更する場合や、マルチテナンシーなどの他の用途のために環境内に同一のクラスタを複数導入する場合に非常に便利です。OpenShift用にカスタマイズされたインストール構成を作成する方法の詳細については、を参照してくださいlink:https://docs.openshift.com/container-platform/4.4/installing/installing_rhv/installing-rhv-customizations.html["Red Hat OpenShift カスタマイズを使用した RHV へのクラスタのインストール"^]。
