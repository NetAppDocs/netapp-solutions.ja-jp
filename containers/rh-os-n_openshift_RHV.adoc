---
sidebar: sidebar 
permalink: containers/rh-os-n_openshift_RHV.html 
keywords: Red Hat Virtualization, OpenShift, RHV 
summary:  
---
= Red Hat 仮想化での OpenShift ：ネットアップでの Red Hat OpenShift
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
RHV は、 Red Hat Enterprise Linux （ RHEL ）上で動作し、 KVM ハイパーバイザーを使用するエンタープライズ仮想データセンタープラットフォームです。

RHV の詳細については、を参照してください https://www.redhat.com/en/technologies/virtualization/enterprise-virtualization["Red Hat Virtualization の Web サイト"^]。



=== RHV は以下の機能を提供します。

* * 仮想マシンとホストの一元管理。 * RHV マネージャは、導入環境内で物理マシンまたは仮想マシン（ VM ）として動作し、中央インターフェイスから解決策を管理するための Web ベースの GUI を提供します。
* * 自己ホスト型エンジン。 * ハードウェア要件を最小限に抑えるため、 RHV によって、ゲスト VM を実行するホスト上の VM として RHV マネージャ（ RHV-M ）を導入することができます。
* * 高可用性。 * ホスト障害が発生しても、システム停止を回避するために、 RHV を使用することで、 VM を高可用性に設定することができます。高可用性 VM は、耐障害性ポリシーを使用してクラスタレベルで制御されます。
* * 高い拡張性。 * 1 つの RHV クラスタで最大 200 台のハイパーバイザホストを使用できるため、 IT 部門は大量の VM で大量のリソースを消費するエンタープライズクラスのワークロードを処理する必要に対応できます。
* * セキュリティ強化。 *RHV 、セキュア仮想化（ sVirt ）、およびセキュリティ強化 Linux （ SELinux ）テクノロジーから継承されたものは、セキュリティの強化とホストおよび VM の強化を目的として RHV によって採用されています。これらの機能の主なメリットは、 VM とそれに関連するリソースを論理的に分離できることです。


image:redhat_openshift_image3.png["エラー：グラフィックイメージがありません"]



=== ネットワーク設計

NetApp 解決策上の Red Hat OpenShift では、 2 つのデータスイッチを使用して 25Gbps でプライマリデータ接続を提供します。また、ストレージノードのインバンド管理用に 1Gbps で接続を提供する管理スイッチをさらに 2 台使用し、 IPMI 機能のアウトオブバンド管理も行います。OCP は、クラスタ管理に RHV 上の仮想マシン論理ネットワークを使用します。このセクションでは、解決策で使用される各仮想ネットワークセグメントの配置と目的について説明し、解決策を導入するための前提条件を概説します。



==== VLAN の要件

RHV 上の Red Hat OpenShift は、仮想ローカルエリアネットワーク（ VLAN ）を使用して、さまざまな目的でネットワークトラフィックを論理的に分離するように設計されています。この構成は、お客様のニーズに合わせて拡張することも、特定のネットワークサービスをさらに分離することもできます。次の表に、ネットアップで解決策を検証する際に解決策を実装するために必要な VLAN を示します。

|===
| VLAN | 目的 | VLAN ID 


| アウトオブバンド管理ネットワーク | 物理ノードと IPMI の管理 | 16 


| VM ネットワーク | Virtual Guest Network Access の略 | 1172 


| インバンド管理ネットワーク | RHV-H ノード、 RHV-Manager 、 ovirtmgmt ネットワークの管理 | 3343 


| ストレージネットワーク | NetApp Element iSCSI 用のストレージネットワーク | 344 


| 移行用ネットワーク | 仮想ゲスト移行用のネットワーク | 3345 
|===


==== ネットワークインフラストラクチャサポートリソース

OpenShift Container Platform を導入する前に、次のインフラを用意する必要があります。

* インバンド管理ネットワークおよび VM ネットワークからアクセス可能な完全なホスト名解決を提供する DNS サーバが少なくとも 1 台あります。
* インバンド管理ネットワークおよび VM ネットワークからアクセスできる NTP サーバが少なくとも 1 台必要です。
* （オプション）インバンド管理ネットワークと VM ネットワークの両方のアウトバウンドインターネット接続。




=== 本番環境の導入に関するベストプラクティス

このセクションでは、この解決策を本番環境に導入する前に考慮する必要があるベストプラクティスをいくつか紹介します。



==== 少なくとも 3 つの RHV クラスタに OpenShift を導入する ノード

このドキュメントで説明する検証済みのアーキテクチャは、 2 つの RHV-H ハイパーバイザーノードを導入し、ホスト型エンジンと導入済み VM を両方のホストで管理して 2 つのハイパーバイザー間で移行できるフォールトトレラントな構成を確保することによって、 HA 処理に適した最小限のハードウェア導入を示しています。

Red Hat OpenShift は最初に 3 つのマスターノードで導入するため、 2 ノード構成で少なくとも 2 つのマスターが同じノードを占有します。そのため、特定のノードが使用できなくなった場合に OpenShift が停止する可能性があります。そのため、解決策の一部として少なくとも 3 つの RHV - H ハイパーバイザーノードを導入して、 OpenShift マスターを均等に分散できるようにし、解決策にさらにフォールトトレランスを追加することが Red Hat のベストプラクティスです。



==== 仮想マシンとホストのアフィニティを設定します

VM とホストのアフィニティを有効にすることで、複数のハイパーバイザーノードに OpenShift マスターを確実に分散させることができます。

アフィニティとは、 VM やホストのセットに対してルールを定義する方法で、グループ内の同じホストで複数の VM が実行されるか、別々のホストで実行されるかを決定します。VM とホストで構成されるアフィニティグループを作成することで、 VM に適用されます。このアフィニティグループには同じパラメータと条件が設定されます。アフィニティグループ内の VM がグループ内の同じホストで実行されているのか、または別々のホストで実行されているのかに応じて、アフィニティグループのパラメータでは正のアフィニティまたは負のアフィニティを定義できます。

パラメータに定義された条件は、強制またはソフト強制のいずれかです。強制を強く行うことで、アフィニティグループ内の VM は、外部条件に関係なく常に正 / 負のアフィニティに従って配置されます。一方、ソフトな適用では、アフィニティグループ内の VM が可能なかぎり肯定的または否定的なアフィニティに従っている場合に、より高い優先度が設定されます。このドキュメントで説明する 2 つまたは 3 つのハイパーバイザー構成では、推奨設定はソフトアフィニティです。大規模なクラスタでは、 OpenShift ノードの分散を確保するためにハードアフィニティを利用できます。

アフィニティグループを設定するには、を参照してください https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html/virtual_machine_management_guide/sect-affinity_groups["Red Hat 6.11アフィニティグループのドキュメント"^]。



==== OpenShift Deployment にカスタムインストールファイルを使用します

IPI を使用すると、このドキュメントで前述した対話型ウィザードを使用して、 OpenShift クラスタを簡単に導入できます。ただし、一部のデフォルト値については、クラスタの導入時に変更が必要になる場合があります。

このような場合、クラスタをすぐに導入せずにウィザードを実行してタスクを割り当てることができますが、あとでクラスタを導入できる構成ファイルを出力する必要はありません。これは、任意の IPI デフォルトを変更する必要がある場合や、マルチテナンシーなどの他の用途のために、同一のクラスタを環境内に複数導入する必要がある場合に非常に便利です。OpenShift 用にカスタマイズされたインストール構成の作成の詳細については、を参照してください https://docs.openshift.com/container-platform/4.4/installing/installing_rhv/installing-rhv-customizations.html["Red Hat OpenShift カスタマイズを使用した RHV へのクラスタのインストール"^]。

link:rh-os-n_overview_netapp.html["次：ネットアップストレージの概要"]
