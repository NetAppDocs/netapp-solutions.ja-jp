---
sidebar: sidebar 
permalink: containers/a-w-n_anthos_VMW.html 
keywords: Anthos, VMware vSphere, ESXi, on_prem 
summary: VMware vSphere は、 ESXi ハイパーバイザー上で実行される多数の仮想サーバとネットワークを一元管理するための仮想化プラットフォームです。 
---
= VMware上のAnthosクラスタ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
VMware上のAnthosクラスタは、エンドユーザのプライベートデータセンターに導入されているGoogle Kubernetes Engineの拡張機能です。組織は、オンプレミスのKubernetesクラスタ内のGoogle Cloud内のコンテナで実行するように設計されたものと同じアプリケーションを導入できます。VMware上のAnthosクラスタは、データセンター内の既存のVMware vSphere環境に導入できます。これにより、資本コストを削減し、導入と拡張の処理をより迅速に実行できます。

VMware環境にAnthosクラスタを導入するには、次のコンポーネントが必要です。

* * Anthos管理ワークステーション*コマンドと `kubectl`コマンドを実行してAnthosデプロイメントをデプロイし、操作できるデプロイメントホスト `gkectl`。
* *管理クラスタ*VMwareでAnthosクラスタをセットアップする際に導入される最初のクラスタ。このクラスタは、導入、拡張、アップグレードなど、下位のユーザクラスタ操作をすべて管理します。
* *ユーザクラスタ*各ユーザクラスタは、独自のロードバランサインスタンスまたはパーティションを使用して導入されるため、個 々 のユーザまたはグループのスタンドアロンKubernetesクラスタとして機能し、フルマルチテナンシーの実現に役立ちます。


次の図は、VMware環境のAnthos-clusters-onの概要 を示しています。

image:a-w-n_anthos_controlplanev2_vm_architecture.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



== メリット

VMware上のAnthosクラスタには次のようなメリットがあります。

* *高度なマルチテナンシー*各エンドユーザに独自のユーザクラスタを割り当て、独自の開発環境に必要な仮想リソースを使用して導入できます。
* *コスト削減*エンドユーザは、Google Cloud環境や大規模なベアメタルクラスタにリソースをプロビジョニングする代わりに、複数のユーザクラスタを同じ物理環境に導入し、アプリケーションの導入に独自の物理リソースを使用することで、大幅なコスト削減を実現できます。
* *開発して公開します。*オンプレミス環境は、アプリケーションの開発中に使用できます。これにより、クラウドで一般に公開される前に、ローカルデータセンターのプライバシーでアプリケーションをテストできます。
* *セキュリティ要件*セキュリティに関する懸念が高まっているお客様や、パブリッククラウドに保存できない機密データセットがあるお客様は、自社のデータセンターのセキュリティからアプリケーションを実行できるため、組織の要件を満たすことができます。




== VMware vSphere

VMware vSphere は、 ESXi ハイパーバイザー上で実行される多数の仮想サーバとネットワークを一元管理するための仮想化プラットフォームです。

VMware vSphereの詳細については、を参照して https://www.vmware.com/products/vsphere.html["VMware vSphere の Web サイト"^]ください。

VMware vSphere には次の機能があります。

* * VMware vCenter Server *VMware vCenter Serverでは、1つのコンソールからすべてのホストとVMを統合的に管理でき、クラスタ、ホスト、およびVMのパフォーマンス監視を集約できます。
* * VMware vSphere vMotion *VMware vCenterでは、要求に応じてシステムを停止せずにクラスタ内のノード間でVMをホット移行できます。
* * vSphereの高可用性*ホストで障害が発生した場合のシステム停止を回避するために、VMware vSphereではホストをクラスタ化し、高可用性を実現するように構成できます。ホストの障害によってシステムが停止した VM は、クラスタ内の他のホストでまもなくリブートされ、サービスがリストアされます。
* * Distributed Resource Scheduler（DRS）*VMware vSphereクラスタは、ホストしているVMのリソースニーズを負荷分散するように設定できます。リソース競合のある VM は、十分なリソースを使用できるように、クラスタ内の他のノードにホット移行できます。




== ハードウェア要件



=== コンピューティング

Google Cloudは、Anthos Readyプラットフォームパートナープログラムを通じて、新しいリリースのAnthosを使用したパートナーサーバプラットフォームの更新検証を定期的に要求しています。現在検証されているサーバプラットフォームとサポートされているAnthosのバージョンの一覧を参照 https://cloud.google.com/anthos/docs/resources/partner-platforms["ここをクリック"^]できます。



=== オペレーティングシステム

VMware上のAnthosクラスタは、お客様の現在のデータセンターインフラに合わせて、vSphere 7環境とvSphere 8環境のどちらにも導入できます。

次の表に、ネットアップとパートナーが解決策 の検証に使用したvSphereのバージョンを示します。

|===


| オペレーティングシステム | リリース | Anthosのバージョン 


| vCenter | 8.0.1 | 1.28 
|===


=== 追加のハードウェア

ネットアップをフル検証済みの解決策 として導入したAnthosには、ネットアップとパートナーのエンジニアによって、ネットワークとストレージ用のデータセンターコンポーネントが追加でテストされています。

次の表に、これらの追加インフラコンポーネントに関する情報を示します。

|===
| メーカー | ハードウェアコンポーネント 


| メラノックス | スイッチ（データネットワーク） 


| Cisco | スイッチ（管理ネットワーク） 


| NetApp | AFF ストレージシステム 
|===


=== 追加のソフトウェア

次の表に、検証環境で導入されたソフトウェアバージョンの一覧を示します。

|===


| メーカー | Software Name（ソフトウェア名） | バージョン 


| NetApp | ONTAP | 9.12.1 


| NetApp | Trident | 24.02.0 
|===
ネットアップが実施したAnthos Readyプラットフォームの検証では、次の図に基づいてラボ環境を構築し、さまざまなNetApp ONTAP ストレージバックエンドを使用して複数のシナリオをテストできました。

image:a-w-n_anthos-128-vsphere8_validation.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



=== ネットワークインフラストラクチャサポートリソース

Anthosを導入する前に、以下のインフラを導入する必要があります。

* インバンド管理ネットワークと VM ネットワークからアクセス可能な完全なホスト名解決を提供する DNS サーバが少なくとも 1 台必要です。
* インバンド管理ネットワークおよび VM ネットワークからアクセスできる NTP サーバが少なくとも 1 台必要です。
* クラスタを動的に拡張する必要がある場合に、ネットワークアドレスのリースをオンデマンドで提供するために使用できるDHCPサーバ。
* （オプション）インバンド管理ネットワークと VM ネットワークの両方のアウトバウンドインターネット接続。




== 本番環境の導入に関するベストプラクティス

このセクションでは、この解決策を本番環境に導入する前に考慮する必要があるベストプラクティスをいくつか紹介します。



=== Anthosは、3ノード以上のESXiクラスタに導入します

Anthosは、デモや評価用に3ノード未満のvSphereクラスタにインストールすることは可能ですが、本番環境のワークロードには推奨されません。2つのノードでは基本的なHAとフォールトトレランスを実現できますが、デフォルトのホストアフィニティを無効にするようにAnthosクラスタ構成を変更する必要があります。この導入方法はGoogle Cloudではサポートされていません。



=== 仮想マシンとホストのアフィニティを設定します

Anthosクラスタノードを複数のハイパーバイザーノードに分散するには、VMとホストのアフィニティを有効にします。

アフィニティまたは非アフィニティは、 VM やホストのセットに対してルールを定義する方法で、グループ内の同じホストまたはホスト上で VM を一緒に実行するか、別のホスト上で実行するかを決定します。VM とホストで構成されるアフィニティグループを作成することで、 VM に適用されます。このアフィニティグループには同じパラメータと条件が設定されます。アフィニティグループ内の VM がグループ内の同じホストで実行されているのか、または別々のホストで実行されているのかに応じて、アフィニティグループのパラメータでは正のアフィニティまたは負のアフィニティを定義できます。

アフィニティグループを設定するには、使用しているVMware vSphereのバージョンに応じた以下の該当するリンクを参照してください。

https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.resmgmt.doc/GUID-FF28F29C-8B67-4EFF-A2EF-63B3537E6934.html["vSphere 6.7のドキュメント：「Using DRS Affinity Rules"^]です。https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.resmgmt.doc/GUID-FF28F29C-8B67-4EFF-A2EF-63B3537E6934.html["vSphere 7.0のドキュメント：「Using DRS Affinity Rules"^]です。


NOTE: Anthosには個 々 のファイルにconfigオプションがあり `cluster.yaml`、ノードアフィニティルールが自動的に作成されます。このルールは環境内のESXiホストの数に基づいて有効または無効にできます。
