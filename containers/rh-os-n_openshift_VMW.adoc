---
sidebar: sidebar 
permalink: containers/rh-os-n_openshift_VMW.html 
keywords: OpenShift, VMware vSphere, ESXi 
summary:  
---
= VMware vSphere 上の OpenShift ：ネットアップを使用した Red Hat OpenShift
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
VMware vSphere は、 ESXi ハイパーバイザー上で実行される多数の仮想サーバとネットワークを一元管理するための仮想化プラットフォームです。

VMware vSphere の詳細については、を参照してください https://www.vmware.com/products/vsphere.html["VMware vSphere の Web サイト"^]。



=== VMware vSphere には次の機能があります。

* * VMware vCenter Server* VMware vCenter Server は、 1 つのコンソールからすべてのホストと VM を統合管理し、クラスタ、ホスト、 VM のパフォーマンス監視を集約します。
* * VMware vSphere vMotion * VMware vCenter は、無停止でユーザーの要求に応じて、クラスタ内のノード間で仮想マシンをホット移行する機能を提供します。
* * vSphere High Availability 。 * ホスト障害が発生しても、システム停止を回避するために、 VMware vSphere を使用すると、ホストをクラスタ化して高可用性を構成することができます。ホストの障害によってシステムが停止した VM は、クラスタ内の他のホストでまもなくリブートされ、サービスがリストアされます。
* * DRS （ Distributed Resource Scheduler ） * VMware vSphere クラスタは、ホストしている VM のリソースニーズの負荷を分散するように構成できます。リソース競合のある仮想マシンは、十分なリソースが使用可能であることを確認するために、クラスタ内の他のノードにホット移行できます。


image:redhat_openshift_image33.png["エラー：グラフィックイメージがありません"]



=== ネットワーク設計

NetApp 解決策上の Red Hat OpenShift では、 2 つのデータスイッチを使用して 25Gbps でプライマリデータ接続を提供します。また、ストレージノードのインバンド管理用に 1Gbps で接続を提供する管理スイッチをさらに 2 台使用し、 IPMI 機能のアウトオブバンド管理も行います。OCP では、 VMware vSphere 上の仮想マシン論理ネットワークを使用して、 IT クラスタを管理します。このセクションでは、解決策で使用される各仮想ネットワークセグメントの配置と目的について説明し、解決策を導入するための前提条件を概説します。



==== VLAN の要件

VMware vSphere 上の Red Hat OpenShift は、仮想ローカルエリアネットワーク（ VLAN ）を使用して、ネットワークトラフィックを論理的に分離するように設計されています。この構成は、お客様のニーズに合わせて拡張することも、特定のネットワークサービスをさらに分離することもできます。次の表に、ネットアップで解決策を検証する際に解決策を実装するために必要な VLAN を示します。

|===
| VLAN | 目的 | VLAN ID 


| アウトオブバンド管理ネットワーク | 物理ノードと IPMI の管理 | 16 


| VM ネットワーク | Virtual Guest Network Access の略 | 181 


| ストレージネットワーク | ONTAP NFS 用のストレージネットワーク | 184 


| ストレージネットワーク | ONTAP iSCSI 用のストレージネットワーク | 185 


| インバンド管理ネットワーク | ESXi ノード、 vCenter Server 、 ONTAP Select の管理 | 3480 


| ストレージネットワーク | NetApp Element iSCSI 用のストレージネットワーク | 3481 


| 移行用ネットワーク | 仮想ゲスト移行用のネットワーク | 3487 
|===


==== ネットワークインフラストラクチャサポートリソース

OpenShift Container Platform を導入する前に、次のインフラを用意する必要があります。

* インバンド管理ネットワークおよび VM ネットワークからアクセス可能な完全なホスト名解決を提供する DNS サーバが少なくとも 1 台あります。
* インバンド管理ネットワークおよび VM ネットワークからアクセスできる NTP サーバが少なくとも 1 台必要です。
* （オプション）インバンド管理ネットワークと VM ネットワークの両方のアウトバウンドインターネット接続。




=== 本番環境の導入に関するベストプラクティス

このセクションでは、この解決策を本番環境に導入する前に考慮する必要があるベストプラクティスをいくつか紹介します。



==== 少なくとも 3 つの ESXi クラスタに OpenShift を導入する ノード

本ドキュメントで説明する検証済みのアーキテクチャには、 2 つの ESXi ハイパーバイザーノードを導入し、 VMware vSphere HA と VMware vMotion を有効にしてフォールトトレラントな構成を確保することで、 HA 処理に適した最小限のハードウェア環境が示されています。 1 つのホストが使用できなくなった場合に、導入した VM を 2 つのハイパーバイザー間で移行し、リブートすることができます。

Red Hat OpenShift は最初に 3 つのマスターノードで導入するため、 2 ノード構成で少なくとも 2 つのマスターが同じノードを占有します。そのため、特定のノードが使用できなくなった場合に OpenShift が停止する可能性があります。そのため、解決策の一部として少なくとも 3 つの ESXi ハイパーバイザーノードを導入して、 OpenShift マスターを均等に分散できるようにすること、および解決策にフォールトトレランスのレベルが高くなるようにすることが Red Hat のベストプラクティスです。



==== 仮想マシンとホストのアフィニティを設定します

VM とホストのアフィニティを有効にすることで、複数のハイパーバイザーノードに OpenShift マスターを確実に分散させることができます。

アフィニティまたは非アフィニティは、 VM やホストのセットに対してルールを定義する方法で、グループ内の同じホストまたはホスト上で VM を一緒に実行するか、別のホスト上で実行するかを決定します。VM とホストで構成されるアフィニティグループを作成することで、 VM に適用されます。このアフィニティグループには同じパラメータと条件が設定されます。アフィニティグループ内の VM がグループ内の同じホストで実行されているのか、または別々のホストで実行されているのかに応じて、アフィニティグループのパラメータでは正のアフィニティまたは負のアフィニティを定義できます。

アフィニティグループを設定するには、を参照してください https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.resmgmt.doc/GUID-FF28F29C-8B67-4EFF-A2EF-63B3537E6934.html["vSphere 6.7 ドキュメント：「 DRS アフィニティルールの使用"^]。



==== OpenShift Deployment にカスタムインストールファイルを使用します

IPI を使用すると、このドキュメントで前述した対話型ウィザードを使用して、 OpenShift クラスタを簡単に導入できます。ただし、一部のデフォルト値については、クラスタの導入時に変更が必要になる場合があります。

このような場合、クラスタをすぐに導入せずにウィザードを実行してタスクを割り当てることができますが、あとでクラスタを導入できる構成ファイルを出力する必要はありません。これは、任意の IPI デフォルトを変更する必要がある場合や、マルチテナンシーなどの他の用途のために、同一のクラスタを環境内に複数導入する必要がある場合に非常に便利です。OpenShift 用にカスタマイズされたインストール構成の作成の詳細については、を参照してください https://docs.openshift.com/container-platform/4.7/installing/installing_vsphere/installing-vsphere-installer-provisioned-customizations.html["Red Hat OpenShift カスタマイズを使用して vSphere にクラスタをインストールします"^]。

link:rh-os-n_overview_netapp.html["次：ネットアップストレージの概要"]
