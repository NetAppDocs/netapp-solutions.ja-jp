---
sidebar: sidebar 
permalink: containers/anthos_reference_design_considerations.html 
summary: このセクションでは、 NetApp HCI Anthos 解決策を正常に導入するために必要な設計上の考慮事項について説明します。 
keywords: Port Identification, Network Design, VLAN requirements, Best Practices, DRS, SnapMirror 
---
= 設計上の考慮事項


このセクションでは、 NetApp HCI Anthos 解決策を正常に導入するために必要な設計上の考慮事項について説明します。



== ポートの識別

NetApp HCI は、コンピューティングまたはストレージ専用の NetApp H シリーズノードで構成されます。どちらのノード構成も、オンボードの 1GbE ポート（ポート A と B ） 2 つと 10 / 25GbE ポート（ポート C と D ） 2 つで構成できます。コンピューティングノードには、 1 つ目のメザニンスロットで使用可能な 10 / 25GbE ポート（ポート E と F ）が追加されています。各ノードには、 Intelligent Platform Management Interface （ IPMI ）機能をサポートするアウトオブバンド管理ポートも追加されています。次の図は、 H410C ノードの背面にある各ポートを示しています。

image::netapp_hci_network_ports_compute_node.png[NetApp HCI ネットワークポート（コンピューティングノード）：]



== ネットワーク設計

Anthos 解決策を搭載した NetApp HCI は、 2 つのデータスイッチを使用して、 25Gbps でプライマリデータ接続を提供します。また、ストレージノードのインバンド管理用に 1Gbps で接続を提供する管理スイッチをさらに 2 台使用し、 IPMI 機能のアウトオブバンド管理も行います。



=== ストレージノードのケーブル接続

NDE を実行し、 NetApp HCI クラスタを設定し、解決策の導入後に Element への管理アクセスを提供するには、各ストレージノードで管理ポート A と B をアクティブにする必要があります。物理的なフォールトトレランスを実現するために、 2 つの 25Gbps ポート（ C と D ）を各データスイッチに 1 つずつ接続する必要があります。マルチシャーシリンクアグリゲーション（ MLAG ）用にスイッチポートを設定し、ジャンボフレームをサポートする LACP をノード上のデータポートで設定する必要があります。各ノードの IPMI ポートを使用すると、データセンターに設置したノードをリモートで管理できます。IPMI を使用すると、 Web ブラウザベースのコンソールからノードにアクセスして、初期インストールを実行したり、診断を実行したり、必要に応じてノードをリブートまたはシャットダウンしたりできます。



=== コンピューティングノードのケーブル接続

コンピューティングノード上の 25Gbps ポートは、 1 つのオンボードポート（ C ）を 1 つのデータスイッチにケーブル接続し、 PCI スロット（ E ）から 2 つ目のスイッチに接続して物理的なフォールトトレランスを実現します。これらのポートは、ジャンボフレームをサポートするように設定する必要があります。このノードの接続は、 VMware vSphere を環境に導入したあとに vDS によって管理されます。IPMI ポートを使用して、データセンターに設置したノードをリモートで管理することもできます。IPMI を使用すると、 Web ブラウザベースのコンソールからノードにアクセスして診断を実行し、必要に応じてリブートまたはシャットダウンできます。次の図に、ネットワークケーブル接続の参考資料を示します。

image::network_cabling_reference_diagram.png[ネットワークのケーブル配線のリファレンス図]



== VLAN の要件

解決策は、仮想ローカルエリアネットワーク（ VLAN ）を使用して、さまざまな目的でネットワークトラフィックを論理的に分離するように設計されています。NetApp HCI には、少なくとも 3 つのネットワークセグメントが必要です。ただし、この構成は、お客様のニーズに合わせて拡張したり、特定のネットワークサービスをさらに分離したりするために拡張できます。次の表に、解決策の実装に必要な VLAN 、および検証済みアーキテクチャの導入で使用される特定の VLAN ID を示します。

[cols="25,50,25"]
|===
| VLAN | 目的 | 使用する VLAN 


| アウトオブバンド管理 | HCI ノードの管理 | 16 


| インバンド管理 | HCI ノードおよびインフラ仮想ゲストの管理 | 3480 


| ストレージネットワーク | NetApp Element 用のストレージネットワーク | 3481 


| vMotion ネットワーク | VMware vMotion 用のネットワーク | 3487 


| VM ネットワーク | 仮想ゲスト用のネットワーク | 1172 
|===


== ネットワークインフラストラクチャサポートリソース

NetApp HCI 解決策に Anthos を導入する前に、以下のインフラを導入する必要があります。

* インバンド管理ネットワークと VM ネットワークの両方にアドレスを提供する DHCP サーバ。DHCP プールは、初期導入時に少なくとも 10 台の VM をサポートできる十分な大きさである必要があり、必要に応じて拡張する必要があります。
* インバンド管理ネットワークと VM ネットワークからアクセス可能な完全なホスト名解決を提供する DNS サーバが少なくとも 1 台必要です。
* インバンド管理ネットワークおよび VM ネットワークからアクセスできる NTP サーバが少なくとも 1 台必要です。
* インバンド管理ネットワークと VM ネットワークの両方のアウトバウンドインターネット接続。




== ベストプラクティス

本ドキュメントでは、導入の最小要件を満たす VMware 上に Anthos を導入する方法について説明します。本番環境に解決策を導入する前に、このベストプラクティスセクションに記載された情報を使用してください。



=== 2 台目のシーソーロードバランサを取り付ける

本番環境では、単一点障害を避けることがベストプラクティスです。この検証では、単一の Seesaw バンドルロードバランサが管理者および導入された各ユーザクラスタに割り当てられました。これは簡単な検証では問題ありませんが、クラスタのコントロールプレーン VIP との通信が失われると、クラスタにアクセスできなくなったり、管理ワークステーションや Google Cloud コンソールからクラスタを管理できなくなったりすることがあります。HA Seesaw ロードバランサを導入することで、システム停止が発生しないようにすることができます。この機能を有効にするためのセットアップ手順およびその他の要件については、このドキュメントでは詳しく説明していませんが、詳しい手順については説明しています link:https://cloud.google.com/anthos/gke/docs/on-prem/1.6/how-to/bundled-load-balance["こちらをご覧ください"^]。



=== 2 台目の F5 BIG-IP Virtual Edition アプライアンスをインストールします

本番環境では、単一点障害を避けることがベストプラクティスです。この検証では、単一の F5 BIG-IP Virtual Edition ロードバランサアプライアンスを使用して、コントロールプレーンへの接続と、 VMware クラスタ上の Anthos の入力 VIP アドレスを検証しました。これは簡単な検証では問題ありませんが、クラスタのコントロールプレーン VIP との通信が失われると、クラスタにアクセスできなくなったり、管理ワークステーションや Google Cloud コンソールからクラスタを管理できなくなったりすることがあります。F5 BIG-IP Virtual Edition は、アプリケーションベースの HA をサポートしており、システム停止が発生しないようにします。この問題について簡単に説明しますが、このマニュアルでは、この機能のセットアップ手順については詳しく説明しません。ただし、解決策 for Anthos NetApp HCI を本番環境に導入する前に、この機能についてさらに詳しく調査することを推奨します。



=== VMware vSphere DRS を有効にし、非アフィニティルールを設定する

VMware vSphere には、クラスタ内のどのノードも、仮想ゲストが使用できる物理リソースを十分に使用できないようにする機能が用意されています。Distributed Resource Scheduler （ DRS ）は、少なくとも 3 つの ESXi ノードで構成される vSphere クラスタで設定できます。この導入ガイドで説明する NetApp HCI の最小構成は 2 つのコンピューティングノードで構成されており、この機能を使用することはできません。この制限により、導入した VMware クラスタの Anthos に対しては非アフィニティルールも無効になりました。

非アフィニティルールにより、特定のユーザクラスタのすべてのマスターまたはすべてのワーカーが異なるノード上で実行されるようにします。これにより、 1 つのノードに障害が発生しても、ユーザクラスタ全体またはホストしているポッドが無効になることはありません。NetApp HCI システムは簡単かつ迅速に拡張でき、この検証で説明する最小限の導入では、 HCI 410C ノードを即座に拡張するためのオープンシャーシスロットが 2 つ用意されています。そのため、解決策を本番環境に導入して非アフィニティルールで DRS を有効にする前に、空のシャーシスロットにコンピューティングノードを追加することを推奨します。



=== SnapMirror を使用して、ディザスタリカバリ用にリモートでデータをコピーします

NetApp Element ストレージシステムでは、ネットアップの SnapMirror テクノロジを使用して、 AFF 、 FAS 、 Cloud Volumes ONTAP など、 NetApp ONTAP システムを実行するシステムにストレージボリュームをレプリケートできます。SnapMirror 処理のスケジュールを定期的に設定して、災害発生時に VMware データストアのバックアップとリモートサイトからのリストアを実行することができます。また、 SnapMirror を使用して、 Trident によってプロビジョニングされた永続ボリュームをバックアップまたは移行し、他の環境やクラウドに導入された Kubernetes クラスタに再接続することもできます。

link:anthos_reference_hardware_software_requirements.html["次の手順：ハードウェアとソフトウェアの要件"]
