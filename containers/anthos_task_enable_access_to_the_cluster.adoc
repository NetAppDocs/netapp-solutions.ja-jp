---
sidebar: sidebar 
permalink: containers/anthos_task_enable_access_to_the_cluster.html 
summary: クラスタを導入して Google Cloud に登録したら、クラスタを管理し、追加の詳細情報を受け取るために、クラスタを Google Cloud コンソールでログインする必要があります。GKE コンソールを使用してユーザクラスタにアクセスできるようにするには、このページに記載されている手順を実行します。 
keywords: google cloud console, GKE, Kubernetes, Service Account 
---
= 10. GKE コンソールを使用したクラスタへのアクセスを有効にします


クラスタを導入して Google Cloud に登録したら、クラスタを管理し、追加の詳細情報を受け取るために、クラスタを Google Cloud コンソールでログインする必要があります。Anthos ユーザクラスタにアクセスするための公式な手順 導入後の詳細については、を参照してください https://cloud.google.com/anthos/multicluster-management/console/logging-in["こちらをご覧ください"]。


NOTE: Google Cloud コンソールでオンプレミスクラスタにアクセスし、 VMware サービスで Anthos を使用するには、プロジェクトと特定のユーザをホワイトリストに登録する必要があります。クラスタが導入されたあとに表示されない場合は、 Google でサポートチケットを開く必要があります。

ホワイトリストにないビューは次のようになります。

image::google_cloud_console_1.PNG[非ホワイトリストビュー]

次の図はクラスタを示しています。

image::google_cloud_console_2.PNG[クラスタを表示します]

GKE コンソールを使用してユーザクラスタにアクセスできるようにするには、次の手順に従います。

. クラスタへのアクセスを許可する 'node-readator.yaml ファイルを作成します
+
[listing]
----
kind: clusterrole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
 name: node-reader
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get", "list", "watch"]
----
. kubectl' コマンドを使用してログインするクラスタに ' このファイルを適用します
+
[listing]
----
ubuntu@Anthos-Admin-Workstation:~$ kubectl apply -f node-reader.yaml --kubeconfig anthos-cluster01-kubeconfig
clusterrole.rbac.authorization.k8s.io/node-reader created
----
. ログインに使用できる Kubernetes Service Account （ KSA ）を作成します。このアカウントには、このアカウントを使用してクラスタにログインしたあとに名前を付けます。
+
[listing]
----
ubuntu@Anthos-Admin-Workstation:~$ kubectl create serviceaccount netapp-user --kubeconfig anthos-cluster01-kubeconfig
serviceaccount/netapp-user created
----
. ビューと新しく作成されたノードリーダーの役割の両方を新しく作成された KSA にバインドするには、クラスタロールバインドリソースを作成します。
+
[listing]
----
ubuntu@Anthos-Admin-Workstation:~$ kubectl create clusterrolebinding netapp-user-view --clusterrole view --serviceaccount default:netapp-user --kubeconfig anthos-cluster01-kubeconfig
clusterrolebinding.rbac.authorization.k8s.io/netapp-user-view created
ubuntu@Anthos-Admin-Workstation:~$ kubectl create clusterrolebinding netapp-user-node-reader --clusterrole node-reader -
-serviceaccount default:netapp-user --kubeconfig anthos-cluster01-kubeconfig
clusterrolebinding.rbac.authorization.k8s.io/netapp-user-node-reader created
----
. 権限をさらに拡張する必要がある場合は、同様の方法で、 KSA ユーザにクラスタ管理者権限を持つロールを付与できます。
+
[listing]
----
ubuntu@Anthos-Admin-Workstation:~$ kubectl create clusterrolebinding netapp-user-admin --clusterrole cluster-admin --serviceaccount default:netapp-user --kubeconfig anthos-cluster01-kubeconfig
clusterrolebinding.rbac.authorization.k8s.io/netapp-user-admin created
----
. KSA アカウントが作成され、適切な権限で割り当てられている場合、 GKE コンソールからアクセスできるベアラトークンを作成できます。そのためには、シークレット名のシステム変数を設定し、その変数を 'kubectl' コマンドを介して渡してトークンを生成します。
+
[listing]
----
ubuntu@Anthos-Admin-Workstation:~$ SECRET_NAME=$(kubectl get serviceaccount netapp-user --kubeconfig anthos-cluster01-kubeconfig -o jsonpath='{$.secrets[0].name}')
ubuntu@Anthos-Admin-Workstation:~$ kubectl get secret ${SECRET_NAME} --kubeconfig anthos-cluster01-kubeconfig -o jsonpath='{$.data.token}' | base64 -d
eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6Im5ldGFwcC11c2VyLXRva2VuLWJxd3piIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6Im5ldGFwcC11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNmIzZTFiZjQtMDE3NS0xMWVhLWEzMGUtNmFiZmRlYjYwNDBmIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6bmV0YXBwLXVzZXIifQ.YrHn4kYlb3gwxVKCLyo7p6J1f7mwwIgZqNw9eTvIkt4PfyR4IJHxQwawnJ4T6RljIFcbVSQwvWI1yGuTJ98lADdcwtFXHoEfMcOa6SIn4OMVw1d5BGloaESn8150VCK3xES2DHAmLexFBqhVBgckZ0E4fZDvn4EhYvtFVpKlRbSyaE-DHD59P1bIgPdioiKREgbOddKdMn6XTVsuip4V4tVKhktcdRNRAuw6cFDY1fPol3BFHr2aNBIe6lFLkUqvQN-9nMd63JGdHL4hfXu6PPDxc9By6LgOW0nyaH4__gexy4uIa61fNLKV2SKe4_gAN41ffOCKe4Tq8sa6zMo-8g
----
. このトークンを使用して、にアクセスできます https://console.cloud.google.com/["Google Cloud Console の略"] ログインボタンをクリックしてトークンに貼り付け、クラスタにログインします。


image::google_cloud_console_3.PNG[Google Cloud Console にログインします]

. ログインが完了すると、クラスタ名の横に緑色のチェックマークが表示され、物理環境に関する情報が表示されます。クラスタ名をクリックすると、詳細な情報が表示されます。


image::google_cloud_console_4.PNG[Kubernetes クラスタの詳細]

link:anthos_task_install_and_configure_trident.html["次のステップ： NetApp Trident ストレージプロビジョニング担当者をインストールして設定"]
