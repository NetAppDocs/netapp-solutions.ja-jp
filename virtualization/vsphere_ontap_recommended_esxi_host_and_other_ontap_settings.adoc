---
sidebar: sidebar 
permalink: virtualization/vsphere_ontap_recommended_esxi_host_and_other_ontap_settings.html 
keywords:  
summary:  
---
= 推奨される ESXi ホストとその他の ONTAP 設定
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


ネットアップでは、 ONTAP を使用する際に適切に動作する ESXi ホストのマルチパスと HBA タイムアウトの設定を、テスト結果に基づいて作成しました。これらは、 VMware vSphere 用の ONTAP ツールを使用して簡単に設定できます。サマリダッシュボードで、ホストシステムポートレットの設定の編集をクリックするか、 vCenter でホストを右クリックして、 ONTAP ツール > 推奨値の設定を選択します。9.8 リリースで現在推奨されているホスト設定は次のとおりです。

|===


| ホスト設定 


| ネットアップが推奨する値 


| ESXi の高度な設定 


|  


| VMFS3.HardwareAcceleratedLocking 


| そのままにします（ VMware のデフォルトは 1 ）。 


| VMFS3.EnableBlockDelete の 2 つのオプションがあります 


| そのままにします（ VMware のデフォルトは 0 ですが、 VMFS6 では必要ありません）。詳細については、 VMware の技術情報アーティクルを参照してください。 


| NFS 設定 


|  


| Net.TcpipHeapSize の場合 


| vSphere 6.0 以降： 32 に設定他のすべての NFS 設定の場合は、 30 に設定されます。 


| Net.TcpipHeapMax 


| vSphere 6.0 以降では、 1536 に設定します。 


| NFS.MaxVolumes の場合 


| vSphere 6.0 以降では、 256 に設定されます。他のすべての NFS 構成では、 64 に設定されます。 


| NFS41.MaxVolumes の場合 


| vSphere 6.0 以降では、 256 に設定されます。 


| NFS.MaxQueueDepth 


| vSphere 6.0 以降では、 128 に設定されます。 


| NFS.HeartbeatMaxFailures の略 


| すべての NFS 設定について、 10 に設定されます。 


| nfs.HeartbeatFrequency 


| すべての NFS 設定について、 12 に設定されます。 


| nfs.HeartbeatTimeout 


| すべての NFS 設定について、 5 に設定されます。 


| SunRPC.MaxConnPerIP 


| vSphere 7.0 以降では 128 に設定されます。 


| FC / FCoE 設定 


|  


| パス選択ポリシー 


| FC パスの ALUA を使用する場合は、 RR （ラウンドロビン）に設定されます。それ以外の構成では、すべて FIXED に設定されます。この値を RR に設定すると、最適化されたすべてのアクティブなパスで負荷を分散できます。FIXED は、 ALUA に対応していない従来の構成用の値で、プロキシ I/O を防止できますつまり、 Data ONTAP 7-Mode を実行する環境でハイアベイラビリティ（ HA ）ペアの他方のノードに I/O が送られないようにすることができます。 


| Disk.QFullSampleSize 


| すべての構成で 32 に設定されます。この値を設定すると、 I/O エラーの防止に役立ちます。 


| Disk.qFullThreshold 


| すべての構成で 8 に設定します。この値を設定すると、 I/O エラーの防止に役立ちます。 


| Emulex FC HBA タイムアウト 


| デフォルト値を使用します。 


| QLogic FC HBA タイムアウト 


| デフォルト値を使用します。 


| iSCSI 設定 


|  


| パス選択ポリシー 


| すべての iSCSI パスで RR （ラウンドロビン）に設定されます。この値を RR に設定すると、最適化されたすべてのアクティブなパスで負荷を分散できます。 


| Disk.QFullSampleSize 


| すべての構成で 32 に設定されます。この値を設定すると、 I/O エラーの防止に役立ちます。 


| Disk.qFullThreshold 


| すべての構成で 8 に設定します。この値を設定すると、 I/O エラーの防止に役立ちます。 
|===
ONTAP ツールでは、 ONTAP FlexVol および LUN の作成時に特定のデフォルト設定も指定されます。

|===


| ONTAP ツール 


| デフォルト設定です 


| Snapshot リザーブ（ -percent-snapshot-space ） 


| 0 


| フラクショナルリザーブ（ -fractional-reserve ） 


| 0 


| アクセス時間の更新（ -atime-update ） 


| いいえ 


| 最小限の先読み（ -min-readahead ） 


| いいえ 


| スケジュールされた Snapshot コピー 


| なし 


| ストレージ効率 


| 有効 


| ボリュームギャランティ 


| なし（シンプロビジョニング） 


| ボリュームのオートサイズ 


| grow_shrink 


| LUN のスペースリザベーション 


| 無効 


| LUN スペースの割り当て 


| 有効 
|===


== その他のホストマルチパス構成に関する考慮事項

現在使用可能な ONTAP ツールで設定されていませんが、以下の設定オプションを検討することを推奨します。

* ハイパフォーマンスな環境で、または単一の LUN データストアでパフォーマンスをテストする場合は、ラウンドロビン（ VMW_PSP_RR ）パス選択ポリシー（ PSP ）の負荷分散設定をデフォルトの IOPS 設定 1000 から 1 に変更することを検討します。VMware の技術情報を参照 https://kb.vmware.com/s/article/2069356["2069356"^] 詳細については、
* vSphere 6.7 Update 1 では、 VMware がラウンドロビン PSP 用に新しいレイテンシの負荷分散メカニズムを導入しました。新しいオプションでは、 I/O に最適なパスを選択する際に、 I/O 帯域幅とパスレイテンシが考慮されます1 つのパスに別のパスよりも多くのネットワークホップがある場合や、 NetApp All SAN Array システムを使用している場合など、パス接続に同等でない環境では、この方法を使用するとメリットが得られます。を参照してください https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-B7AD0CA0-CBE2-4DB4-A22C-AD323226A257.html?hWord=N4IghgNiBcIA4Gc4AIJgC4FMB2BjAniAL5A["パス選択プラグインとポリシー"^] を参照してください。

