---
sidebar: sidebar 
permalink: databases/aws_ora_fsx_ec2_benchmark.html 
summary: このセクションでは、SwingbenchでシミュレーションしたOLTPワークロードのパフォーマンス検証とベンチマーク結果について詳しく説明します。 
keywords: HA, DR, database, Oracle, RDS, AWS, SnapCenter 
---
= パフォーマンス検証とベンチマーク結果
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
このパフォーマンス検証の目的は、マークを設定しないことです。このドキュメントに記載されている導入手順とベストプラクティスに従っている場合は、パブリッククラウドに導入したOracleデータベースと同様のパフォーマンス指標を期待できます。

Swingbench Sales Order Entry（SOE）モジュールを使用してOLTPタイプのワークロードをシミュレートし、NFSプロトコル上のFSXストレージボリュームを備えたM5インスタンスに導入されたOracleデータベースにワークロードを適用しました。デフォルトのSwingbench SOE I/Oプロファイルは、80対20の読み取り/書き込みスプリットに近いため、実際のOLTP Oracleワークロード・プロファイルに近い環境に配置されています。

このワークロードの値は、受注側で受注エントリ、参照、インベントリクエリなどを実行している同時ユーザ数を増やすことで増加します。テストした値は、同時ユーザ数が8、16、32、64、128であることが確認されています。Swingbenchアルゴリズムは、サーバ側での負荷が高く、適切なトランザクション・ボリュームのプッシュとOracleサーバの制限のテストに使用されています。同時に128人のユーザが作業する場合、EC2インスタンスのCPU利用率は約80~90%に達していることが確認されました。

以降のセクションでは、セットアップとテスト結果の詳細について説明します。



== テスト環境のセットアップ



=== コンピューティング

vCPU×8、32G RAM、ネットワーク帯域幅×10GのEC2 M5インスタンスを導入し、

image:aws_ora_fsx_ec2_inst_10.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



=== FSXストレージ

3つのデータベースボリュームを作成し、NFSを使用するボリュームをEC2インスタンスにマウントしました。その手順は次のとおりです。

* /u01 - Oracleバイナリ
* /u02 - Oracleデータ・ファイル、制御ファイル
* /u03 - Oracleログファイル、制御ファイル


冗長性を確保するために、重要な制御ファイルのコピーを2つ保持しました。

image:aws_ora_fsx_ec2_stor_15.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

FSXファイルシステムは、80、000 IOPS容量と2GiBpsのI/Oスループットで構成されています。



=== Oracle設定

RUパッチ19.8を使用してOracleバージョン19Cをインストールしました。サーバでdNFSが有効になっています。

データベースは、3つのPDBを含むコンテナ化されたデータベースとして導入されました。パフォーマンステストには1つのPDBインスタンスを使用し、次の図に、NFSマウントポイントにおけるOracleストレージのサイジングを示します。

image:aws_ora_fsx_ec2_inst_11.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



=== Swingbench構成

vCPU 8基、RAM 32GのWindowsホストにSwingbench 2.6（最新バージョン）を導入しました。SOE psqlテストモジュールバージョン2をベンチマークに使用しました。デフォルトの負荷プロファイルは、80対20の読み取り/書き込み比率で、実際のOLTPトランザクションワークロードをシミュレートします。

使用したスキーマスケール係数は50で、最初のデータロードサイズは160G、一時的なスペース割り当ては30Gでした。この規模の要因では、SOEスキーマは、オンライン注文処理のシミュレーション用に1000の倉庫と50百万の顧客を提供しました。

次のスクリーンショットは、Swingbench Windows UIでのワークロードのプロファイルと一般的なトランザクション実行に関する指標を示しています。

image:aws_ora_fsx_ec2_swin_01.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

このグラフが示すように、トランザクションレベルは、テスト実行中も同じレベルに維持されました。



== テスト結果の分析

テストの実行ごとにSwingbenchの結果を取得し、パフォーマンス分析用に対応するOracle AWRレポートを取得しました。

エンドユーザ側から、トランザクションの量やユーザの応答時間など、主要な指標を確認しました。どちらの指標にも、システムにログインしている同時ユーザー数、およびユーザーが注文を入力した後にトランザクションを完了して応答を受信できる速度が示され、セールスオーダーエントリシステムから実行できるトランザクション数が示されています。

Oracleサーバの側から、Oracle AWRレポートを解析して、ユーザトランザクションの速度が低下した可能性のある上位の待機イベントを特定しました。上位10個のOracle待機イベントから、Swingbenchシミュレーショントランザクションテストの実行中、OracleサーバのほとんどがI/Oバウンドであり、データベース時間の50~60%が費やされていることがわかりました `db file sequential read`。 `log file sync`また、トランザクションのコミットによってOracleロギングプロセスでバッファキャッシュからディスク上のログファイルにログI/Oがフラッシュされるため、も影響を及ぼします。ただし、データベース時間の割合レベルでは、ログI/Oの割合は小さくなります。

トランザクションの実行中は、ユーザのトランザクションボリューム、ユーザの応答時間、Oracleの上位の待機状態のイベントを同時ユーザの数でグラフ化しました。結果は次のとおりです。

image:aws_ora_fsx_ec2_swin_02.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

この結果から、同時ユーザ数を増加させてユーザトランザクションボリュームを安定的に拡張する一方で、I/Oレイテンシとユーザ応答時間は一定して低く抑えることができ、これはOracleアプリケーションのパフォーマンスとして適切です。

同時ユーザ数が128に達した時点で、I/Oレイテンシとユーザ応答時間は幾分増加し始めました。次の図に示すように、EC2インスタンスがサーバの最大容量に近づいているため、この状況が想定されます。

image:aws_ora_fsx_ec2_swin_03.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

同様に、次の図は、この時点でユーザトランザクションボリュームを処理している場合の、対応するFSXのIOPSとスループットを示しています。

image:aws_ora_fsx_ec2_swin_04.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"] image:aws_ora_fsx_ec2_swin_05.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

OracleサーバEC2インスタンスが制限要因となった場合、プロビジョニングされたFSXストレージ容量にIOPSまたはスループットが到達しませんでした。そのため、ユーザアプリケーションレベルのトランザクションボリュームに基づいて、コンピューティングとストレージのサイズを適切に設定する必要があります（セクションで説明します）。link:aws_ora_fsx_ec2_factors.html["Oracleデータベースの導入で考慮すべき要素。"]
