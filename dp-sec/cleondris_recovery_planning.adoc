---
sidebar: sidebar 
permalink: dp-sec/cleondris_recovery_planning.html 
keywords: orchestration, multitier, failover, planned migration, plan, 
summary:  
---
= リカバリ計画： NetApp HCI DR と Cleondris
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
このセクションでは、危機的な状況や計画的な移行の際にアプリケーションを正常にフェイルオーバーする方法について説明します。まず、複雑な多層アプリケーションを保護し、次にアプリケーションをよりシンプルにすることを検討します。低速または高速なディザスタリカバリ計画を作成できるため、このセクションでは最もパフォーマンスの高い計画の例を示します。



== マルチティアアプリケーション

. [ フェールオーバー ] ページで、 [ プラン ] タブを選択します。
+
image:cleondris_image18.png["エラー：グラフィックイメージがありません"]

. 右端には、 + Add Failover Group ボタンがあります。
+
image:cleondris_image19.png["エラー：グラフィックイメージがありません"]

+
この例では、この計画を Multi-Tier と呼んでいます。左下のネットワークマッピングを使用して、本番環境で使用している仮想スイッチを、 DR で使用している仮想スイッチに変更します。

+
image:cleondris_image20.png["エラー：グラフィックイメージがありません"]

+
前のスクリーンショットでは、本番環境でネットワークスイッチを選択し、 DR で Map ボタンを使用してスイッチを選択し、 Save を使用する方法を示しています。必要に応じて、複数のマッピングを設定できます。

. 保護する VM を選択するには、 Add Failover Group （フェイルオーバーグループの追加）をクリックします。
+
この計画は多層アプリケーションを保護するため、最初のグループはデータベース用です。

+
image:cleondris_image21.png["エラー：グラフィックイメージがありません"]

+
この例では、 VMware Tools の待機を有効にしています。この設定は、アプリケーションが実行されていることを確認するのに役立つため重要です。[Add VM] ボタンを使用して、データベースである VM を追加しました。Unregister Source VMS を有効にしませんでした。これは、フェールオーバーが遅くなるためです。次に、 [Add Failover] ボタンを使用してアプリケーションを保護します。

. Web サーバでも同じことを行います。これが完了すると、画面は次の例のようになります。
+
image:cleondris_image22.png["エラー：グラフィックイメージがありません"]

+
この計画の重要な部分は、すべてのデータベースが機能している状態にしてから、アプリケーションを起動し、データベースを検索して作業を開始することです。その後、 Web サーバが起動し、アプリケーションが完了して動作します。この方法は、このようなリカバリを設定する最も簡単な方法です。

. 続行する前に、 [ 保存 ] をクリックします。




== 簡単なアプリケーションまたは大量のアプリケーションがフェールオーバーします

VM を起動する順序は重要で、稼働させるために前のセクションで説明した順序になります。次に、順序が重要でない一連の VM をフェイルオーバーします。

次に、複数の VM を含む 1 つのフェイルオーバーグループを使用して、新しいフェイルオーバープランを作成します。ネットワークマッピングを実行する必要があります。

image:cleondris_image23.png["エラー：グラフィックイメージがありません"]

このプランには複数の VM が含まれています。また、異なる時間に開始されますが、互いに関連していないので問題ありません。



== 計画的な移行

計画的マイグレーションはディザスタリカバリフェイルオーバーと似ていますが、ディザスタリカバリのシナリオではないため、処理方法は少し異なります。計画的な移行を実施することを推奨しますが、フェイルオーバーグループに何かを追加して、ソースから VM の登録を解除できます。これには少し時間がかかりますが、計画的な移行では悪いことではありません。

計画的な移行は、通常、新しいデータセンターへの移行です。時々それは破壊的な天候が近づいているがまだ着いていないときにまた使用される。



== 計画の計画

計画を立てることで、 1 つの計画を立て、それによってすべてのフェイルオーバー計画が調整されます。

[ プラン ] タブには、 [ プラン ] セクションがあります。[ サブプランの追加 ] を使用して、計画を開始し、他の計画を追加できます。

image:cleondris_image24.png["エラー：グラフィックイメージがありません"]

この例では、計画の計画をマスター計画と呼び、 2 つの計画を追加しました。フェイルオーバーの実行時やフェイルオーバーのテスト時にも、マスタープランのオプションが用意されています。

この方法は、アプリケーションのフェイルオーバーを独自の計画でテストするのが最適であるため、有効です。各プランはトラブルシューティングと修正が非常に簡単で、問題がなければマスタープランに追加できます。



== スクリプトのサポート

スクリプトは、テストフェイルオーバーの一環として、またはその他のさまざまな目的に使用できます。には次のものが含まれます。

* アンチスパムハードウェアをオンにする
* セキュリティハードウェアをオンにしています
* 標識へのデータ入力
* IPAM ハードウェアを更新しています
* データベースの言語設定を変更する


プランを編集してからフェイルオーバーグループを編集すると、 [ スクリプト ] の下にエントリが表示されます。

image:cleondris_image41.png["エラー：グラフィックイメージがありません"]

次のスクリーンショットでは、ホストという用語はスクリプトを実行する VM を指しています。[ 編集 ] ボタンをクリックすると、 [ スクリプトの編集 ] ウィンドウが表示されます。

image:cleondris_image42.png["エラー：グラフィックイメージがありません"]

スクリプトをコピーしてこのダイアログボックスに貼り付ける前に、必ずスクリプトをテストしてください。また、 [ グループオーダー ] フィールドで [ 投稿 ] を選択する必要があります。正しいクレデンシャルを使用してください。

実行後のスクリーンショットには、スクリプトが正常に実行されたことが示されています。

image:cleondris_image43.png["エラー：グラフィックイメージがありません"]

終了コードが 0 以外の場合、スクリプトは成功しませんでした。



=== スクリプトのトラブルシューティング

スクリプトが正しく実行されない場合は、次の問題を確認してください。

* VMware Tools では、一度に 1 つの外部プロセスのみを実行できます。そのため、 VMware Tools 自体が更新されている場合、スクリプトは実行されません。これは、 VMware Tools を自動的にアップグレードするように VM を設定した場合に発生することがあります。これは、 [VM 設定 ] > [VM オプション ] > [VMware Tools] で行います。
* クレデンシャルに問題がないかを確認
* プロンプトや、人間の入力を必要とするその他の機能など、スクリプトの問題がないかどうかを確認します。


基本的なタスクのみを実行する単純なスクリプトを実行することがベストプラクティスです。トラブルシューティングの目的でログファイルを含めることもできます。



== 環境変数（ Environment Variables ）

環境変数を使用すると、スクリプトが本番用サイトで実行されているか DR サイトで実行されているかに関係なく、実行中のスクリプトから環境情報を取得できます。環境変数は、 Edit Failover Group ダイアログボックスで入力できます。最初に計画を編集し、次にフェイルオーバーグループを編集します。

image:cleondris_image44.png["エラー：グラフィックイメージがありません"]

これらの環境変数は、通常考えられる環境には存在しないため、 set コマンドを使用してこれらの変数を表示することはできません。すべての変数のリストを確認するには、次のスクリーンショットからスクリプトを実行してください。このスクリプトには 'get-Variable*>c:\utils\var_log.txt' が含まれており ' すべての変数をキャプチャします

image:cleondris_image45.png["エラー：グラフィックイメージがありません"]

リストの最後に表示される、追加した変数に加えて使用可能な 50 個以上の変数が表示されます。
