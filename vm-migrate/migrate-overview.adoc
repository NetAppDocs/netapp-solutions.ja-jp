---
sidebar: sidebar 
permalink: vm-migrate/migrate-overview.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= 仮想環境間での仮想マシン（VM）の移行（Shift Toolkit）
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
NetApp Shiftツールキットを使用すると、仮想マシン（VM）の移行はもはや問題になりません。このスタンドアロン製品は、VMware ESXiからMicrosoft Hyper-VへのVMの迅速かつ効率的な移行を可能にします。また、さまざまな仮想ディスクフォーマット間でのディスクレベルの変換もサポートしています。



== ユースケース

現在では、すべての組織がマルチハイパーバイザー環境を使用することのメリットを実感しています。市場の最近の変化に伴い、すべての組織は、ワークロードVMを代替ハイパーバイザに移行し、ビジネスで定義された目標を達成すること、ベンダーロックインを制御することなど、技術的および商業的なリスクを考慮して最適な対策を決定しています。これにより、ライセンスコストを最適化し、特定のハイパーバイザの未使用コアへの支出よりも適切な領域でIT予算を拡大することが可能になります。しかし、これまで課題となってきたのは、移行時間とそれに伴うダウンタイムでした。

NetApp Shiftツールキットを使用すると、仮想マシン（VM）の移行はもはや問題になりません。このスタンドアロン製品は、VMware ESXiからMicrosoft Hyper-VへのVMの迅速かつ効率的な移行を可能にします。また、さまざまな仮想ディスクフォーマット間でのディスクレベルの変換もサポートしています。ONTAPが提供するすぐに使用できる機能により、これらの移行は非常に迅速で、ダウンタイムを最小限に抑えることができます。たとえば、1TBのVMDKファイルの変換には通常数時間かかりますが、Shiftツールキットを使用すれば数秒で完了できます。



== ツールキットの概要

NetApp Shiftツールキットは、さまざまなハイパーバイザー間で仮想マシン（VM）を移行したり、仮想ディスク形式を変換したりできる、使いやすいグラフィカルユーザインターフェイス（GUI）ソリューションです。NetApp FlexClone®テクノロジを利用して、VMのハードディスクを迅速に変換します。さらに、このツールキットは、デスティネーションVMの作成と構成を管理します。

Shift Toolkitは、次のハイパーバイザー間の双方向変換をサポートすることで、マルチハイパーバイザー環境の柔軟性を提供します。

* VMware ESXiからMicrosoft Hyper-Vへ
* Microsoft Hyper-VからVMware ESXiへ（次期リリース）


Shift Toolkitは、ハイパーバイザー間で仮想ディスクをディスクレベルで変換し、次のディスクフォーマットをサポートしています。

* VMware ESXからMicrosoft Hyper-V（仮想マシンディスク[VMDK]から仮想ハードディスクフォーマット[VHDX]）
* VMware ESXからKVMへの互換性のあるハイパーバイザー（VMDKからQCOW2）


Shiftツールキットはダウンロードできlink:https://mysupport.netapp.com/site/tools/tool-eula/netapp-shift-toolkit["ここをクリック"]、Windowsシステムでのみ使用できます。



=== VMモビリティのメリット

ONTAPは、あらゆるハイパーバイザーやハイパースケーラに最適です。FlexCloneテクノロジを使用。ダウンタイムが長くなるのを待ったり、パススルーオプションで解決したりするよりも、数分でVMを移動できることが現実です。

Shiftツールキット：

* ダウンタイムを最小限に抑え、ビジネスの生産性を高めます。
* ライセンスコスト、ロックイン、単一ベンダーへのコミットメントを削減することで、選択肢と柔軟性を提供します。
* VMのライセンスコストを最適化し、IT予算を拡大したいと考えている組織を支援します。
* VMのモビリティによって仮想化コストを削減し、NetAppは無償で提供されます。




=== Shiftツールキットの仕組み

変換時に、ShiftツールキットはMicrosoft Hyper-VおよびVMware ESXiホスト、および共有NetAppストレージに接続されます。Shift Toolkitでは、次の3つの主要なNetAppテクノロジを使用して、FlexCloneを活用してVMハードドライブをハイパーバイザー間で変換します。

* 単一ボリュームと複数のプロトコル
+
NetApp ONTAPでは、複数のプロトコルを使用して単一のボリュームに簡単にアクセスできます。たとえば、VMware ESXiは、Network File System（NFS）プロトコルが有効になっているボリュームにアクセスでき、Microsoft Hyper-VはCIFS / SMBプロトコルを使用して同じボリュームにアクセスできます。

* FlexCloneテクノロジ
+
FlexCloneでは、データをコピーすることなく、ファイルまたはボリューム全体を高速クローニングできます。ストレージシステム上の共通ブロックは、複数のファイルまたはボリューム間で共有されます。その結果、大容量のVMディスクのクローンを非常に迅速に作成できます。

* VMディスクの変換
+
NetApp PowerShellツールキットとShiftツールキットには、NetAppストレージコントローラでさまざまな操作を実行するためのワークフローが多数含まれています。仮想ディスクを別の形式に変換するPowerShellコマンドレットも含まれています。たとえば、VMware VMDKをMicrosoft VHDXに、またはその逆に変換できます。これらの変換はFlexCloneを使用して実行され、ディスクフォーマットのクローン作成と変換をワンステップで非常に迅速に行うことができます。



image:shift-toolkit-image1.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



==== プロトコルと通信方法

Shift Toolkitでは、変換処理または移行処理で次のプロトコルが使用されます。

* HTTPS - ShiftツールキットがData ONTAPクラスタとの通信に使用します。
* VI Java（VI SDK）、VMware PowerCLI - VMware ESXiとの通信に使用されます。
* Windows PowerShellモジュール- Microsoft Hyper-Vとの通信に使用します。




== Shiftツールキットのインストールとセットアップ

ツールキットの使用を開始するには、指定した仮想マシンでWindowsオペレーティングシステムを使用し、前提条件を満たしていることを確認してから、パッケージをインストールします。

Shift Toolkitは、Windows 2019および2022バージョンで実行できます。Shiftツールキットパッケージをからダウンロードしlink:https://mysupport.netapp.com/site/tools/tool-eula/netapp-shift-toolkit["NetAppツールチェスト"]、パッケージを解凍してバッチファイルを実行し、サービスをインストールして開始します。

Shiftツールキットは、Microsoft Hyper-Vサーバまたはスタンドアロンサーバ（物理または仮想）にインストールできます。Shiftツールキットは専用のVMにインストールすることを推奨します。このアプローチでは、単一のShiftツールキットサーバを使用して、さまざまなMicrosoft Hyper-VサーバまたはVMware ESXiサーバをターゲットにすることができます。



=== 前提条件



==== ハードウェア要件

Shiftサーバホストがハードウェアの最小要件を満たしていることを確認します。

* CPU-2 vCPU
* メモリ- 4GB以上
* ディスク容量–10GB以上




==== 接続要件

* Shiftツールキットが環境内のすべてのコンポーネントと適切に連携できるように、ハイパーバイザーとストレージの環境が設定されていることを確認してください。
* Shiftツールキットは、Microsoft Hyper-VサーバまたはスタンドアロンのWindowsサーバ（物理または仮想）にインストールできます。
* Shiftサーバ、Data ONTAP CIFSサーバ、Hyper-Vサーバ、およびゲストオペレーティングシステムは、同じWindowsドメインに属している必要があります。
* CIFS用とNFS用の複数のLIFは、VMの変換時にStorage Virtual Machineで使用できます。Hyper-VサーバおよびESXiホストは、これらのLIFのIPアドレスでStorage Virtual Machine（SVM）にアクセスします。
* CIFS操作の場合は、WindowsドメインコントローラとNetAppストレージコントローラの時間設定が同期されている必要があります。




=== 新しいSVMの作成（推奨）

Storage vMotionを使用して、移行または変換するVMを指定した新しいData ONTAP Storage Virtual Machine（SVM）に移動します。本番環境のSVMでVMが変換されないように、VM用に新しいSVMを設定することを推奨します。ONTAP CLIまたはSystem Managerを使用して、新しいSVMを作成します。

以下の手順に従って、link:https://docs.netapp.com/us-en/ontap/networking/create_svms.html["リンク"]NFSプロトコルとSMBプロトコルの両方を許可する新しいSVMをプロビジョニングします。

ESXからHyper-Vへの変換では、CIFS共有の完全修飾パス名（コントローラのCIFS qtree）をデスティネーションパスとして指定します。

注：新しいSVMを作成して、Shiftツールキットの要件を満たしていることを確認することを推奨します。業務の中断を招く可能性がある方法で本番用SVMを変更する必要はありません。注：デスティネーションパスは、ソースVMの同じボリューム上にある必要があります。注：Shiftツールキットでは、NAS環境（NFS）にあるVMの変換のみがサポートされます。SAN環境（LUN）にあるVMの変換はサポートされません。



==== サポートされているオペレーティングシステム

ゲストオペレーティングシステムでサポートされているバージョンのWindowsとLinuxが変換に使用されていること、およびShiftツールキットがONTAPのバージョンをサポートしていることを確認します。

*サポートされているVMゲストOS *

VM変換のゲストオペレーティングシステムとしてサポートされるWindowsのバージョンは次のとおりです。

* Windows Server 2016
* Windows Server 2019
* Windows Server 2022


VMを変換するゲストオペレーティングシステムとしてサポートされるLinuxのバージョンは次のとおりです。

* Red Hat Enterprise Linux 6.7以降
* Red Hat Enterprise Linux 7.2以降
* Red Hat Enterprise Linux 8.x
* Red Hat Enterprise Linux 9.x
* Ubuntu 2018.
* Ubuntu 2022.
* Ubuntu 2024.
* Debian 10
* Debian 11
* Debian 12



NOTE: CentOS Linux/RedHat for Red Hat Enterprise Linux 5はサポートされていません。

*サポートされているONTAPのバージョン*

Shift Toolkitは、ONTAP 9.14.1以降を実行しているプラットフォームをサポートします。



=== インストール

. をダウンロードします。link:https://mysupport.netapp.com/site/tools/tool-eula/netapp-shift-toolkit["Shiftツールキットパッケージ"]
+
image:shift-toolkit-image2.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 指定したフォルダにパッケージを展開します。
+
image:shift-toolkit-image3.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. Shift Toolkitパッケージを実行するには、* install * batch fileをクリックします。
+
image:shift-toolkit-image4.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. インストーラがインストールプロセスを開始します。コマンドプロンプトが開き、MongoDB、Windows PowerShell 7、NetApp ONTAP PowerShell Toolkit、Windows PowerShell用Hyper-Vモジュール、vmware.powerCLIパッケージ、javaなどの前提条件がすべてパッケージに含まれています。
+
image:shift-toolkit-image5.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. その後、対話型プロンプトでCredSSPが有効になります。Yを押して続行します。
+
image:shift-toolkit-image6.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. CredSSPを有効にすると、インストーラはJavaパッケージをインストールします（qcow変換に必要）。
+
image:shift-toolkit-image7.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 完了すると、Shift Toolkit UIへのアクセスに使用するIPアドレスの入力を求めるプロンプトが表示されます。
+
image:shift-toolkit-image8.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 完了したら、「Press any key to continue」と入力してコマンドプロンプトを閉じます。
+
image:shift-toolkit-image9.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]




NOTE: インストールには8～10分かかることがあります。



=== GUIを使用した手順



==== Run Shiftツールキット

* ブラウザを使用して、と入力してShiftツールキットUIにアクセスします `http://<IP address specified during installation>:3001`。
* 次のデフォルトクレデンシャルを使用してUIにアクセスします。Username：admin Password：admin



NOTE: adminクレデンシャルは、[Change Password]オプションを使用して変更できます。

image:shift-toolkit-image10.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

[Accept and Continue]をクリックして、法的EULAに同意します。

image:shift-toolkit-image11.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



==== Shiftツールキットの設定

ストレージとソースハイパーバイザーとデスティネーションハイパーバイザーの両方への接続を適切に設定したら、FlexClone機能を活用して、仮想マシンVMDKの移行または適切な形式への変換を自動化するためのShiftツールキットの設定を開始します。



===== サイトの追加

最初に、ソースvCenterを検出して追加し、次にターゲットHyper-Vの詳細（ハイパーバイザーとストレージの両方）をShiftツールキットに追加します。サポートされているブラウザでOpenShiftツールキットを使用し、デフォルトのユーザー名とパスワード（admin/admin）とAdd Sitesを使用します。

image:shift-toolkit-image12.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]


NOTE: [検出]オプションを使用してサイトを追加することもできます。

次のプラットフォームを追加します。

* 出典 *

* ソースサイトの詳細
+
** Site Name：サイトの名前を指定します。
** ハイパーバイザー–ソースとしてVMwareを選択します（プレビュー時に選択可能なオプションのみ）。
** [サイトの場所]–デフォルトオプションを選択します。
** コネクタ（Connector）-デフォルトの選択を選択します。
** ストレージタイプ–デフォルトオプションを選択します。




入力したら、[続行]をクリックします。

image:shift-toolkit-image13.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* ソースのvCenter
+
** Endpoint - vCenter ServerのIPアドレスまたはFQDNを入力します。
** Username - vCenterにアクセスするためのユーザ名（UPN形式：username@domain.com）
** vCenter Password–リソースのインベントリを実行するためにvCenterにアクセスするためのパスワード。
** vCenter SSL Thumbprint（オプション）




[Accept Self Signed Certificate]を選択し、[Continue]をクリックします。

image:shift-toolkit-image14.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* ONTAPストレージシステムのクレデンシャル


image:shift-toolkit-image15.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

Shiftツールキットを追加すると、自動検出が実行され、VMと関連するメタデータ情報が表示されます。Shiftツールキットは、VMで使用されているネットワークとポートグループを自動的に検出し、それらを入力します。

image:shift-toolkit-image16.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

特定のvCenterのデータを表示するには、ダッシュボードに移動し、該当するサイト名の[View VM List]をクリックします。VMインベントリとVM属性がページに表示されます。

image:shift-toolkit-image17.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]


NOTE: VMインベントリは24時間ごとに更新されます。


NOTE: ShiftツールキットはESXiバージョン7.0以降をサポート

次の手順では、デスティネーションハイパーバイザーを追加します。

* 目的地 *

image:shift-toolkit-image18.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* デスティネーションサイトの詳細
+
** Site Name：サイトの名前を指定します。
** ハイパーバイザー–ターゲットとしてHyper-VまたはKVMを選択します。
** [サイトの場所]–デフォルトオプションを選択します。
** コネクタ（Connector）-デフォルトの選択を選択します。




入力したら、[続行]をクリックします。

image:shift-toolkit-image19.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

ハイパーバイザーの選択に基づいて、必要な詳細を入力します。

* デスティネーションHyper-Vの詳細
+
** Hyper-VスタンドアロンまたはフェイルオーバークラスタマネージャのIPアドレスまたはFQDN
** Username - Hyper-Vにアクセスするためのユーザ名（UPN形式：username@domain.com）Password–リソースのインベントリを実行するためにHyper-Vにアクセスするためのパスワード。




image:shift-toolkit-image20.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

完了したら、[続行]をクリックします


NOTE: Shift Toolkitは、現在のリリースではSystem Centerと直接通信しません。


NOTE: 現在のリリースでは、仮想マシンのエンドツーエンドの移行はHyper-Vでのみサポートされています。


NOTE: 現在のリリースでは、KVMをデスティネーションとしてサポートされるワークフローはVMDKからqcow2への変換のみです。そのため、ドロップダウンから[KVM]を選択した場合、ハイパーバイザーの詳細は必要ありません。qcow2ディスクは、KVMバージョンでの仮想マシンのプロビジョニングに使用できます。

* ONTAPストレージシステム*

image:shift-toolkit-image21.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]


NOTE: ソースとデスティネーションのストレージシステムは、ボリュームレベルで行われるディスクフォーマット変換と同じである必要があります。

image:shift-toolkit-image22.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

次の手順では、必要なVMを移行グループにリソースグループとしてグループ化します。



==== リソースのグループ化

プラットフォームを追加したら、移行または変換するVMをリソースグループにグループ化します。Shift Toolkitリソースグループを使用すると、依存するVMのセットを、ブート順序、ブート遅延、およびリカバリ時に実行できるオプションのアプリケーション検証を含む論理グループにグループ化できます。

リソースグループの作成を開始するには、[Create New Resource Group]メニュー項目をクリックします。

. リソースグループにアクセスし、[Create New Resource Group]をクリックします。
+
image:shift-toolkit-image23.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. [New resource group]で、ドロップダウンからソースサイトを選択し、[Create]をクリックします。
. リソースグループの詳細を指定し、ワークフローを選択します。ワークフローには2つのオプションがあります
+
.. クローンベースの移行–VMをソースハイパーバイザーからデスティネーションハイパーバイザーにエンドツーエンドで移行します。
.. クローンベースの変換–ディスクフォーマットを選択したハイパーバイザータイプに変換します。
+
image:shift-toolkit-image24.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



. [Continue]をクリックします。
. 検索オプションを使用して適切なVMを選択します。デフォルトのフィルタオプションは[Datastore]です。
+

NOTE: 変換前に、新しく作成したONTAP SVM上の指定したデータストアに変換または移行するVMを移動します。これにより、本番用NFSデータストアと指定したデータストアを分離して、仮想マシンのステージングに使用できるようになります。

+
image:shift-toolkit-image25.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. [Destination Site]、[Destination Hyper-V entry]、および[Datastore to qtree mapping]を選択して、マイグレーションの詳細を更新します。
+
image:shift-toolkit-image26.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+

NOTE: VMをESXからHyper-Vに変換するときは、デスティネーションパス（変換されたVMが格納されている場所）がqtreeに設定されていることを確認します。デスティネーションパスを適切なqtreeに設定します。

. 選択したすべてのVMのBoot Order（起動順序）とBoot delay（秒）を選択します。各仮想マシンを選択し、優先順位を設定して、パワーオンシーケンスの順序を設定します。3は、すべての仮想マシンのデフォルト値です。
+
オプションは次のとおりです。

+
1–最初にパワーオンする仮想マシン3 -デフォルト5 -最後にパワーオンする仮想マシン

+
image:shift-toolkit-image27.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. [Create Resource Group]をクリックします。
+
image:shift-toolkit-image28.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]





===== 青写真

仮想マシンを移行または変換するには、プランが必要です。ドロップダウンからソースとデスティネーションのハイパーバイザープラットフォームを選択し、このブループリントに含めるリソースグループと、アプリケーションの電源をオンにする方法のグループ（ドメインコントローラ、ティア1、ティア2など）を選択します。これらは、多くの場合、移行計画とも呼ばれます。ブループリントを定義するには、「ブループリント」タブに移動し、「新規ブループリントの作成」をクリックします。

ブループリントの作成を開始するには、「新規ブループリントの作成」をクリックします。

. Blueprintsにアクセスし、「Create New Blueprint」をクリックします。
+
image:shift-toolkit-image29.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. [New Blueprint]で、計画の名前を指定し、[Source Site]、[Associated VCenter]、[Destination Site]、および関連するHyper-Vハイパーバイザーを選択して、必要なホストマッピングを追加します。
. マッピングが完了したら、クラスタとホストのマッピングを選択します。
+
image:shift-toolkit-image30.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. [Resource Group Details]を選択し、[Continue]をクリックします。
+
image:shift-toolkit-image31.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. リソースグループの実行順序を設定します。このオプションを使用すると、複数のリソースグループが存在する場合の処理の順序を選択できます。
. 完了したら、適切な仮想スイッチへのネットワークマッピングを選択します。仮想スイッチは、Hyper-V内でプロビジョニング済みである必要があります。
+

NOTE: ネットワーク選択でサポートされるオプションは、仮想スイッチタイプ「External」のみです。

+

NOTE: ネットワークマッピングはGUIで使用できますが、Shiftツールキットは現在のリリースではIPアドレスの割り当てを実行しません。ただし、次のリリースでは、[Retain IP]オプションが選択可能になります。現在のリリースでは、[Do no configure Network]がデフォルトで選択されています。ディスクを変換してHyper-V側で仮想マシンを購入したら、VMウェア側の該当するポートグループとVLANに一致するようにネットワークスイッチを手動で割り当てます。

+
image:shift-toolkit-image32.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 選択したVMに基づいて、ストレージマッピングが自動的に選択されます。注：仮想マシンを作成してSMB共有からパワーオンできるように、事前にqtreeをプロビジョニングし、必要な権限が割り当てられていることを確認してください。
. [VM details]で、各OSタイプのサービスアカウントの詳細を指定します。これは、仮想マシンに接続して、VMware Toolsの削除やIP構成の詳細のバックアップに必要な特定のスクリプトを作成および実行するために使用されます。
+
image:shift-toolkit-image33.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

. 再度、[VM details]で[IP config]オプションを選択します。このリリースではIPアドレスの割り当てはサポートされていないため、デフォルトで[Do not configure]が選択されています。
. 次の手順はVMの構成です。
+
** 必要に応じて、VMのCPU / RAMパラメータのサイズを変更します。これは、サイズ変更に非常に役立ちます。
** Boot Order override：リソースグループ全体で選択したすべてのVMのBoot OrderとBoot Delay（秒）も変更します。これは、リソースグループのブート順序の選択時に選択した内容から変更が必要な場合に、ブート順序を変更するための追加オプションです。デフォルトでは、リソースグループの選択時に選択されたブート順序が使用されますが、この段階で変更を行うことができます。*パワーオン：ワークフローで仮想マシンをパワーオンしない場合は、このオプションをオフにします。デフォルトのオプションはonで、VMの電源がオンになります。
** VMwareツールの削除：Shiftツールキットは、変換前にVMwareツールを削除します。このオプションはデフォルトで選択されています。
** Generation：Shift Toolkitでは、次の経験則が使用され、デフォルトでは適切なOne-Gen1 >BIOSおよびGen2 >EFIが使用されます。このオプションは選択できません。
** Retain MAC：各VMのMACアドレスを保持して、MACに依存するアプリケーションのライセンスに関する課題を解決できます。このリリースではネットワークを変更できないため、このオプションは無効になっています。
** サービスアカウントオーバーライド:このオプションを使用すると、グローバルアカウントを使用できない場合に、別のサービスアカウントを指定できます。
+
image:shift-toolkit-image34.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



. [Create Blueprint]をクリックします。




==== 移行

ブループリントが作成されたら、[Migrate]オプションを実行できます。移行オプションの実行中、Shift Toolkitは一連の手順を実行してディスクフォーマットを変換し、変換したディスクを使用してHyper-Vホスト上に仮想マシンを作成します。この手順はブループリントで定義されています。実行する手順の概要は次のとおりです。

* ブループリントのVMスナップショットをソースでトリガー
* ボリュームSnapshotをトリガー
* ネットワーク構成をクローニングし、すべてのVMに対してVMware Toolsを削除してVMを準備する
+
** OSタイプに基づいて、必要なHyper-Vドライバが<optional>に追加される





NOTE: 詳細については、「System Stucked in dracut after the migration of a RHEL VM to Hyper-V」を参照してください。

* ソースで保護グループ内のVMの電源をオフにする
* ブループリント内のすべてのVMの既存のスナップショットを削除する
* すべてのVMのVMDKをVHDx形式にクローニングして変換
* 保護グループ内のVMの電源をオンにする（ターゲットで）


Blueprintで指定した構成をそのまま使用して移行ワークフローをトリガーするには、[Migrate]をクリックします。

image:shift-toolkit-image35.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

トリガーされると、準備段階が始まり、変換プロセスは上記の手順を実行します。


NOTE: 同じESXiソースから同じHyper-Vデスティネーションに対して並行して実行される変換は10個以下にすることを推奨します。

image:shift-toolkit-image36.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

VMDKからVHDxへの変換は数秒で行われるため、追加コストがかかるすべてのオプションの中で、このアプローチが最も高速です。これは、移行中のVMのダウンタイムを削減するのにも役立ちます。

image:shift-toolkit-image37.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

ジョブが完了すると、ブループリントのステータスが「移行完了」に変わります。

image:shift-toolkit-image38.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

移行が完了したら、Hyper-V側のVMを検証します。以下のスクリーンショットは、ブループリントの作成時に指定したHyper-Vホスト上で実行されているVMを示しています。

image:shift-toolkit-image39.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]


NOTE: 変換後、OSディスクを除くすべてのVMディスクがオフラインになります。これは、VMware VMではNewDiskPolicyパラメータがデフォルトでofflineALLに設定されているためです。



==== 変換

クローンベースの変換オプションでは、仮想ディスクをハイパーバイザー間で次のディスクフォーマットに変換するだけです。

* VMware ESXからMicrosoft Hyper-Vへ（VMDKからVHDXへ）
* VMware ESXからRed Hat KVMへ（VMDKからQCOW2へ）




===== QCOW2形式への変換

NetApp Shiftツールキットを使用して仮想ディスクをQCOW2形式に変換するには、次の手順を実行します。

* ハイパーバイザーとしてHyper-VまたはKVMを指定して、デスティネーションサイトタイプを作成します。注：KVMのハイパーバイザーの詳細は必要ありません。
+
image:shift-toolkit-image40.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* ディスク変換が必要なVMを含むリソースグループを作成する
+
image:shift-toolkit-image41.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:shift-toolkit-image42.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* 仮想ディスクをQCOW2形式に変換するブループリントを作成します。
+
image:shift-toolkit-image43.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:shift-toolkit-image44.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* VMに必要なダウンタイムが発生したら、[Convert]を選択します。
+
image:shift-toolkit-image45.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* 変換処理では、各処理がVMおよび各ディスクに対して実行され、適切な形式が生成されます。
+
image:shift-toolkit-image46.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

+
image:shift-toolkit-image47.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* 手動でVMを作成してディスクを接続し、変換したディスクを使用します。
+
image:shift-toolkit-image48.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]




NOTE: Shiftツールキットはディスク変換のみをサポートします。VMの変換はサポートされません。変換したディスクをVMで使用するには、VMを手動で作成し、ディスクをVMに接続する必要があります。


NOTE: Shift Toolkitでは、KVMハイパーバイザーのVMレベルの変換はサポートされません。ただし、KVMハイパーバイザーで使用される仮想ディスク形式であるQCOW2ディスク形式へのディスク変換はサポートされています。



===== VHDX形式への変換

NetApp Shiftツールキットを使用して仮想ディスクをVHDX形式に変換するには、次の手順を実行します。

* ハイパーバイザーとしてHyper-VまたはKVMを指定して、デスティネーションサイトタイプを作成します。
+

NOTE: KVMの場合、ハイパーバイザーの詳細は必要ありません。

+
image:shift-toolkit-image49.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* ディスク変換が必要なVMを含むリソースグループを作成する
+
image:shift-toolkit-image50.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* 仮想ディスクをVHDX形式に変換するための青写真を作成します。
+
image:shift-toolkit-image51.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* VMに必要なダウンタイムが発生したら、[Convert]を選択します。
+
image:shift-toolkit-image52.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* 変換処理では、VMおよび各ディスクに対して各処理が実行され、適切なVHDX形式が生成されます。
+
image:shift-toolkit-image53.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

* 手動でVMを作成してディスクを接続し、変換したディスクを使用します。
+
image:shift-toolkit-image54.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]




NOTE: 変換したVHDXディスクをVMで使用するには、Hyper-VマネージャまたはPowerShellコマンドを使用してVMを手動で作成し、ディスクをVMに接続する必要があります。これに加えて、ネットワークも手動でマッピングする必要があります。



==== 監視とダッシュボード

ジョブ監視を使用してジョブのステータスを監視します。

image:shift-toolkit-image55.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

直感的なUIで、移行、変換、青写真のステータスを自信を持って評価できます。これにより、管理者は、移行または変換されたVMの数とともに、成功した、失敗した、または部分的に失敗した計画を迅速に特定できます。

image:shift-toolkit-image56.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]



==== SAN環境

Shiftツールキットの主な要件として、変換対象のVMをNAS環境（NFS for ESX）に配置する必要があります。SAN環境（iSCSI、FC、FCoE、NVMeFC）にVMがある場合は、変換前にNAS環境に移行する必要があります。

image:shift-toolkit-image57.png["入力/出力ダイアログを示す図、または書き込まれた内容を表す図"]

上記のアプローチは、VMがSANデータストアに格納される一般的なSAN環境を示しています。ESXからHyper-Vに変換するVMとそのディスクは、まずVMware vSphere Storage vMotionを使用してNFSデータストアに移行されます。Shift Toolkitでは、FlexCloneを使用してVMをESXからHyper-Vに変換します。変換されたVMとそのディスクは、CIFS共有に存在します。変換されたVMとそのディスクは、Hyper-Vストレージライブマイグレーションを使用して、SAN対応のCSVに移行されます。



== まとめ

NetApp Shiftツールキットを使用すると、管理者はVMをVMwareからHyper-Vに迅速かつシームレスに変換できます。また、異なるハイパーバイザー間で仮想ディスクだけを変換することもできます。そのため、Shift Toolkitを使用すると、ハイパーバイザー間でワークロードを移動するたびに数時間の労力を節約できます。ワークロードが単一のハイパーバイザーに固定されているかどうかを気にすることなく、マルチハイパーバイザー環境をホストできるようになりました。この機能により柔軟性が向上し、ライセンスコスト、ロックイン、単一ベンダーへのコミットメントが削減されます。



== 次のステップ

Shiftツールキットパッケージをダウンロードすることで、Data ONTAPの可能性を最大限に引き出し、仮想マシンやディスクファイルの移行や変換を開始して移行を簡素化および合理化します。

このプロセスの詳細については、詳細なチュートリアルに従ってください。

.ESXからHyper-Vへのコピーレス移行
video::dc0d9627-0399-45d9-a843-b1d8010fff80[panopto,width=360]