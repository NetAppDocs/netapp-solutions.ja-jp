---
sidebar: sidebar 
permalink: ent-apps-db/saphana_aff_nfs_network_setup.html 
keywords: network, setup, nic, nfs, lacp, ifgroup, jumbo frames, vmxnet3, mtu 
summary: このセクションでは、 SAP HANA ホスト専用のストレージネットワークセットアップについて説明します。 
---
= ネットワークセットアップ
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:saphana_aff_nfs_infrastructure_setup_and_configuration_overview.html["前の手順：インフラのセットアップと設定。"]

ネットワークを設定する際は、次のガイドラインに従ってください。

* SAP HANA ホストを 10GbE 以上のネットワークでストレージコントローラに接続するには、専用のストレージネットワークを使用する必要があります。
* ストレージコントローラと SAP HANA ホストには同じ接続速度を使用します。これができない場合は、ストレージコントローラと SAP HANA ホスト間のネットワークコンポーネントが異なる速度に対応できることを確認してください。たとえば、ストレージとホストの間で NFS レベルで速度のネゴシエーションを行うための十分なバッファスペースを確保する必要があります。ネットワークコンポーネントは通常スイッチですが、背面など、ブレードシャーシ内の他のコンポーネントも考慮する必要があります。
* ストレージネットワークスイッチおよびホストレイヤで、ストレージトラフィックに使用されるすべての物理ポートでフロー制御を無効にします。
* 各 SAP HANA ホストには、 10Gb 以上の帯域幅を持つ冗長ネットワーク接続が必要です。
* SAP HANA ホストとストレージコントローラ間のすべてのネットワークコンポーネントで、最大転送単位（ MTU ）サイズが 9 、 000 のジャンボフレームを有効にする必要があります。
* VMware のセットアップでは、実行中の各仮想マシンに、専用の VMXNET3 ネットワークアダプタを割り当てる必要があります。詳細については、「はじめに」に記載されている関連文書を参照してください。
* 相互の干渉を避けるため、ログとデータ領域には別々のネットワーク /IO パスを使用してください。


次の図は、 4 台の SAP HANA ホストを 10GbE ネットワークを使用してストレージコントローラ HA ペアに接続した場合の例を示しています。各 SAP HANA ホストには、冗長ファブリックへのアクティブ / パッシブ接続があります。

ストレージレイヤでは、各 SAP HANA ホストに 10Gb のスループットを提供する、 4 つのアクティブ接続が構成されます。また、各ストレージコントローラにスペアインターフェイスが 1 つ設定されます。

ストレージレイヤでは、 MTU サイズが 9 、 000 のブロードキャストドメインが設定され、必要なすべての物理インターフェイスがこのブロードキャストドメインに追加されます。このアプローチでは、これらの物理インターフェイスが自動的に同じフェイルオーバーグループに割り当てられます。これらの物理インターフェイスに割り当てられているすべての論理インターフェイス（ LIF ）が、このフェイルオーバーグループに追加されます。

image:saphana_aff_nfs_image10.png["エラー：グラフィックイメージがありません"]

一般に、サーバ（ボンド）とストレージシステム（ Link Aggregation Control Protocol （ LACP ）、 ifgroups など）で HA インターフェイスグループを使用することもできます。HA インターフェイスグループを使用して、グループ内のすべてのインターフェイス間で負荷が均等に分散されていることを確認します。負荷分散は、ネットワークスイッチインフラの機能によって異なります。


NOTE: SAP HANA ホストの数と使用されている接続速度に応じて、アクティブな物理ポートの数を変える必要があります。詳細については、を参照してください link:saphana_aff_nfs_storage_controller_setup.html#lif-configuration["LIF の設定"]。



== VMware 固有のネットワークセットアップ

この解決策では、パフォーマンスを重視するデータベースのデータボリュームやログボリュームなど、 SAP HANA インスタンスのすべてのデータが NFS 経由で提供されるため、適切なネットワーク設計と構成が不可欠です。専用のストレージネットワークは、 SAP HANA ノード間の通信トラフィックとユーザアクセストラフィックから NFS トラフィックを分離するために使用されます。各 SAP HANA ノードには、 10Gb 以上の帯域幅を持つ冗長専用ネットワーク接続が必要です。より高い帯域幅もサポートされています。このネットワークは、 VMware vSphere でホストされているゲストオペレーティングシステムまで、ストレージレイヤからネットワークスイッチングおよびコンピューティング経由でエンドツーエンドで拡張する必要があります。物理スイッチングインフラストラクチャに加えて、ハイパーバイザーレイヤでネットワークトラフィックのパフォーマンスと管理性を十分に確保するために、 VMware Distributed Switch （ vDS ）が使用されます。

image:saphana_aff_nfs_image11.png["エラー：グラフィックイメージがありません"]

前の図に示すように、各 SAP HANA ノードは、 VMware Distributed Switch 上の専用のポートグループを使用します。このポートグループを使用すると、 ESX ホストのサービス品質（ QoS ）の向上と物理 Network Interface Card （ NIC ；ネットワークインターフェイスカード）の専用割り当てが可能になります。NIC の障害時に HA 機能を維持したまま専用の物理 NIC を使用するには、専用の物理 NIC をアクティブアップリンクとして設定します。SAP HANA ポートグループのチーミングとフェイルオーバーの設定では、追加の NIC がスタンバイアップリンクとして設定されます。また、物理スイッチと仮想スイッチでジャンボフレーム（ MTU 9 、 000 ）をエンドツーエンドで有効にする必要があります。また、サーバ、スイッチ、およびストレージシステムのストレージトラフィックに使用されるすべてのイーサネットポートでフロー制御を無効にします。次の図に、このような構成の例を示します。


NOTE: NFS トラフィックに使用されるインターフェイスでは、 LRO （ Large Receive Offload ）をオフにする必要があります。その他のネットワーク構成のガイドラインについては、それぞれの VMware ベストプラクティスガイドで SAP HANA を参照してください。

image:saphana_aff_nfs_image12.png["エラー：グラフィックイメージがありません"]

link:saphana_aff_nfs_time_synchronization.html["Next ：時刻の同期。"]
