---
sidebar: sidebar 
permalink: ent-apps-db/saphana-fas-nfs_storage_controller_setup.html 
keywords: storage, controller, setup, efficiency, fabricpool, disk, shelf, aggregate, configuration, hdd, nfs, nfsv3, nfsv4, sap, hana, host, systems 
summary: ここでは、ネットアップストレージシステムの構成について説明します。プライマリのインストールとセットアップは、対応する ONTAP のセットアップガイドおよび設定ガイドに従って実行する必要があります。 
---
= ストレージコントローラのセットアップ
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


ここでは、ネットアップストレージシステムの構成について説明します。プライマリのインストールとセットアップは、対応する ONTAP のセットアップガイドおよび設定ガイドに従って実行する必要があります。



== ストレージ効率

SSD 構成の SAP HANA では、インライン重複排除、ボリューム間インライン重複排除、インライン圧縮、インラインコンパクションがサポートされています。

HDD ベースの構成で Storage Efficiency 機能を有効にすることはできません。



== NetApp Volume Encryption の略

SAP HANA では、 NetApp Volume Encryption （ NVE ）がサポートされています。



== サービス品質

QoS を使用すると、特定の SAP HANA システムやその他のアプリケーションの共有使用コントローラにおけるストレージスループットを制限できます。1 つのユースケースとして、開発システムとテストシステムのスループットを制限し、混在環境で本番システムに影響を与えないようにすることが挙げられます。

サイジングプロセスでは、非本番システムのパフォーマンス要件を決定する必要があります。開発 / テスト用のシステムは、通常、 SAP で定義されている本番用システム KPI の 20~50% の範囲で、パフォーマンス値を低くしてサイジングすることができます。

ONTAP 9 以降では、ストレージボリュームレベルで QoS が設定され、スループット（ MBps ）と I/O 量（ IOPS ）に最大値が使用されます。

ストレージシステムのパフォーマンスに最大の影響があるのは、大きい書き込み I/O です。そのため、 QoS スループットの制限値として、データボリュームとログボリュームの対応する書き込み SAP HANA ストレージパフォーマンス KPI 値の割合を設定する必要があります。



== NetApp FabricPool

SAP HANA システムのアクティブなプライマリファイルシステムには、 NetApp FabricPool テクノロジを使用しないでください。これには ' データとログ領域のファイル・システムと '/hana/shared-file システムが含まれますそのため、特に SAP HANA システムの起動時に、予測不可能なパフォーマンスが発生します。

「 snapshot-only 」階層化ポリシーを使用することも、 SnapVault または SnapMirror デスティネーションなどのバックアップターゲットで一般的に FabricPool を使用することもできます。


NOTE: FabricPool を使用してプライマリストレージで Snapshot コピーを階層化するか、バックアップターゲットで FabricPool を使用すると、データベースまたはシステムクローンの作成や修復などのその他のタスクのリストアとリカバリに必要な時間が変わります。この点を考慮して、ライフサイクル全体の管理戦略を計画し、この機能を使用している間も SLA が満たされていることを確認してください。

FabricPool は、ログバックアップを別のストレージ階層に移動する場合に適しています。バックアップの移動は、 SAP HANA データベースのリカバリに要する時間に影響します。したがって、「 tiering-minimum-cooling-days 」オプションには、リカバリに必要なログバックアップをローカルの高速ストレージ階層に定期的に配置する値を設定する必要があります。



== ストレージ構成

以下に、必要なストレージ構成手順の概要を示します。各手順の詳細については、以降のセクションで説明します。このセクションでは、ストレージハードウェアがセットアップされており、 ONTAP ソフトウェアがすでにインストールされていることを前提としています。また、ストレージポート（ 10GbE 以上）とネットワークの間の接続がすでに確立されている必要があります。

. の説明に従って、正しい SAS スタック構成を確認します link:saphana-fas-nfs_storage_controller_setup.html#disk-shelf-connection["ディスクシェルフの接続"]
. の説明に従って、必要なアグリゲートを作成して構成します link:saphana-fas-nfs_storage_controller_setup.html#aggregate-configuration["アグリゲートの構成："]
. の説明に従って、 Storage Virtual Machine （ SVM ）を作成します link:saphana-fas-nfs_storage_controller_setup.html#storage-virtual-machine-configuration["Storage Virtual Machine の設定。"]
. の説明に従って、 LIF を作成します link:saphana-fas-nfs_storage_controller_setup.html#logical-interface-configuration["論理インターフェイスの構成"]
. の説明に従って、アグリゲート内にボリュームを作成します link:saphana-fas-nfs_storage_controller_setup.html#volume-configuration-for-sap-hana-single-host-systems["SAP HANA シングルホストシステムのボリューム構成"] および 
. の説明に従って、必要なボリュームオプションを設定します link:saphana-fas-nfs_storage_controller_setup.html#volume-options["ボリュームのオプション"]
. の説明に従って、 NFSv3 に必要なオプションを設定します link:saphana-fas-nfs_storage_controller_setup.html#nfs-configuration-for-nfsv3["NFSv3 用の NFS 設定"] の説明に従って、 NFSv4 の場合はまたはです 
. の説明に従って、ボリュームをネームスペースにマウントし、エクスポートポリシーを設定します link:saphana-fas-nfs_storage_controller_setup.html#mount-volumes-to-namespace-and-set-export-policies["ボリュームをネームスペースにマウントし、エクスポートポリシーを設定"]




== ディスクシェルフの接続

HDD を使用すると、次の図に示すように、 1 つの SAS スタックに最大 2 台の DS2246 ディスクシェルフまたは 4 台の DS224C ディスクシェルフを接続することで、 SAP HANA ホストに必要なパフォーマンスを実現できます。各シェルフ内のディスクは、 HA ペアの両方のコントローラに均等に分散する必要があります。

image:saphana-fas-nfs_image13.png["エラー：グラフィックイメージがありません"]

SSD を使用する場合は、次の図に示すように、 1 つの SAS スタックに最大 1 台のディスクシェルフを接続して、 SAP HANA ホストに必要なパフォーマンスを実現できます。各シェルフ内のディスクは、 HA ペアの両方のコントローラに均等に分散する必要があります。ディスクシェルフ DS224C では、クワッドパスの SAS ケーブルも使用できますが、必須ではありません。

image:saphana-fas-nfs_image14.png["エラー：グラフィックイメージがありません"]



== アグリゲートの構成

一般に、使用するディスクシェルフやドライブテクノロジ（ SSD または HDD ）に関係なく、コントローラごとに 2 つのアグリゲートを設定する必要があります。FAS2000 シリーズ・システムには、 1 つのデータ・アグリゲートで十分です。



=== HDD を使用したアグリゲート構成

次の図は、 8 台の SAP HANA ホストの構成を示しています。4 台の SAP HANA ホストが各ストレージコントローラに接続されています。各ストレージコントローラに 1 つずつ、合計 2 つのアグリゲートが構成されています。各アグリゲートには、 4 × 10 = 40 のデータディスク（ HDD ）が構成されます。

image:saphana-fas-nfs_image15.png["エラー：グラフィックイメージがありません"]



=== SDD 専用システムで構成を集約する

一般に、使用するディスクシェルフやディスクテクノロジ（ SSD または HDD ）に関係なく、コントローラごとに 2 つのアグリゲートを構成する必要があります。FAS2000 シリーズ・システムには、 1 つのデータ・アグリゲートで十分です。

次の図は、 ADPv2 を使用した、 12Gb の SAS シェルフで稼働する、 12 台の SAP HANA ホストの構成を示しています。6 台の SAP HANA ホストが各ストレージコントローラに接続されています。各ストレージコントローラに 2 つずつ、合計 4 つのアグリゲートが構成されています。各アグリゲートには、 9 つのデータパーティションと 2 つのパリティディスクパーティションを含む 11 本のディスクが構成されます。各コントローラで、 2 つのスペアパーティションを使用できます。

image:saphana-fas-nfs_image16.jpg["エラー：グラフィックイメージがありません"]



== Storage Virtual Machine の設定

SAP HANA データベースを使用する複数の SAP ランドスケープでは、単一の SVM を使用できます。SVM は、社内の複数のチームによって管理される場合に備え、必要に応じて各 SAP ランドスケープに割り当てることもできます。

QoS プロファイルが自動的に作成されて新しい SVM の作成時に割り当てられた場合は、自動的に作成されたプロファイルを SVM から削除して、 SAP HANA に必要なパフォーマンスを提供します。

....
vserver modify -vserver <svm-name> -qos-policy-group none
....


== 論理インターフェイスの構成

SAP HANA 本番システムでは、 SAP HANA ホストからデータボリュームとログボリュームをマウントするために別々の LIF を使用する必要があります。したがって、少なくとも 2 つの LIF が必要です。

異なる SAP HANA ホストのデータボリュームマウントとログボリュームマウントは、同じ LIF を使用するか、マウントごとに個別の LIF を使用することで、物理ストレージネットワークポートを共有できます。

物理インターフェイスごとのデータボリュームマウントとログボリュームマウントの最大数を次の表に示します。

|===
| イーサネットポート速度 | 10GbE | 25GbE | 40GbE | 100 Gee 


| 物理ポートあたりのログボリュームマウントまたはデータボリュームマウントの最大数 | 2. | 6. | 12. | 24 
|===

NOTE: 異なる SAP HANA ホスト間で 1 つの LIF を共有するには、データボリュームまたはログボリュームを別の LIF に再マウントすることが必要になる場合があります。この変更により、ボリュームが別のストレージコントローラに移動された場合のパフォーマンス低下を回避できます。

開発 / テスト用システムでは、物理ネットワークインターフェイス上で使用できるデータおよびボリュームのマウントや LIF を増やすことができます。

本番システム ' 開発システム ' およびテスト・システムでは '/hana/shared ファイル・システムは ' データ・ボリュームまたはログ・ボリュームと同じ LIF を使用できます



== SAP HANA シングルホストシステムのボリューム構成

次の図は、 4 つのシングルホスト SAP HANA システムのボリューム構成を示しています。各 SAP HANA システムのデータボリュームとログボリュームは、異なるストレージコントローラに分散されます。たとえば、ボリューム「 ID1_data_mnt00001 」がコントローラ A で設定され、ボリューム「 ID1_log_mnt00001 」がコントローラ B で設定されているとします


NOTE: HA ペアのうち、 1 台のストレージコントローラのみを SAP HANA システムに使用する場合は、データボリュームとログボリュームを同じストレージコントローラに保存することもできます。


NOTE: データボリュームとログボリュームが同じコントローラに格納されている場合は、サーバからストレージへのアクセスに、 2 つの異なる LIF を使用して実行する必要があります。 1 つはデータボリュームにアクセスする LIF で、もう 1 つはログボリュームにアクセスする LIF です。

image:saphana-fas-nfs_image17.jpg["エラー：グラフィックイメージがありません"]

各 SAP HANA DB ホストには、データボリューム、ログボリューム、「 /hana/shared 」のボリュームが構成されています。次の表は、シングルホスト SAP HANA システムの構成例を示しています。

|===
| 目的 | コントローラ A のアグリゲート 1 | コントローラ A のアグリゲート 2 | コントローラ B のアグリゲート 1 | コントローラ b のアグリゲート 2 


| システム SID1 のデータ、ログ、および共有ボリューム | データボリューム： SID1_data_mnt00001 | 共有ボリューム： SID1_shared | – | ログボリューム： SID1_log_mnt00001 


| システム SID2 のデータボリューム、ログボリューム、および共有ボリューム | – | ログボリューム： SID2_log_mnt00001 | データボリューム： SID2_data_mnt00001 | 共有ボリューム： SID2_shared 


| システム SID3 のデータ、ログ、および共有ボリューム | 共有ボリューム： SID3_shared | データボリューム： SID3_data_mnt00001 | ログボリューム： SID3_log_mnt00001 | – 


| システム SID4 のデータボリューム、ログボリューム、および共有ボリューム | ログボリューム： SID4_log_mnt00001 | – | 共有ボリューム： SID4_shared | データボリューム： SID4_data_mnt00001 
|===
次の表に、シングルホストシステムのマウントポイント構成例を示します。「 idadm 」ユーザのホーム・ディレクトリを中央ストレージに配置するには、「 /usr/sap/SID 」ファイル・システムを「 S ID_SHARED 」ボリュームからマウントする必要があります。

|===
| ジャンクションパス | ディレクトリ | HANA ホストのマウントポイント 


| SID_data_mnt00001 | – | /hana/data/SID/mnt00001 


| SID_log_mnt00001 | – | /hana/log/sid/mnt00001 


| SID_shared | usr - SAP 共有 | /usr/sap/SID/hana/shared に格納されています 
|===


== SAP HANA マルチホストシステムのボリューム構成

次の図は、 4+1 の SAP HANA システムのボリューム構成を示しています。各 SAP HANA ホストのデータボリュームとログボリュームは、異なるストレージコントローラに分散されます。たとえば、ボリューム「 ID1_data1_mnt00001 」がコントローラ A に設定され、ボリューム「 ID1_log1_mnt00001 」がコントローラ B に設定されているとします


NOTE: HA ペアのうち、 1 台のストレージコントローラのみを SAP HANA システムに使用する場合は、データボリュームとログボリュームを同じストレージコントローラに保存することもできます。


NOTE: データボリュームとログボリュームが同じコントローラに格納されている場合は、サーバからストレージへのアクセスに、 2 つの異なる LIF を使用して実行する必要があります。 1 つはデータボリュームにアクセスするため、もう 1 つはログボリュームにアクセスするためです。

image:saphana-fas-nfs_image18.jpg["エラー：グラフィックイメージがありません"]

各 SAP HANA ホストには、 1 個のデータボリュームと 1 個のログボリュームが作成されます。「 /hana/shared 」ボリュームは、 SAP HANA システムのすべてのホストで使用されます。次の表に、 4 つのアクティブホストを持つ、マルチホスト SAP HANA システムの構成例を示します。

|===
| 目的 | コントローラ A のアグリゲート 1 | コントローラ A のアグリゲート 2 | コントローラ B のアグリゲート 1 | コントローラ B のアグリゲート 2 


| ノード 1 のデータボリュームとログボリューム | データボリューム： SID_data_mnt00001 | – | ログボリューム： SID_log_mnt00001 | – 


| ノード 2 のデータボリュームとログボリューム | ログボリューム： SID_log_mnt00002 | – | データボリューム： SID_data_mnt00002 | – 


| ノード 3 のデータボリュームとログボリューム | – | データボリューム： SID_data_mnt00003 | – | ログボリューム： SID_log_mnt00003 


| ノード 4 のデータボリュームとログボリューム | – | ログボリューム： SID_log_mnt00004 | – | データボリューム： SID_data_mnt00004 


| すべてのホストの共有ボリューム | 共有ボリューム： SID_shared | – | – | – 
|===
次の表に、アクティブな SAP HANA ホストが 4 台あるマルチホストシステムの構成とマウントポイントを示します。各ホストの 'idadm' ユーザのホーム・ディレクトリを中央ストレージに配置するために '/usr/sap/SID' ファイル・システムは 'S ID_SHARED' ボリュームからマウントされます

|===
| ジャンクションパス | ディレクトリ | SAP HANA ホストのマウントポイント | 注 


| SID_data_mnt00001 | – | /hana/data/SID/mnt00001 | すべてのホストにマウントされています 


| SID_log_mnt00001 | – | /hana/log/sid/mnt00001 | すべてのホストにマウントされています 


| SID_data_mnt00002 | – | /hana/data/sid/mnt00002 | すべてのホストにマウントされています 


| SID_log_mnt00002 | – | /hana/log/sid/mnt00002 | すべてのホストにマウントされています 


| SID_data_mnt00003 | – | /hana/data/sid/mnt00003 | すべてのホストにマウントされています 


| SID_log_mnt00003 | – | /hana/log/sid/mnt00003 | すべてのホストにマウントされています 


| SID_data_mnt00004 | – | /hana/data/sid/mnt00004 | すべてのホストにマウントされています 


| SID_log_mnt00004 | – | /hana/log/sid/mnt00004 | すべてのホストにマウントされています 


| SID_shared | 共有 | /hana/shareed/ | すべてのホストにマウントされています 


| SID_shared | usr-sap-host1 | /usr/sap/SID | ホスト 1 にマウントされています 


| SID_shared | usr-sap-host2 | /usr/sap/SID | ホスト 2 にマウントされています 


| SID_shared | usr-sap-host3 | /usr/sap/SID | ホスト 3 にマウント 


| SID_shared | usr-sap-host4 | /usr/sap/SID | ホスト 4 にマウント 


| SID_shared | usr-sap-host5 | /usr/sap/SID | ホスト 5 にマウント 
|===


== ボリュームのオプション

すべての SVM について、次の表に示すボリュームオプションを確認して設定する必要があります。一部のコマンドについては、 ONTAP で advanced 権限モードに切り替える必要があります。

|===
| アクション | コマンドを実行します 


| Snapshot ディレクトリの可視化を無効にします | vol modify -vserver <vserver-name> -volume <volname> -snapdir-access false 


| Snapshot コピーの自動作成を無効にする | vol modify – vserver <vserver-name> -volume <volname> -snapshot-policy none と指定します 


| SID_shared ボリュームを除くアクセス時間の更新を無効にします  a| 
advanced 権限レベルの vol modify -vserver <vserver-name> -volume <volname> -atime-update false set admin を設定します

|===


== NFSv3 用の NFS 設定

次の表に示す NFS オプションは、すべてのストレージコントローラで検証および設定する必要があります。

ここに示す一部のコマンドについては、 ONTAP で advanced 権限モードに切り替える必要があります。

|===
| アクション | コマンドを実行します 


| NFSv3 を有効にします | nfs modify -vserver <vserver -name> v3.0 enabled 


| ONTAP 9 ： NFS TCP の最大転送サイズを 1MB に設定します  a| 
advanced 権限レベルの nfs modify -vserver <vserver_name> -tcp-max-xfer-size 1048576 set admin を設定します



| ONTAP 8 ： NFS の読み取りサイズと書き込みサイズを 64KB に設定します  a| 
advanced 権限レベルの nfs modify -vserver <vserver-name> -v3-tcp-max-read-size 65536 nfs modify -vserver <vserver-name> -v3-tcp-max-write-size 65536 set admin に設定します

|===


== NFSv4 の NFS 設定

次の表に示す NFS オプションは、すべての SVM で検証および設定する必要があります。

一部のコマンドについては、 ONTAP で advanced 権限モードに切り替える必要があります。

|===
| アクション | コマンドを実行します 


| NFSv4 を有効にします | nfs modify -vserver <vserver-name> -v4.1 enabled と入力します 


| ONTAP 9 ： NFS TCP の最大転送サイズを 1MB に設定します | advanced 権限レベルの nfs modify -vserver <vserver_name> -tcp-max-xfer-size 1048576 set admin を設定します 


| ONTAP 8 ： NFS の読み取りサイズと書き込みサイズを 64KB に設定します | advanced 権限レベルの nfs modify -vserver <vserver_name> -tcp-max-xfer-size 65536 set admin を設定します 


| NFSv4 のアクセス制御リスト（ ACL ）を無効にする | nfs modify -vserver <vserver_name>-v4.1-acl disabled 


| NFSv4 ドメイン ID を設定する | nfs modify -vserver <vserver_name>-v4-id-domain <domain-name> 


| NFSv4 の読み取り委譲を無効にする | nfs modify -vserver <vserver_name>-v4.1-read-delegation disabled 


| NFSv4 の書き込み委譲を無効にする | nfs modify -vserver <vserver_name>-v4.1-write-delegation disabled 


| NFSv4 リース時間を設定する | advanced 権限レベルの nfs modify -vserver <vserver_name>-v4-lease-seconds 10 set admin を設定します 


| NFSv4 数値 ID を無効にする | nfs modify -vserver <vserver_name>-v4-numeric-ids disabled 
|===

NOTE: NFS バージョン 4 の場合。0 、 4 を置き換えます。以前のコマンドでは '1' には '4.0' が含まれていますNFSv4.0 はサポートされていますが、 NFSv4.1 を使用することを推奨します。


NOTE: NFSv4 ドメイン ID は、すべての Linux サーバ（ /etc/idmapd.conf ）と SVM で同じ値に設定する必要があります（を参照） link:saphana-fas-nfs_sap_hana_installation_preparations_for_nfsv4.html["NFSv4 用の SAP HANA インストールの準備"]


NOTE: NFSv4.1 を使用している場合、 pNFS は有効になっており、デフォルトで使用されます（推奨）。

SAP HANA マルチホストシステムを使用している場合は、次の表に示すように、 SVM で NFSv4 リース時間を設定します。

|===
| アクション | コマンドを実行します 


| NFSv4 リース時間を設定する | advanced 権限レベルの nfs modify -vserver <vserver_name>-v4-lease-seconds 10 set admin を設定します 
|===
HANA 2.0 SPS4 以降では、フェイルオーバーの動作を制御するためのパラメータが用意されています。SVM レベルでリース時間を設定する代わりに、これらの HANA パラメータを使用することを推奨します。これらのパラメータは ' 次の表に示すように nameserver.ini` 内にありますこれらのセクションでは、デフォルトの再試行間隔を 10 秒に設定します。

|===
| nameserver.ini 内のセクション | パラメータ | 価値 


| フェイルオーバー | normal_retries | 9. 


| distributed_watchdog | Deactivate_retries | 11. 


| distributed_watchdog | TAKEOVER_retries を指定します | 9. 
|===


== ボリュームをネームスペースにマウントし、エクスポートポリシーを設定

ボリュームを作成するときは、ボリュームをネームスペースにマウントする必要があります。このドキュメントでは、ジャンクションパス名がボリューム名と同じであると想定しています。デフォルトでは、ボリュームはデフォルトポリシーを使用してエクスポートされます。エクスポートポリシーは必要に応じて適用できます。
