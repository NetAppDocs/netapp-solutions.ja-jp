---
sidebar: sidebar 
permalink: ent-apps-db/saphana-dr-anf_disaster_recovery_solution_comparison.html 
keywords: sap, hana, system, replication, data, memory, disaster, recovery, solutions, azure 
summary: 包括的なディザスタリカバリ解決策では、お客様がプライマリサイトの完全な障害からリカバリできるようにする必要があります。 
---
= ディザスタリカバリ解決策の比較
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:saphana-dr-anf_data_protection_overview_overview.html["前のバージョン： Azure NetApp Files を使用した SAP HANA ディザスタリカバリの概要"]

包括的なディザスタリカバリ解決策では、お客様がプライマリサイトの完全な障害からリカバリできるようにする必要があります。そのため、サイト障害が発生した場合に必要な本番用 SAP HANA システムを実行するには、データをセカンダリサイトに転送し、インフラ全体を構築する必要があります。アプリケーションの可用性の要件や保護する災害の種類に応じて、 2 サイトまたは 3 サイトのディザスタリカバリ解決策を検討する必要があります。

次の図は、データが同じ Azure リージョン内で同時に 2 つ目のアベイラビリティゾーンにレプリケートされる一般的な設定を示しています。短距離では、データを同期的にレプリケートして、 RPO をゼロにすることができます（一般に HA の提供に使用されます）。

また、プライマリリージョンに影響が生じた場合は、災害から保護するためにデータがセカンダリリージョンに非同期でレプリケートされます。達成可能な最小 RPO は、データレプリケーションの頻度によって異なります。この頻度は、プライマリリージョンとセカンダリリージョンの間で使用可能な帯域幅によって制限されます。一般的な最小 RPO は、 20 分から複数時間の範囲です。

このドキュメントでは、 2 リージョンのディザスタリカバリ解決策のさまざまな実装オプションについて説明します。

image:saphana-dr-anf_image3.png["エラー：グラフィックイメージがありません"]



== SAP HANA システムレプリケーション

SAP HANA システムレプリケーションはデータベースレイヤで機能します。解決策は、プライマリシステムから変更を受信するディザスタリカバリサイトにある追加の SAP HANA システムに基づいています。このセカンダリシステムは、プライマリシステムと同じである必要があります。

SAP HANA システムレプリケーションは、次のいずれかのモードで実行できます。

* データがメモリにプリロードされており、ディザスタリカバリサイトにある専用サーバにロードされている場合：
+
** このサーバは、 SAP HANA システムレプリケーションセカンダリホストとしてのみ使用されます。
** データはすでにメモリにロードされており、フェイルオーバー時にデータベースを起動する必要がないため、 RTO 値は非常に低くなります。


* メモリおよび災害復旧サイトの共有サーバにデータがプリロードされていない場合：
+
** サーバは、 SAP HANA システムレプリケーションセカンダリシステムおよび開発 / テストシステムとして共有されます。
** RTO は、主にデータベースの起動とメモリへのデータのロードに必要な時間に左右されます。




すべての設定オプションとレプリケーションシナリオの概要の詳細については、を参照してください https://help.sap.com/saphelp_hanaplatform/helpdata/en/67/6844172c2442f0bf6c8b080db05ae7/content.htm?frameset=/en/52/08b5071e3f45d5aa3bcbb7fde10cec/frameset.htm&current_toc=/en/00/0ca1e3486640ef8b884cdf1a050fbb/plain.htm&node_id=527&show_children=f["『 SAP HANA Administration Guide 』をご覧ください"^]。

次の図は、 SAP HANA システムレプリケーションを使用した 2 リージョンのディザスタリカバリ解決策のセットアップを示しています。メモリにプリロードされたデータを含む同期レプリケーションは、同じ Azure リージョン内のローカル HA には使用されますが、アベイラビリティゾーンによって異なります。リモートのディザスタリカバリリージョンには、データがプリロードされていない非同期レプリケーションが設定されています。

次の図は、 SAP HANA システムレプリケーションを示しています。

image:saphana-dr-anf_image4.png["エラー：グラフィックイメージがありません"]



=== SAP HANA システムレプリケーションとメモリにデータがプリロードされています

SAP HANA の RTO 値が非常に低い場合は、メモリにデータがプリロードされた SAP HANA System Replication でのみ達成できます。ディザスタリカバリサイトにある専用のセカンダリサーバを使用して SAP HANA システムレプリケーションを運用すると、 RTO の値が約 1 分以下になります。複製されたデータは、セカンダリシステムのメモリにロードされて受信されます。フェイルオーバーにかかる時間が短く、 SAP HANA システムレプリケーションは、 HANA ソフトウェアのアップグレードなど、ダウンタイムがほぼゼロに近いメンテナンス処理にも使用されることがよくあります。

通常、 SAP HANA システムレプリケーションは、データプリロードが選択されたときに同期的にレプリケートされるように設定されます。同期レプリケーションでサポートされる最大距離は 100km です。



=== SAP システムレプリケーション：メモリにデータがプリロードされていません

RTO 要件が厳しくない場合は、データがプリロードされていなくても SAP HANA システムレプリケーションを使用できます。この運用モードでは、ディザスタリカバリ領域のデータはメモリにロードされません。DR リージョンのサーバは、必要なすべての SAP HANA プロセスを実行する SAP HANA システムレプリケーションの処理にも使用されます。ただし、サーバのメモリのほとんどは、 SAP HANA 開発 / テストシステムなどの他のサービスを実行するために使用できます。

障害が発生した場合は、開発 / テストシステムをシャットダウンし、フェイルオーバーを開始して、データをメモリにロードする必要があります。このコールドスタンバイアプローチの RTO は、データベースのサイズと、行ストアと列ストアの負荷時の読み取りスループットによって異なります。1000Mbps のスループットでデータが読み取られることを前提として、 1TB のデータをロードするには約 18 分かかります。



== ANF クロスリージョンレプリケーションを使用した SAP HANA ディザスタリカバリ

ANF には、非同期データレプリケーションを使用したディザスタリカバリ解決策として ANF に組み込まれています。ANF クロスリージョンレプリケーションは、プライマリリージョンとセカンダリ Azure リージョンの 2 つの ANF ボリューム間でデータ保護関係を介して設定されます。ANF のクロスリージョンレプリケーションでは、ブロックの差分レプリケーションを効率的に使用してセカンダリボリュームが更新されます。更新スケジュールはレプリケーション設定時に定義できます。

次の図は、 ANF クロスリージョンレプリケーションを使用した 2 リージョンのディザスタリカバリ解決策の例を示しています。この例では、前の章で説明したように、 HANA システムはプライマリリージョン内で HANA システムレプリケーションによって保護されています。セカンダリリージョンへのレプリケーションは、 ANF のクロスリージョンレプリケーションを使用して実行されます。RPO は、レプリケーションスケジュールとレプリケーションオプションによって定義されます。

RTO は、主に、ディザスタリカバリサイトで HANA データベースを起動してメモリにデータをロードするのに必要な時間に左右されます。データの読み取りスループットが 1000Mb/s の場合、 1TB のデータをロードするには約 18 分かかります。レプリケーション設定に応じて、フォワードリカバリが必要で、 RTO の合計値にも加算されます。

さまざまな設定オプションの詳細については、の章を参照してください link:ent-apps-db/saphana-dr-anf_anf_cross-region_replication_with_sap_hana_overview.html["SAP HANA を使用したリージョン間レプリケーションの構成オプション"]。

通常の運用中は、ディザスタリカバリサイトのサーバを開発 / テストシステムとして使用できます。災害が発生した場合は、開発 / テスト用システムをシャットダウンし、 DR 本番用サーバとして起動する必要があります。

ANF クロスリージョンレプリケーションを使用すると、 RPO と RTO に影響を与えることなく DR ワークフローをテストできます。そのためには、ボリュームクローンを作成し、 DR テストサーバに接続します。

image:saphana-dr-anf_image5.png["エラー：グラフィックイメージがありません"]



== ディザスタリカバリソリューションの概要

次の表に、このセクションで説明したディザスタリカバリソリューションの比較を示し、最も重要な指標を示します。

主な調査結果は次のとおりです。

* RTO が非常に低い場合は、プリロードが設定された SAP HANA システムレプリケーションが唯一のオプションです。
+
** DR サイトに専用のサーバが必要となります。これにより、レプリケートされたデータを受信してデータをメモリにロードできます。


* また、データベースの外部にあるデータ（共有ファイル、インターフェイスなど）にもストレージレプリケーションが必要です。
* RTO / RPO の要件が厳しい場合は、 ANF のクロスリージョンレプリケーションを使用して次のことを行うこともできます。
+
** データベースと非データベースのデータレプリケーションを組み合わせます。
** ディザスタリカバリのテストや開発 / テストの更新など、その他のユースケースについて説明します。
** ストレージレプリケーションを行うことで、 DR サイトのサーバを QA またはテストシステムとして通常運用時に使用できます。


* RPO = 0 の HA 解決策として SAP HANA システムレプリケーションを組み合わせ、長距離のストレージレプリケーションを行う場合は、さまざまな要件に対応することが重要です。


次の表に、ディザスタリカバリソリューションの比較を示します。

|===
|  | ストレージレプリケーション 2+| SAP HANA システムのレプリケーション 


|  | * リージョン間レプリケーション * | * データプリロードあり * | * データプリロードなし * 


| RTO | データベースの起動時間およびフォワードリカバリに応じて、低 ～ 中 | とても低いです | データベースの起動時間に応じて、低から中に移動します 


| RPO | RPO > 20 分の非同期レプリケーション | RPO > 20 分の非同期レプリケーション RPO = 0 の同期レプリケーション | RPO > 20 分の非同期レプリケーション RPO = 0 の同期レプリケーション 


| DR サイトのサーバは、開発とテストに使用できます | はい。 | いいえ | はい。 


| データベース以外のデータのレプリケーション | はい。 | いいえ | いいえ 


| DR データは、開発 / テストシステムの更新に使用できます | はい。 | いいえ | いいえ 


| RTO と RPO に影響を与えずに DR テストを実施 | はい。 | いいえ | いいえ 
|===
link:saphana-dr-anf_anf_cross-region_replication_with_sap_hana_overview.html["次のセクションでは、 SAP HANA を使用した ANF のクロスリージョンレプリケーションについて説明します。"]
