---
sidebar: sidebar 
permalink: infra/rhv-4._deploy_rhv-h_hypervisor.html 
keywords: self-hosted, RHV-H hypervisor, HCI, compute nodes, VLAN, bond configuration 
summary:  
---
= 4. HCI コンピューティングノードに RHV - H ハイパーバイザーを導入する： RHV 搭載 NetApp HCI
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
この解決策は、最小限のセットアップ（ 2 つの自己ホスト型エンジンノード）で RHV 導入の推奨される自己ホスト型エンジンアーキテクチャを採用しています。これらの手順は、ノードがラックに設置されてケーブル接続され、コンソールを使用するために各ノードに IPMI ポートが設定されたあとに開始されます。HCI コンピューティングノードに RHV - H ハイパーバイザーを導入するには、次の手順を実行します。

. クラスタ内のコンピューティングノードのアウトオブバンド管理コンソールにアクセスし、デフォルトのクレデンシャルである Admin/Admin でログインします。
+
image:redhat_virtualization_image5.png["エラー：グラフィックイメージがありません"]

. 画面の中央にある Remote Console Preview 画像をクリックして、 Java Web Start で起動された JNLP ファイルをダウンロードします。これにより、システムへの対話型コンソールが起動します。
. 仮想コンソールが起動したら、 [Virtual Media] > [Virtual Storage] の順に移動してクリックし、 RHV-H 4.3.9 ISO を取り付けます。
+
image:redhat_virtualization_image17.jpeg["エラー：グラフィックイメージがありません"]

. Logical Drive Type （論理ドライブタイプ）で、ドロップダウンから ISO File （ ISO ファイル）を選択します。RHV-H 4 のフルパスとフルネームを入力します。3.9 画像を開くボタンをクリックして ISO ファイルを添付するか、添付します。[ プラグイン ] をクリックします。
+
image:redhat_virtualization_image18.png["エラー：グラフィックイメージがありません"]

. PowerControl > Set Power Reset をクリックして、 RHV-H 4.3.9 ISO を使用して起動するようにサーバーを再起動します。
+
image:redhat_virtualization_image19.jpg["エラー：グラフィックイメージがありません"]

. ノードがリブートして初期画面が表示されたら、 F11 キーを押してブートメニューを表示します。起動メニューからに移動し、 ATEN Virtual CDROM YSOJ をクリックします。
+
image:redhat_virtualization_image20.jpeg["エラー：グラフィックイメージがありません"]

. 次の画面で、 RHV 4.3 のインストールに移動してクリックします。これにより、イメージがロードされ、インストール前スクリプトが実行され、 Red Hat Enterprise Linux システムインストーラである Anaconda が起動します。
+
image:redhat_virtualization_image21.png["エラー：グラフィックイメージがありません"]

. インストールの開始画面が表示されます。使用する言語を選択し、 [ 次へ ] をクリックします。
+
image:redhat_virtualization_image22.png["エラー：グラフィックイメージがありません"]

. 次の画面で、 [ 日付と時刻 ] でタイムゾーンを選択します。デフォルトは UTC です。ただし、ネットアップでは、環境に応じてこの画面で NTP サーバを設定することを推奨します。次に、キーボードの言語を選択し、「完了」をクリックします。
+
image:redhat_virtualization_image23.png["エラー：グラフィックイメージがありません"]

. 次に、 [ インストール先 ] をクリックします。Installation Destination （インストール先）画面で、 RHV-H をインストールするドライブを選択します[ パーティショニング ] セクションで [ パーティションの自動構成 ] が選択されていることを確認します。必要に応じて、 [ マイデータの暗号化 ] の横にあるチェックボックスをオンにして、暗号化を有効にできます。[ 完了 ] をクリックして設定を確定します。
+
image:redhat_virtualization_image24.png["エラー：グラフィックイメージがありません"]

. [ ネットワークとホスト名 ] をクリックします。画面下部に希望するホスト名を入力します。次に、下部の（ + ）ボタンをクリックします。ドロップダウンからボンドを選択し、追加をクリックします。
+
image:redhat_virtualization_image25.png["エラー：グラフィックイメージがありません"]

. 次に、ボンド構成画面で追加をクリックし、メンバーインターフェイスをボンドインターフェイスに追加します。
+
image:redhat_virtualization_image26.png["エラー：グラフィックイメージがありません"]

. ドロップダウンからイーサネットを選択し、イーサネットインターフェイスがボンドインターフェイスのメンバーとして追加されていることを確認します。Create をクリックします。 .
+
image:redhat_virtualization_image27.png["エラー：グラフィックイメージがありません"]

. スレーブ 1 設定画面の Device ドロップダウンから、イーサネットインターフェイスを選択します。MTU が 9000 に設定されていることを確認します。[ 保存 ] をクリックします .
+
image:redhat_virtualization_image28.png["エラー：グラフィックイメージがありません"]

. 手順 12 、 13 、および 14 を繰り返して、他のイーサネットポートを bond0 インターフェイスに追加します。
. ボンド設定画面の Mode （モード）ドロップダウンから、 LACP 用 802.3ad を選択します。MTU が 9000 に設定されていることを確認します。[ 保存 ] をクリックします。
+
image:redhat_virtualization_image29.png["エラー：グラフィックイメージがありません"]

. インバンド管理ネットワーク用の VLAN インターフェイスを作成します。[+] ボタンをもう一度クリックし、ドロップダウンから [VLAN] を選択して、 [Create （作成） ] をクリックします。
+
image:redhat_virtualization_image30.jpg["エラー：グラフィックイメージがありません"]

. [Editing VLAN connection] 画面で、 [Parent Interface] ドロップダウンの [bond0] を選択し、インバンド管理ネットワークの VLAN ID を入力します。VLAN インターフェイスの名前を「 bond`0.<`vlan_id`>` 」の形式で指定します。
+
image:redhat_virtualization_image31.jpg["エラー：グラフィックイメージがありません"]

. VLAN 接続の編集画面で、 IPv4 設定サブタブをクリックします。IPv4 Settings サブタブで、帯域内管理ネットワークに対応するネットワークアドレス、ネットマスク、ゲートウェイ、および DNS サーバを設定します。[ 保存 ] をクリックして設定を確定します。
+
image:redhat_virtualization_image32.jpg["エラー：グラフィックイメージがありません"]

. ストレージネットワークの VLAN インターフェイスを作成します。[+] ボタンをもう一度クリックし、ドロップダウンから [VLAN] を選択して、 [Create （作成） ] をクリックします。[Editing VLAN Connection] 画面で、 [Parent Interface] ドロップダウンから [bond0] を選択し、ストレージネットワークの VLAN ID を入力して、「 bond`0.<`vlan_id`>] 」の形式で VLAN インターフェイスの名前を指定します。ジャンボフレームをサポートできるように MTU を 9000 に調整します。[ 保存 ] をクリックします .
+
image:redhat_virtualization_image33.png["エラー：グラフィックイメージがありません"]

. VLAN 接続の編集画面で、 IPv4 設定サブタブをクリックします。IPv4 Settings サブタブで、ストレージネットワークに対応するネットワークアドレスとネットマスクを設定します。[ 保存 ] をクリックして設定を確定します。
+
image:redhat_virtualization_image34.jpg["エラー：グラフィックイメージがありません"]

. ネットワークインターフェイスが動作していることを確認し、 Done をクリックします。
+
image:redhat_virtualization_image35.jpg["エラー：グラフィックイメージがありません"]

. ウィザードが構成ページに戻ったら、 [ インストールの開始 ] をクリックします。次の画面では、 root パスワードを設定するように求められ、 RHV-H にログインするための別のユーザを作成することもできます
+
image:redhat_virtualization_image36.png["エラー：グラフィックイメージがありません"]

. インストールが完了したら、仮想コンソールの [Virtual media] > [Virtual Storage] に移動して [Plug Out] をクリックし、 ISO ファイルをアンマウントします。次に、 Anaconda GUI で Reboot をクリックして、インストールプロセスを完了します。その後、ノードがリブートします。
+
image:redhat_virtualization_image37.png["エラー：グラフィックイメージがありません"]

+
ノードが起動すると、ログイン画面が表示されます。

+
image:redhat_virtualization_image38.jpg["エラー：グラフィックイメージがありません"]

. インストールが完了したら、 RHV-H を登録し、必要なリポジトリを有効にする必要があります。ブラウザを開き、インストール時に提供された root 資格情報を使用して、「 https://<HostFQDN/IP>:9090` 」にある Cockpit ユーザーインタフェースにログインします。
+
image:redhat_virtualization_image39.png["エラー：グラフィックイメージがありません"]

. localhost > Subscriptions と進み、 Register をクリックします。Red Hat ポータルのユーザー名とパスワードを入力し、 [ このシステムを Red Hat Insights に接続する ] チェックボックスをオンにして、 [ 登録 ] をクリックします。システムは、 Red Hat Virtualization ホスト使用権に自動的に登録します。
+
Red Hat Insights は、登録済みシステムを継続的に分析して、物理環境、仮想環境、クラウド環境の可用性、セキュリティ環境、パフォーマンス、安定性に対する脅威をプロアクティブに認識します。

+
image:redhat_virtualization_image40.png["エラー：グラフィックイメージがありません"]

. localhost > Terminal に移動して CLI を表示します。任意で、任意の SSH クライアントを使用して RHV -H CLI にログインできます。必要なサブスクリプションが接続されていることを確認してから、 Red Hat Virtualization Host 7 リポジトリを有効にして追加の更新を許可し、他のすべてのリポジトリが無効になっていることを確認します。
+
....
# subscription-manager list
+-------------------------------------------+
    Installed Product Status
+-------------------------------------------+
Product Name:   Red Hat Virtualization Host
Product ID:     328
Version:        4.3
Arch:           x86_64
Status:         Subscribed
# subscription-manager repos --disable=*
Repository 'rhel-7-server- rhvh-4-source-rpms' is disabled for this system.
Repository 'rhvh-4-build-beta-for-rhel-8-x86_64-source-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-beta-debug-rpms' is disabled for this system.
Repository 'rhvh-4-beta-for-rhel-8-x86_64-debug-rpms' is disabled for this system.
Repository 'jb-eap-textonly-1-for-middleware-rpms' is disabled for this system.
Repository 'rhvh-4-build-beta-for-rhel-8-x86_64-rpms' is disabled for this system.
Repository 'rhvh-4-beta-for-rhel-8-x86_64-source-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-debug-rpms' is disabled for this system.
Repository 'rhvh-4-build-beta-for-rhel-8-x86_64-debug-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-beta-source-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-rpms' is disabled for this system.
Repository 'jb-coreservices-textonly-1-for-middleware-rpms' is disabled for this system.
Repository 'rhvh-4-beta-for-rhel-8-x86_64-rpms' is disabled for this system.
Repository 'rhel-7-server- rhvh-4-beta-rpms' is disabled for this system.
# subscription-manager repos --enable=rhel-7-server- rhvh-4-rpms
Repository 'rhel-7-server- rhvh-4-rpms' is enabled for this system.
....
. コンソールで次のコマンドを実行して、 iSCSI イニシエータ ID を Element アクセスグループで設定した ID に変更します。
+
....
rhv-h01 # echo InitiatorName=iqn.1994-05.com.redhat:rhv-host-node- 01 > /etc/iscsi/initiatorname.iscsi
....
. iscsid サービスを有効にして、再起動します。
+
....
 # systemctl enable iscsid
Created symlink from /etc/systemd/system/multi-user.target.wants/iscsid.service to /usr/lib/systemd/system/iscsid.service
 # systemctl start iscsid
 # systemctl status iscsid
● iscsid.service - Open-iSCSI
   Loaded: loaded (/usr/lib/systemd/system/iscsid.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2020-05-14 16:08:52 EDT; 3 days ago
     Docs: man:iscsid(8)
           man:iscsiuio(8)
           man:iscsiadm(8)
 Main PID: 5422 (iscsid)
   Status: "Syncing existing session(s)"
   CGroup: /system.slice/iscsid.service
           ├─5422 /sbin/iscsid -f
           └─5423 /sbin/iscsid -f
....
. 手順 1 ～ 29 を繰り返して、もう一方の RHV ホストを取り付けて準備します。


link:rhv-5._deploy_rhv_manager.html["次へ： 5.RHV マネージャを自己ホスト型エンジンとして導入します"]
