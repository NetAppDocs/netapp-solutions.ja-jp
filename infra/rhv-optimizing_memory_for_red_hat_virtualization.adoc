---
sidebar: sidebar 
permalink: infra/rhv-optimizing_memory_for_red_hat_virtualization.html 
keywords: memory overcommitment, thin provisioning, Memory Overcommit Manager, MoM, memory ballooning, Kernel Same-page Merging, KSM 
summary:  
---
= Red Hat 仮想化のためのメモリの最適化： RHV を搭載した NetApp HCI
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
仮想インフラを導入する主なメリットの 1 つは、環境内の物理リソースをより効率的に使用できるようにすることです。ゲスト VM が割り当てられたメモリを十分に利用できない場合は、メモリオーバーコミットメントを使用してメモリ使用率を最適化できます。この機能を使用すると、ホスト上のゲスト VM に割り当てられたメモリの合計が、そのホスト上の物理メモリの量を超えることができます。

メモリオーバーコミットの概念は、ストレージリソースのシンプロビジョニングと似ています。どの時点においても、ホスト上のすべての VM は、割り当てられたメモリの合計量を使用しません。1 つの VM に過剰なメモリがある場合、その未使用のメモリを他の VM で使用できます。そのため、エンドユーザは、通常は許可されない VM を追加で導入できます。クラスタ内のホスト上のメモリオーバーコミットメントは、メモリオーバーコミットマネージャ（ MoM ）によって処理されます。メモリバルーニングやカーネル同一ページマージ（ KSM ）などの手法を使用すると、ワークロードの種類に応じてメモリオーバーコミットメントを改善できます。

メモリバルーニングは、以前にさまざまな VM に割り当てられていた未使用のメモリを再利用することで、ホストがメモリを一時的に拡張できるメモリ管理手法です。これは、各 VM の保証されるメモリサイズに制限があります。メモリバルーニングが機能するために、各 VM には、必要なドライバを含むバルーンデバイスがデフォルトで用意されています。バルーニングは、基本的には VM ドライバとホストの間の協調的な操作です。ホストのメモリニーズに応じて、バルーンデバイスによって制御されるバルーンを拡張（ホストにメモリを提供）するか、または収縮（メモリを取り戻す）するようにゲスト OS に指示します。

カーネル同ページマージ（ KSM ）を使用すると、ホストカーネルは実行中の VM を複数検査し、イメージとメモリを比較できます。いずれかのメモリ領域またはページが同一である場合、 KSM は同一のメモリページを 1 つのページに減らします。その後、このページは「書き込み時にコピー」とマークされ、ゲスト VM によってページの内容が変更された場合は、そのゲスト VM 用に新しいページが作成されます。

両方の機能をクラスタレベルで有効にして、そのクラスタ内のすべてのホストに適用できます。これらの機能を有効にするには、 [ 計算（ Compute ） ] > [ クラスタ（ Cluster ） ] に移動し、目的のクラスタを選択して [ 編集（ Edit ）次に、最適化サブタブをクリックし、要件に応じて次の手順を実行します。

. ユースケースとワークロードに応じて、メモリのオーバーコミットメントを使用可能な物理メモリの 150% または 200% にするようにメモリ最適化を有効にします。
. メモリバルーニングをイネーブルにするには、 Enable Memory Balloon Optimization チェックボックスをオンにします。
. KSM をイネーブルにするには、 Enable KSM チェックボックスをオンにします。
. [OK] をクリックして変更を確定します。


image:redhat_virtualization_image75.png["エラー：グラフィックイメージがありません"]

これらの変更を適用した後は、 MoM ポリシーを手動で同期するまで有効になりません。MoM ポリシーを同期するには、 [ 計算（ Compute ） ] > [ クラスタ（ Clusters ） ] の順に選択し、最適化を変更したクラスタをクリックします。Hosts サブタブに移動し、すべてのホストを選択してから、 Sync MoM Policy をクリックします。

image:redhat_virtualization_image76.png["エラー：グラフィックイメージがありません"]

KSM とバルーニング原因は、ホスト上のメモリを解放してオーバーコミットメントを促進できますが、共有可能なメモリの量が減少し、物理メモリの使用量が増加した場合、メモリ不足状態になる可能性があります。したがって、管理者は、共有可能なメモリが減少した場合にメモリ不足の状態を避けるために、十分なメモリを確保する必要があります。

一部のシナリオでは、メモリバルーニングは KSM と衝突する可能性があります。このような状況では、 MoM は衝突を最小限に抑えるためにバルーンサイズの調整を試みます。また、バルーニングによって原因が最適でないパフォーマンスになる場合もあります。そのため、ワークロードの要件に応じて、どちらかまたは両方の方法を有効にすることを検討してください。

link:rhv-additional_information.html["次へ： RHV を搭載した追加情報 NetApp HCI を探す場所"]
